
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Vehicle detection &#8212; My Jupter Notebook on data science.</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Deep Learning (UNSW)" href="../9444/9444-intro.html" />
    <link rel="prev" title="Lane detection" href="9517-lane_detection.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">My Jupter Notebook on data science.</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://postsent.github.io/">
   Back to Blog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../reference.html">
   References
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Machine Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../ml/regression/regression.html">
   Regression
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../ml/p1-crypto-prediction.html">
     Crypto Prediction
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ml/classification/classification.html">
   Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ml/time-series/time-series.html">
   Time Series
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../ml/ml.html">
   General
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Computer Vision
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../cv/cv.html">
   Placeholder
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../cv/3431_project/project.html">
   Mini self-driving - turtlebot
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  NLP
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../nlp/nlp.html">
   Reading
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../nlp/nlp-code.html">
   Set seed
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data Science Courses
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../9417/9417-intro.html">
   Machine Learning (UNSW)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../9417/9417-basic.html">
     Basic with examples
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../9417/9417-project.html">
     Project - Classification
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../9418/9418-intro.html">
   PGM (UNSW)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../9418/9418-EDA.html">
     EDA on Times Series Dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../9418/9418-project.html">
     Time series project code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../9418/9418-project/report.html">
     Time series report
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="9517-intro.html">
   Computer Vision (UNSW)
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="9517-a1-code.html">
     Basic image processing, thresholding, count cells
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="9517-a1/report.html">
     Report on Basic image processing, etc
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="9517-lane_detection.html">
     Lane detection
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Vehicle detection
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../9444/9444-intro.html">
   Deep Learning (UNSW)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../9444/9444-project.html">
     Image classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../9444/assignment1/assignment1.html">
     Characters, Spirals and Hidden Unit Dynamics (Assignment 1)
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Misc
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../misc/math.html">
   Math
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Coding Basic
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../../basic/basic-intro.html">
   Numpy, Pandas, Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../basic/numpy.html">
     Numpy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../basic/pandas.html">
     Pandas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../../basic/leetcode.html">
     Leetcode
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/ds-courses/unsw/9517/9517-vehicle-detection.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/postsent/nb"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/postsent/nb/main?urlpath=tree/docs/ds-courses/unsw/9517/9517-vehicle-detection.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Vehicle detection
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#drawing-and-plotting-routines">
   Drawing and plotting routines.
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ssd-tensorflow-network">
   SSD TensorFlow Network
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#image-pipeline">
   Image Pipeline
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-sample-image">
     Load sample image
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#raw-ssd-output-multiple-detections-after-simple-thresholding">
     Raw SSD output: multiple detections after simple thresholding
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#evaluation">
   Evaluation
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Vehicle detection</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Vehicle detection
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#drawing-and-plotting-routines">
   Drawing and plotting routines.
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ssd-tensorflow-network">
   SSD TensorFlow Network
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#image-pipeline">
   Image Pipeline
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-sample-image">
     Load sample image
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#raw-ssd-output-multiple-detections-after-simple-thresholding">
     Raw SSD output: multiple detections after simple thresholding
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#evaluation">
   Evaluation
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="vehicle-detection">
<h1>Vehicle detection<a class="headerlink" href="#vehicle-detection" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">slim</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">contrib</span><span class="o">.</span><span class="n">slim</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\alex\Anaconda3\lib\site-packages\tensorflow\python\framework\dtypes.py:516: FutureWarning: Passing (type, 1) or &#39;1type&#39; as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / &#39;(1,)type&#39;.
  _np_qint8 = np.dtype([(&quot;qint8&quot;, np.int8, 1)])
C:\Users\alex\Anaconda3\lib\site-packages\tensorflow\python\framework\dtypes.py:517: FutureWarning: Passing (type, 1) or &#39;1type&#39; as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / &#39;(1,)type&#39;.
  _np_quint8 = np.dtype([(&quot;quint8&quot;, np.uint8, 1)])
C:\Users\alex\Anaconda3\lib\site-packages\tensorflow\python\framework\dtypes.py:518: FutureWarning: Passing (type, 1) or &#39;1type&#39; as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / &#39;(1,)type&#39;.
  _np_qint16 = np.dtype([(&quot;qint16&quot;, np.int16, 1)])
C:\Users\alex\Anaconda3\lib\site-packages\tensorflow\python\framework\dtypes.py:519: FutureWarning: Passing (type, 1) or &#39;1type&#39; as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / &#39;(1,)type&#39;.
  _np_quint16 = np.dtype([(&quot;quint16&quot;, np.uint16, 1)])
C:\Users\alex\Anaconda3\lib\site-packages\tensorflow\python\framework\dtypes.py:520: FutureWarning: Passing (type, 1) or &#39;1type&#39; as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / &#39;(1,)type&#39;.
  _np_qint32 = np.dtype([(&quot;qint32&quot;, np.int32, 1)])
C:\Users\alex\Anaconda3\lib\site-packages\tensorflow\python\framework\dtypes.py:525: FutureWarning: Passing (type, 1) or &#39;1type&#39; as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / &#39;(1,)type&#39;.
  np_resource = np.dtype([(&quot;resource&quot;, np.ubyte, 1)])
C:\Users\alex\Anaconda3\lib\site-packages\tensorboard\compat\tensorflow_stub\dtypes.py:541: FutureWarning: Passing (type, 1) or &#39;1type&#39; as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / &#39;(1,)type&#39;.
  _np_qint8 = np.dtype([(&quot;qint8&quot;, np.int8, 1)])
C:\Users\alex\Anaconda3\lib\site-packages\tensorboard\compat\tensorflow_stub\dtypes.py:542: FutureWarning: Passing (type, 1) or &#39;1type&#39; as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / &#39;(1,)type&#39;.
  _np_quint8 = np.dtype([(&quot;quint8&quot;, np.uint8, 1)])
C:\Users\alex\Anaconda3\lib\site-packages\tensorboard\compat\tensorflow_stub\dtypes.py:543: FutureWarning: Passing (type, 1) or &#39;1type&#39; as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / &#39;(1,)type&#39;.
  _np_qint16 = np.dtype([(&quot;qint16&quot;, np.int16, 1)])
C:\Users\alex\Anaconda3\lib\site-packages\tensorboard\compat\tensorflow_stub\dtypes.py:544: FutureWarning: Passing (type, 1) or &#39;1type&#39; as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / &#39;(1,)type&#39;.
  _np_quint16 = np.dtype([(&quot;quint16&quot;, np.uint16, 1)])
C:\Users\alex\Anaconda3\lib\site-packages\tensorboard\compat\tensorflow_stub\dtypes.py:545: FutureWarning: Passing (type, 1) or &#39;1type&#39; as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / &#39;(1,)type&#39;.
  _np_qint32 = np.dtype([(&quot;qint32&quot;, np.int32, 1)])
C:\Users\alex\Anaconda3\lib\site-packages\tensorboard\compat\tensorflow_stub\dtypes.py:550: FutureWarning: Passing (type, 1) or &#39;1type&#39; as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / &#39;(1,)type&#39;.
  np_resource = np.dtype([(&quot;resource&quot;, np.ubyte, 1)])
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:tensorflow:
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">mpcm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colors_tableau</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="p">(</span><span class="mi">174</span><span class="p">,</span> <span class="mi">199</span><span class="p">,</span> <span class="mi">232</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span>    
                 <span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">44</span><span class="p">),</span> <span class="p">(</span><span class="mi">152</span><span class="p">,</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">138</span><span class="p">),</span> <span class="p">(</span><span class="mi">214</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>    
                 <span class="p">(</span><span class="mi">148</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">189</span><span class="p">),</span> <span class="p">(</span><span class="mi">197</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">213</span><span class="p">),</span> <span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">75</span><span class="p">),</span> <span class="p">(</span><span class="mi">196</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">148</span><span class="p">),</span>    
                 <span class="p">(</span><span class="mi">227</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">194</span><span class="p">),</span> <span class="p">(</span><span class="mi">247</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">210</span><span class="p">),</span> <span class="p">(</span><span class="mi">127</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">127</span><span class="p">),</span> <span class="p">(</span><span class="mi">199</span><span class="p">,</span> <span class="mi">199</span><span class="p">,</span> <span class="mi">199</span><span class="p">),</span>    
                 <span class="p">(</span><span class="mi">188</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">34</span><span class="p">),</span> <span class="p">(</span><span class="mi">219</span><span class="p">,</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">141</span><span class="p">),</span> <span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">207</span><span class="p">),</span> <span class="p">(</span><span class="mi">158</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">229</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">isess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">InteractiveSession</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="drawing-and-plotting-routines">
<h1>Drawing and plotting routines.<a class="headerlink" href="#drawing-and-plotting-routines" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bboxes_draw_on_img</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">show_text</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Drawing bounding boxes on an image, with additional text if wanted...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bboxes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">bboxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
        <span class="c1"># Draw bounding box...</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">p1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
        <span class="c1"># Draw text...</span>
<span class="c1">#         if show_text:</span>
<span class="c1">#             s = &#39;%s: %s&#39; % (&#39;Car&#39;, scores[i])    </span>
<span class="c1">#             p1 = (p1[0]-5, p1[1])</span>
<span class="c1">#             cv2.putText(img, s, p1[::-1], cv2.FONT_HERSHEY_DUPLEX, 0.7, color, 1)</span>

<span class="k">def</span> <span class="nf">plot_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">9</span><span class="p">)):</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Methods and evaluation:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Problem definition
    ·estimate the distance of each vehicle relative to the camera in each image
        step 1: find an approach to detect the vehicles
        step 2: remove the redundant bounding boxes
        step 3: calculate the distance of each vehicle

Pipeline (Vehicle Detection)
    1) Use SSD (Single Shot MultiBox Detector) approach and obtain a pre-trained model from the Internet
    2) Load the network parameters and restore SSD model.
    3) Run SSD network to get the class prediction and localization
    4) Then get the anchor boxes for this image shape
    5) Compute classes and bboxes from the net outputs and only keep the vehicles
    6) Get an output: an image with multiple detections after simple thresholding
    7) Apply NMS (Non Maximum Suppression) method to bounding boxes with score averaging
    
Distance Estimation
    ·Apply triangle similarity
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>focus length = (fx + fx) / 2 = (714.1526 + 710.3725) / 2
r is the pixel width of the vehicle in the image (px)
R is the width of the vehicle in the real world (m)
We can set the value of R, then the distance d = R * f / r
The horizontal displacement can be calculated using the same way

To choose a reasonable value of R, we calculate the average width of the vehicles in the training dataset using the information in the annotations.
R = 2.15418 m
</pre></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="ssd-tensorflow-network">
<h1>SSD TensorFlow Network<a class="headerlink" href="#ssd-tensorflow-network" title="Permalink to this headline">¶</a></h1>
<p>Build up the convolutional network and load the checkpoint.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nets</span> <span class="kn">import</span> <span class="n">ssd_vgg_300</span>
<span class="kn">from</span> <span class="nn">nets</span> <span class="kn">import</span> <span class="n">ssd_common</span>
<span class="kn">from</span> <span class="nn">preprocessing</span> <span class="kn">import</span> <span class="n">ssd_vgg_preprocessing</span>

<span class="n">ckpt_filename</span> <span class="o">=</span> <span class="s1">&#39;./checkpoints/ssd_model.ckpt&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Input placeholder.</span>
<span class="n">img_input</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">image_pre</span><span class="p">,</span> <span class="n">labels_pre</span><span class="p">,</span> <span class="n">bboxes_pre</span><span class="p">,</span> <span class="n">bbox_img</span> <span class="o">=</span> <span class="n">ssd_vgg_preprocessing</span><span class="o">.</span><span class="n">preprocess_for_eval</span><span class="p">(</span>
    <span class="n">img_input</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">resize</span><span class="o">=</span><span class="n">ssd_vgg_preprocessing</span><span class="o">.</span><span class="n">Resize</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>
<span class="n">image_4d</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">image_pre</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Network parameters.</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">ssd_vgg_300</span><span class="o">.</span><span class="n">SSDNet</span><span class="o">.</span><span class="n">default_params</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># SSD network construction.</span>
<span class="n">reuse</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="s1">&#39;ssd&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
<span class="n">ssd</span> <span class="o">=</span> <span class="n">ssd_vgg_300</span><span class="o">.</span><span class="n">SSDNet</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="k">with</span> <span class="n">slim</span><span class="o">.</span><span class="n">arg_scope</span><span class="p">(</span><span class="n">ssd</span><span class="o">.</span><span class="n">arg_scope</span><span class="p">(</span><span class="n">weight_decay</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">)):</span>
    <span class="n">predictions</span><span class="p">,</span> <span class="n">localisations</span><span class="p">,</span> <span class="n">logits</span><span class="p">,</span> <span class="n">end_points</span> <span class="o">=</span> <span class="n">ssd</span><span class="o">.</span><span class="n">net</span><span class="p">(</span><span class="n">image_4d</span><span class="p">,</span> <span class="n">is_training</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reuse</span><span class="o">=</span><span class="n">reuse</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:tensorflow:From C:\Users\alex\Desktop\2021T1\comp9517\ass2\preprocessing\ssd_vgg_preprocessing.py:304: to_float (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.cast` instead.
WARNING:tensorflow:From C:\Users\alex\Desktop\2021T1\comp9517\ass2\nets\ssd_vgg_300.py:392: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6B048&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6B048&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6B048&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6B048&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6B048&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6B048&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6B048&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6B048&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C80EB2B0B8&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C80EB2B0B8&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C80EB2B0B8&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C80EB2B0B8&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE45F98&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE45F98&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE45F98&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE45F98&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6B6A0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6B6A0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6B6A0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6B6A0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C80E66D9B0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C80E66D9B0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C80E66D9B0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C80E66D9B0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE3ABE0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE3ABE0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE3ABE0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE3ABE0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE81780&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE81780&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE81780&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE81780&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE81438&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE81438&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE81438&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE81438&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C83CE2F710&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C83CE2F710&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C83CE2F710&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C83CE2F710&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE45908&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE45908&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE45908&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE45908&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69748&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69748&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69748&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69748&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69860&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69860&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69860&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69860&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C83CE81898&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C83CE81898&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C83CE81898&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C83CE81898&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69470&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69470&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69470&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69470&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE3A390&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE3A390&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE3A390&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE3A390&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69F28&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69F28&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69F28&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CF69F28&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C80EAB5128&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C80EAB5128&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C80EAB5128&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Pooling2D.call of &lt;tensorflow.python.layers.pooling.MaxPooling2D object at 0x000001C80EAB5128&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C80E66D9B0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C80E66D9B0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C80E66D9B0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C80E66D9B0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D03A358&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D03A358&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D03A358&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D03A358&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D05C5F8&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D05C5F8&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D05C5F8&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D05C5F8&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D1E8EB8&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D1E8EB8&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D1E8EB8&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D1E8EB8&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D1E8390&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D1E8390&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D1E8390&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D1E8390&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6BD30&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6BD30&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6BD30&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6BD30&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D13E5F8&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D13E5F8&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D13E5F8&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D13E5F8&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D0CD278&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D0CD278&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D0CD278&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D0CD278&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D0F0A58&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D0F0A58&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D0F0A58&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D0F0A58&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6BBA8&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6BBA8&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6BBA8&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6BBA8&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D2B2FD0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D2B2FD0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D2B2FD0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D2B2FD0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6BA20&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6BA20&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6BA20&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CD6BA20&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D3B0588&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D3B0588&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D3B0588&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D3B0588&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C80EB09C18&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C80EB09C18&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C80EB09C18&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C80EB09C18&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE3AF60&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE3AF60&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE3AF60&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83CE3AF60&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D491CC0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D491CC0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D491CC0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D491CC0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D4F45C0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D4F45C0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D4F45C0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D4F45C0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D4F47F0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D4F47F0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D4F47F0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D4F47F0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D57F390&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D57F390&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D57F390&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D57F390&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D30C6A0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D30C6A0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D30C6A0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D30C6A0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D6A5CC0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D6A5CC0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D6A5CC0&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D6A5CC0&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
WARNING:tensorflow:Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D63CA20&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D63CA20&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: Entity &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D63CA20&gt;&gt; could not be transformed and will be executed as-is. Please report this to the AutgoGraph team. When filing the bug, set the verbosity to 10 (on Linux, `export AUTOGRAPH_VERBOSITY=10`) and attach the full output. Cause: converting &lt;bound method Conv.call of &lt;tensorflow.python.layers.convolutional.Conv2D object at 0x000001C83D63CA20&gt;&gt;: AssertionError: Bad argument number for Name: 3, expecting 4
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize variables.</span>
<span class="n">init_op</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">()</span>
<span class="n">isess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">init_op</span><span class="p">)</span>

<span class="c1"># Restore SSD model.</span>
<span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Saver</span><span class="p">()</span>
<span class="n">saver</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">isess</span><span class="p">,</span> <span class="n">ckpt_filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:tensorflow:From C:\Users\alex\Anaconda3\lib\site-packages\tensorflow\python\training\saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file APIs to check for files with this prefix.
INFO:tensorflow:Restoring parameters from ./checkpoints/ssd_model.ckpt
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="image-pipeline">
<h1>Image Pipeline<a class="headerlink" href="#image-pipeline" title="Permalink to this headline">¶</a></h1>
<p>Presenting the different steps of the vehicle detection pipeline.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Main SSD processing routine.</span>
<span class="k">def</span> <span class="nf">ssd_process_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">select_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Process an image through SSD network.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">      img: Numpy array containing an image.</span>
<span class="sd">      select_threshold: Classification threshold (i.e. probability threshold for car detection).</span>
<span class="sd">    Return:</span>
<span class="sd">      rclasses, rscores, rbboxes: Classes, scores and bboxes of objects detected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Resize image to height 300.</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="mf">300.</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">fx</span><span class="o">=</span><span class="n">factor</span><span class="p">,</span> <span class="n">fy</span><span class="o">=</span><span class="n">factor</span><span class="p">)</span> 
    <span class="c1"># Run SSD network and get class prediction and localization.</span>
    <span class="n">rpredictions</span><span class="p">,</span> <span class="n">rlocalisations</span> <span class="o">=</span> <span class="n">isess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">predictions</span><span class="p">,</span> <span class="n">localisations</span><span class="p">],</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">img_input</span><span class="p">:</span> <span class="n">img</span><span class="p">})</span>
    
    <span class="c1"># Get anchor boxes for this image shape.</span>
    <span class="n">ssd</span><span class="o">.</span><span class="n">update_feature_shapes</span><span class="p">(</span><span class="n">rpredictions</span><span class="p">)</span>
    <span class="n">anchors</span> <span class="o">=</span> <span class="n">ssd</span><span class="o">.</span><span class="n">anchors</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    
    <span class="c1"># Compute classes and bboxes from the net outputs: decode SSD output.</span>
    <span class="n">rclasses</span><span class="p">,</span> <span class="n">rscores</span><span class="p">,</span> <span class="n">rbboxes</span><span class="p">,</span> <span class="n">rlayers</span><span class="p">,</span> <span class="n">ridxes</span> <span class="o">=</span> <span class="n">ssd_common</span><span class="o">.</span><span class="n">ssd_bboxes_select</span><span class="p">(</span>
            <span class="n">rpredictions</span><span class="p">,</span> <span class="n">rlocalisations</span><span class="p">,</span> <span class="n">anchors</span><span class="p">,</span>
            <span class="n">threshold</span><span class="o">=</span><span class="n">select_threshold</span><span class="p">,</span> <span class="n">img_shape</span><span class="o">=</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">ssd</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Remove other classes than cars.</span>
    <span class="n">idxes</span> <span class="o">=</span> <span class="p">(</span><span class="n">rclasses</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">rclasses</span> <span class="o">=</span> <span class="n">rclasses</span><span class="p">[</span><span class="n">idxes</span><span class="p">]</span>
    <span class="n">rscores</span> <span class="o">=</span> <span class="n">rscores</span><span class="p">[</span><span class="n">idxes</span><span class="p">]</span>
    <span class="n">rbboxes</span> <span class="o">=</span> <span class="n">rbboxes</span><span class="p">[</span><span class="n">idxes</span><span class="p">]</span>
    <span class="c1"># Sort boxes by score.</span>
    <span class="n">rclasses</span><span class="p">,</span> <span class="n">rscores</span><span class="p">,</span> <span class="n">rbboxes</span> <span class="o">=</span> <span class="n">ssd_common</span><span class="o">.</span><span class="n">bboxes_sort</span><span class="p">(</span><span class="n">rclasses</span><span class="p">,</span> <span class="n">rscores</span><span class="p">,</span> <span class="n">rbboxes</span><span class="p">,</span> 
                                                        <span class="n">top_k</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">priority_inside</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rclasses</span><span class="p">,</span> <span class="n">rscores</span><span class="p">,</span> <span class="n">rbboxes</span>
</pre></div>
</div>
</div>
</div>
<p>Computing overlap score between bboxes1 and bboxes2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bboxes_overlap</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">bboxes</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">bboxes</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Intersection bbox and volume.</span>
    <span class="n">int_ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">bboxes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">int_xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">bboxes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">int_ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">bboxes</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">int_xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">bboxes</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">int_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">int_ymax</span> <span class="o">-</span> <span class="n">int_ymin</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="n">int_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">int_xmax</span> <span class="o">-</span> <span class="n">int_xmin</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="n">int_vol</span> <span class="o">=</span> <span class="n">int_h</span> <span class="o">*</span> <span class="n">int_w</span>
    <span class="c1"># Union volume.</span>
    <span class="n">vol1</span> <span class="o">=</span> <span class="p">(</span><span class="n">bboxes</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bboxes</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">bboxes</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bboxes</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">vol2</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">score1</span> <span class="o">=</span> <span class="n">int_vol</span> <span class="o">/</span> <span class="n">vol1</span>
    <span class="n">score2</span> <span class="o">=</span> <span class="n">int_vol</span> <span class="o">/</span> <span class="n">vol2</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">score1</span><span class="p">,</span> <span class="n">score2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Apply non-maximum selection to bounding boxes with score averaging.
The NMS algorithm works as follows: go over the list of boxes, and for each, see if
boxes with lower score overlap. If yes, averaging their scores and coordinates, and
consider it as a valid detection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bboxes_nms_intersection_avg</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arguments:</span>
<span class="sd">      classes, scores, bboxes: SSD network output.</span>
<span class="sd">      threshold: Overlapping threshold between two boxes.</span>
<span class="sd">    Return:</span>
<span class="sd">      classes, scores, bboxes: Classes, scores and bboxes of objects detected after applying NMS.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keep_bboxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
    <span class="n">new_bboxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">bboxes</span><span class="p">)</span>
    <span class="n">new_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
    <span class="n">new_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">keep_bboxes</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="c1"># Computer overlap with bboxes which are following.</span>
            <span class="n">sub_bboxes</span> <span class="o">=</span> <span class="n">bboxes</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):]</span>
            <span class="n">sub_scores</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):]</span>
            <span class="n">overlap</span> <span class="o">=</span> <span class="n">bboxes_overlap</span><span class="p">(</span><span class="n">new_bboxes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sub_bboxes</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">overlap</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">keep_bboxes</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):])</span>
            <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                <span class="n">keep_bboxes</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">keep_bboxes</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):],</span> <span class="o">~</span><span class="n">mask</span><span class="p">)</span>
                <span class="c1"># Update boxes...</span>
                <span class="n">tmp_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sub_scores</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="p">(</span><span class="n">sub_scores</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">new_bboxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_bboxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">new_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sub_bboxes</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="n">tmp_scores</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">new_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sub_scores</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
                <span class="n">new_bboxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_bboxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">new_scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">new_elements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
                
                <span class="c1"># New overlap with the remaining?</span>
                <span class="n">overlap</span> <span class="o">=</span> <span class="n">bboxes_overlap</span><span class="p">(</span><span class="n">new_bboxes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sub_bboxes</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">overlap</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">keep_bboxes</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):])</span>

    <span class="n">new_scores</span> <span class="o">=</span> <span class="n">new_scores</span> <span class="o">/</span> <span class="n">new_elements</span>
    <span class="n">idxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">keep_bboxes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">classes</span><span class="p">[</span><span class="n">idxes</span><span class="p">],</span> <span class="n">new_scores</span><span class="p">[</span><span class="n">idxes</span><span class="p">],</span> <span class="n">new_bboxes</span><span class="p">[</span><span class="n">idxes</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Draw the bounding boxes</span>
<span class="k">def</span> <span class="nf">draw_position</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">show_text</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Drawing bounding boxes on an image, with additional text if wanted...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bboxes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">bboxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
        <span class="c1"># Draw bounding box...</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">p1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">thickness</span><span class="p">)</span>
<span class="c1">#         Draw text...</span>
        <span class="k">if</span> <span class="n">show_text</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: (</span><span class="si">%.2f</span><span class="s1">, </span><span class="si">%.2f</span><span class="s1">)m&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;pos&#39;</span><span class="p">,</span> <span class="n">distance</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">offset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>    
            <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">p1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_DUPLEX</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># convert the bound boxes value </span>
<span class="k">def</span> <span class="nf">bboxes_convert</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Drawing bounding boxes on an image, with additional text if wanted...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bboxes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">bboxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">p1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">p2</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
</div>
</div>
<section id="load-sample-image">
<h2>Load sample image<a class="headerlink" href="#load-sample-image" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load a sample image.</span>
<span class="c1"># path = &#39;test_images/&#39;</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;C:/Users/alex/Desktop/2021T1/comp9517/ass2/clips/2/imgs/040.jpg&quot;</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Shape:&#39;</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">plot_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shape: (720, 1280, 3)
</pre></div>
</div>
<img alt="../../../_images/9517-vehicle-detection_21_1.png" src="../../../_images/9517-vehicle-detection_21_1.png" />
</div>
</div>
</section>
<section id="raw-ssd-output-multiple-detections-after-simple-thresholding">
<h2>Raw SSD output: multiple detections after simple thresholding<a class="headerlink" href="#raw-ssd-output-multiple-detections-after-simple-thresholding" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SSD network on image.</span>
<span class="n">rclasses</span><span class="p">,</span> <span class="n">rscores</span><span class="p">,</span> <span class="n">rbboxes</span> <span class="o">=</span> <span class="n">ssd_process_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">select_threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="c1"># Draw bboxes of detected objects.</span>
<span class="n">img_bboxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">bboxes_draw_on_img</span><span class="p">(</span><span class="n">img_bboxes</span><span class="p">,</span> <span class="n">rscores</span><span class="p">,</span> <span class="n">rbboxes</span><span class="p">,</span> <span class="n">colors_tableau</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">show_text</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plot_image</span><span class="p">(</span><span class="n">img_bboxes</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/9517-vehicle-detection_23_0.png" src="../../../_images/9517-vehicle-detection_23_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply Non-Maximum-Selection</span>
<span class="n">nms_threshold</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">rclasses_nms</span><span class="p">,</span> <span class="n">rscores_nms</span><span class="p">,</span> <span class="n">rbboxes_nms</span> <span class="o">=</span> <span class="n">bboxes_nms_intersection_avg</span><span class="p">(</span><span class="n">rclasses</span><span class="p">,</span> <span class="n">rscores</span><span class="p">,</span> <span class="n">rbboxes</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">nms_threshold</span><span class="p">)</span>

<span class="n">output_bbox</span> <span class="o">=</span> <span class="n">bboxes_convert</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">rbboxes_nms</span><span class="p">)</span>

<span class="n">focal_length</span> <span class="o">=</span> <span class="p">(</span><span class="mf">714.1526</span> <span class="o">+</span> <span class="mf">710.3725</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">real_width</span> <span class="o">=</span> <span class="mf">2.154184483121644</span>
<span class="n">cx</span> <span class="o">=</span> <span class="mf">713.85</span>
<span class="n">tmp_x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">tmp_y</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">output_bbox</span><span class="p">:</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">pixel_width</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">focal_length</span> <span class="o">*</span> <span class="n">real_width</span> <span class="o">/</span> <span class="n">pixel_width</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">*</span>  <span class="p">(</span><span class="n">avg</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)</span> <span class="o">/</span> <span class="n">focal_length</span>
    <span class="n">tmp_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
    <span class="n">tmp_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>

<span class="c1"># Draw bboxes</span>
<span class="n">img_bboxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">draw_position</span><span class="p">(</span><span class="n">img_bboxes</span><span class="p">,</span> <span class="n">tmp_x</span><span class="p">,</span> <span class="n">tmp_y</span><span class="p">,</span> <span class="n">rbboxes_nms</span><span class="p">,</span> <span class="n">colors_tableau</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">plot_image</span><span class="p">(</span><span class="n">img_bboxes</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span> 
<span class="c1"># plt.savefig(&#39;output.jpg&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-0.5, 1279.5, 719.5, -0.5)
</pre></div>
</div>
<img alt="../../../_images/9517-vehicle-detection_24_1.png" src="../../../_images/9517-vehicle-detection_24_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">49</span><span class="p">]:</span>    
    <span class="c1"># Load a sample image.</span>
    <span class="c1"># path = &#39;test_images/&#39;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;clips&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s2">&quot;imgs/040.jpg&quot;</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="c1">#     plot_image(img, &#39;Original frame&#39;, (10, 10))</span>


    <span class="c1"># SSD network on image.</span>
    <span class="n">rclasses</span><span class="p">,</span> <span class="n">rscores</span><span class="p">,</span> <span class="n">rbboxes</span> <span class="o">=</span> <span class="n">ssd_process_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">select_threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="c1"># Draw bboxes of detected objects.</span>
    <span class="n">img_bboxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">bboxes_draw_on_img</span><span class="p">(</span><span class="n">img_bboxes</span><span class="p">,</span> <span class="n">rscores</span><span class="p">,</span> <span class="n">rbboxes</span><span class="p">,</span> <span class="n">colors_tableau</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">show_text</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#     plot_image(img_bboxes, &#39;Raw SSD network output: multiple detections.&#39;, (10, 10))</span>


    <span class="c1"># Apply Non-Maximum-Selection</span>
    <span class="n">nms_threshold</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">rclasses_nms</span><span class="p">,</span> <span class="n">rscores_nms</span><span class="p">,</span> <span class="n">rbboxes_nms</span> <span class="o">=</span> <span class="n">bboxes_nms_intersection_avg</span><span class="p">(</span><span class="n">rclasses</span><span class="p">,</span> <span class="n">rscores</span><span class="p">,</span> <span class="n">rbboxes</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">nms_threshold</span><span class="p">)</span>

    <span class="n">output_bbox</span> <span class="o">=</span> <span class="n">bboxes_convert</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">rbboxes_nms</span><span class="p">)</span>

    <span class="n">focal_length</span> <span class="o">=</span> <span class="p">(</span><span class="mf">714.1526</span> <span class="o">+</span> <span class="mf">710.3725</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># average of fx and fy</span>
    <span class="n">real_width</span> <span class="o">=</span> <span class="mf">2.154184483121644</span>            <span class="c1"># We compute it using all of the annotations in the training dataset</span>
    <span class="n">cx</span> <span class="o">=</span> <span class="mf">713.85</span>
    <span class="n">tmp_x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tmp_y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">output_bbox</span><span class="p">:</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">pixel_width</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">focal_length</span> <span class="o">*</span> <span class="n">real_width</span> <span class="o">/</span> <span class="n">pixel_width</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">*</span>  <span class="p">(</span><span class="n">avg</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)</span> <span class="o">/</span> <span class="n">focal_length</span>
        <span class="n">tmp_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
        <span class="n">tmp_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>

    <span class="c1"># Draw bboxes</span>
    <span class="n">img_bboxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">draw_position</span><span class="p">(</span><span class="n">img_bboxes</span><span class="p">,</span> <span class="n">tmp_x</span><span class="p">,</span> <span class="n">tmp_y</span><span class="p">,</span> <span class="n">rbboxes_nms</span><span class="p">,</span> <span class="n">colors_tableau</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">plot_image</span><span class="p">(</span><span class="n">img_bboxes</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/9517-vehicle-detection_25_0.png" src="../../../_images/9517-vehicle-detection_25_0.png" />
<img alt="../../../_images/9517-vehicle-detection_25_1.png" src="../../../_images/9517-vehicle-detection_25_1.png" />
<img alt="../../../_images/9517-vehicle-detection_25_2.png" src="../../../_images/9517-vehicle-detection_25_2.png" />
<img alt="../../../_images/9517-vehicle-detection_25_3.png" src="../../../_images/9517-vehicle-detection_25_3.png" />
<img alt="../../../_images/9517-vehicle-detection_25_4.png" src="../../../_images/9517-vehicle-detection_25_4.png" />
<img alt="../../../_images/9517-vehicle-detection_25_5.png" src="../../../_images/9517-vehicle-detection_25_5.png" />
<img alt="../../../_images/9517-vehicle-detection_25_6.png" src="../../../_images/9517-vehicle-detection_25_6.png" />
<img alt="../../../_images/9517-vehicle-detection_25_7.png" src="../../../_images/9517-vehicle-detection_25_7.png" />
<img alt="../../../_images/9517-vehicle-detection_25_8.png" src="../../../_images/9517-vehicle-detection_25_8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_position</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="n">json_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;clips&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">),</span> <span class="s2">&quot;annotation.json&quot;</span><span class="p">)</span>
    <span class="n">strList</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">))</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">strList</span><span class="p">)):</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">strList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span>
        <span class="n">position_x</span> <span class="o">=</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">position_y</span> <span class="o">=</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">strList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bbox&#39;</span><span class="p">)</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">))</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">))</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">))</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">))</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
        <span class="n">h1</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
        <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">w1</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">position_x</span><span class="p">,</span> <span class="n">position_y</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_the_average_width</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="n">json_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;clips&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">),</span> <span class="s2">&quot;annotation.json&quot;</span><span class="p">)</span>
    
    <span class="n">strList</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">json_path</span><span class="p">))</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="n">strList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bbox&#39;</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">))</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">))</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">))</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">))</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">strList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">width</span><span class="p">,</span> <span class="n">distance</span>

<span class="n">focal_length</span> <span class="o">=</span> <span class="p">(</span><span class="mf">714.1526</span> <span class="o">+</span> <span class="mf">710.3725</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">summ</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1075</span><span class="p">):</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">get_the_average_width</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">real_width</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">width</span> <span class="o">/</span> <span class="n">focal_length</span>
    <span class="n">summ</span> <span class="o">+=</span> <span class="n">real_width</span>
<span class="n">real_width</span> <span class="o">=</span> <span class="n">summ</span><span class="o">/</span><span class="mi">1074</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The average real width of the vehicles in the training dataset is&quot;</span><span class="p">,</span><span class="n">real_width</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The average real width of the vehicles in the training dataset is 2.154184483121644
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="evaluation">
<h1>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this headline">¶</a></h1>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Evaluate the results by comparing the output position value with the position value in the annotations. We can get the mean absolute error of the distance.

It performs well on most of images. However, there is still room for improvement.

Future improvement
    ·In the case of bad light, some vehicles cannot be detected.
    ·Sometimes, the bounding boxes are a bit too large, resulting in inaccurate measurement of the distance
    ·We only consider the width of the vehicles, but actually in the images, Some cars were photographed sideways.
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sum_x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">sum_y</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">no_detection</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">real_width</span> <span class="o">=</span> <span class="mf">2.154184483121644</span>
<span class="c1"># real_width = 1.8</span>
<span class="n">focal_length</span> <span class="o">=</span> <span class="p">(</span><span class="mf">714.1526</span> <span class="o">+</span> <span class="mf">710.3725</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">cx</span> <span class="o">=</span> <span class="mf">713.85</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1075</span><span class="p">):</span>
    <span class="n">gt</span> <span class="o">=</span> <span class="n">get_position</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;clips&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s2">&quot;imgs/040.jpg&quot;</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="c1"># SSD network on image.</span>
    <span class="n">rclasses</span><span class="p">,</span> <span class="n">rscores</span><span class="p">,</span> <span class="n">rbboxes</span> <span class="o">=</span> <span class="n">ssd_process_image</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">select_threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="c1"># Draw bboxes of detected objects.</span>
    <span class="n">img_bboxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">bboxes_draw_on_img</span><span class="p">(</span><span class="n">img_bboxes</span><span class="p">,</span> <span class="n">rscores</span><span class="p">,</span> <span class="n">rbboxes</span><span class="p">,</span> <span class="n">colors_tableau</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">show_text</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Apply Non-Maximum-Selection</span>
    <span class="n">nms_threshold</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">rclasses_nms</span><span class="p">,</span> <span class="n">rscores_nms</span><span class="p">,</span> <span class="n">rbboxes_nms</span> <span class="o">=</span> <span class="n">bboxes_nms_intersection_avg</span><span class="p">(</span><span class="n">rclasses</span><span class="p">,</span> <span class="n">rscores</span><span class="p">,</span> <span class="n">rbboxes</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">nms_threshold</span><span class="p">)</span>
    <span class="c1"># Get the bbox value</span>
    <span class="n">output_bbox</span> <span class="o">=</span> <span class="n">bboxes_convert</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">rbboxes_nms</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">w0</span><span class="p">,</span><span class="n">h0</span><span class="p">,</span><span class="n">position_x</span><span class="p">,</span> <span class="n">position_y</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">:</span>
        <span class="n">tmp_x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tmp_y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_bbox</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">output_bbox</span><span class="p">:</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
                <span class="n">x3</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">x1</span><span class="p">)</span>
                <span class="n">y3</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span><span class="n">y1</span><span class="p">)</span>
                <span class="n">x4</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">w0</span><span class="p">,</span><span class="n">x1</span><span class="o">+</span><span class="n">w</span><span class="p">)</span>
                <span class="n">y4</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y0</span><span class="o">+</span><span class="n">h0</span><span class="p">,</span><span class="n">y1</span><span class="o">+</span><span class="n">h</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x3</span> <span class="o">&gt;=</span> <span class="n">x4</span> <span class="ow">or</span> <span class="n">y3</span> <span class="o">&gt;=</span> <span class="n">y4</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pixel_width</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
                    <span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="n">focal_length</span> <span class="o">*</span> <span class="n">real_width</span> <span class="o">/</span> <span class="n">pixel_width</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">*</span>  <span class="p">(</span><span class="n">avg</span> <span class="o">-</span> <span class="n">cx</span><span class="p">)</span> <span class="o">/</span> <span class="n">focal_length</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">distance</span> <span class="o">-</span> <span class="n">position_x</span><span class="p">)</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="n">position_y</span><span class="p">)</span>
<span class="c1">#                     tmp_x.append(x)</span>
<span class="c1">#                     tmp_y.append(y)</span>
                    <span class="n">length</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">sum_y</span> <span class="o">+=</span> <span class="n">y</span>
                    <span class="n">sum_x</span> <span class="o">+=</span> <span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">no_detection</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean absolute error depth:&quot;</span><span class="p">,</span> <span class="n">sum_x</span><span class="o">/</span><span class="n">length</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean absolute error horizontal displacement:&quot;</span><span class="p">,</span> <span class="n">sum_y</span><span class="o">/</span><span class="n">length</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No vehicle detected images:&quot;</span><span class="p">,</span><span class="n">no_detection</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean absolute error depth: 7.964742459359323
Mean absolute error horizontal displacement: 0.8507224104033045
No vehicle detected images: 71
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./ds-courses/unsw/9517"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="9517-lane_detection.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Lane detection</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../9444/9444-intro.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Deep Learning (UNSW)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Jerry<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>