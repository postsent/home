
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Crypto Prediction &#8212; My AI Notebook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=c1a6f12f" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=949a1ff5" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=ff8fa330"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=97881d71"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ml/regression/p1-crypto-prediction';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Course Enrolment Scrapter" href="../../side-project/web-scrapter.html" />
    <link rel="prev" title="Time series report" href="../../ds-courses/unsw/9418/9418-project/report.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">My AI Notebook</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">About</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://postsent.github.io/home/">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">Acknowledgement</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Research</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../research/polyu/dp/report.html">Data Pruning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../research/polyu/dd/report.html">Dataset Distillation</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../research/polyu/story/page.html">DD Motivation</a></li>







<li class="toctree-l1"><a class="reference internal" href="../../research/nas/doc.html">NAS</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Courses</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ds-courses/unsw/9417/9417-intro.html">Machine Learning (UNSW)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/9417/9417-project.html">Project - Classification</a></li>








<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/9417/9417-report/report.html">Project - report</a></li>







<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/9417/9417-basic.html">Basic with examples</a></li>







</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ds-courses/unsw/3900/3900-intro.html">Capstone (UNSW)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/3900/project/3900-project.html"><strong>Chatbot</strong></a></li>






</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ds-courses/unsw/3431/3431-intro.html">ROS &amp; CV (UNSW)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/3431/project/project.html">Mini self-driving</a></li>









<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/ros/doc.html">ROS</a></li>

</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ds-courses/usyd/5046/5046-intro.html">NLP (USYD)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5046/a2/a2.html">Report - In-game Toxicity Detection</a></li>







<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5046/a2.html">In Game Toxicity seq2seq classification</a></li>





<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5046/a1.html">Binary text classification</a></li>






</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ds-courses/unsw/9517/9517-intro.html">Computer Vision (UNSW)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/9517/9517-a1-code.html">Basic image processing, thresholding, count cells</a></li>



<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/9517/9517-a1/report.html">Report on Basic image processing, etc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/9517/9517-lane_detection.html">Lane detection</a></li>





<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/9517/9517-vehicle-detection.html">Vehicle detection (by teammate)</a></li>




</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ds-courses/unsw/9444/9444-intro.html">Deep Learning (UNSW)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/9444/9444-project.html">Image classification</a></li>








<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/9444/assignment1/assignment1.html">Characters, Spirals and Hidden Unit Dynamics</a></li>



















</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ds-courses/usyd/5349/5349-intro.html">Cloud Computing (USYD)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5349/a2/a2.html">Data Preprocessing and Performance Tuning with Spark</a></li>









<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5349/a2.html">Data Preprocessing and Performance Tuning with Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5349/a1.html">Text Analysis with Spark RDD API</a></li>



<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5349/a1-report.html">Report – Text Analysis with Spark RDD API</a></li>






</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ds-courses/usyd/5338/5338-intro.html">NoSQL &amp; Neo4j (USYD)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5338/a1.html">NoSQL basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5338/a2.html">NoSQL Aggregation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5338/a2-report/report.html"><strong>Performance Observation Task</strong></a></li>





<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5338/a3.html">Neo4j Basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5338/a4.html">Neo4j Query</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ds-courses/usyd/5048/5048-intro.html">Visual Analytics (USYD)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5048/individual.html">Individual Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5048/group.html">Group Report (My part)</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ds-courses/usyd/5328/5328-intro.html">Advance ML (USYD)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5328/a1.html">NMF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/usyd/5328/a2.html">Label Noise Learning</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ds-courses/unsw/9418/9418-intro.html">PGM (UNSW)</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/9418/9418-EDA.html">EDA on Times Series Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/9418/9418-project.html">Time series project code</a></li>






<li class="toctree-l2"><a class="reference internal" href="../../ds-courses/unsw/9418/9418-project/report.html">Time series report</a></li>





</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Projects</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Crypto Prediction</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../side-project/web-scrapter.html">Course Enrolment Scrapter</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../unfinished/pytorch-nlp-bk/nlp-book.html">NLP Book</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../unfinished/pytorch-nlp-bk/intro.html">Intro</a></li>













<li class="toctree-l2"><a class="reference internal" href="../../unfinished/pytorch-nlp-bk/nn.html">Feed-Forward Networks for NLP</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../unfinished/pytorch-nlp-bk/prac-ch3.html">Chapter 3</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../unfinished/jigsaw-intro.html">Jigsaw</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../unfinished/jiagsaw-toxic-comment-serverity-rate/README.html">Folder Structure</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../unfinished/jiagsaw-toxic-comment-serverity-rate/notebooks/simple-rnn.html">Simple</a></li>













<li class="toctree-l2"><a class="reference internal" href="../../unfinished/jiagsaw-toxic-comment-serverity-rate/notebooks/lstm.html">Upgrade RNN</a></li>



<li class="toctree-l2"><a class="reference internal" href="../../unfinished/jiagsaw-toxic-comment-serverity-rate/notebooks/helper.html">Common</a></li>

</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Misc</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../dl/dl.html">DL General</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../misc/math.html">Math</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../misc/misc.html">Misc</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Coding Basic</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../python/basic-intro.html">Numpy, Pandas, Python</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../python/numpy.html">Numpy</a></li>





<li class="toctree-l2"><a class="reference internal" href="../../python/pandas.html">Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../python/leetcode.html">Leetcode</a></li>








</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/postsent/home/main?urlpath=tree/docs/ml/regression/p1-crypto-prediction.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/postsent/home" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/ml/regression/p1-crypto-prediction.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Crypto Prediction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Crypto Prediction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#todo">TODO</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#final">Final</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-processing">Pre-processing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delete">delete</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#isoforest">isoforest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#x-delete">x_delete</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#x-train">x_train</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#standardised-bad">standardised (bad)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#robust-scaler-bad-result">robust scaler (bad result)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-nans-zeros-trial">remove nans,zeros trial</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-half-zeros">remove half zeros</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#iso-forest-on-x-delete">iso forest on X_delete</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imputation">imputation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#univariate-bad-result">univariate (bad result)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multivariate">multivariate</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-numpy-to-pandas">convert numpy to pandas</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#knn-imputer-bad-result">Knn imputer (bad result)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#log-transform">Log transform</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection">feature selection</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#featureagglomeration">FeatureAgglomeration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iso">iso</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluate-the-model">evaluate the model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#submission">submission</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bayeisan-regressor">bayeisan regressor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-features">add features</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importance">importance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#submit">submit</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test">test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#formal">formal</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#used-on-x-train-instead-of-x-delete-as-above">used on X_train instead of X_delete as above</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#param-tuning">param tuning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression">linear regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autosklearn">autosklearn</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#save-result">save result</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="crypto-prediction">
<h1>Crypto Prediction<a class="headerlink" href="#crypto-prediction" title="Link to this heading">#</a></h1>
<p>Cryptocurrency Closing Price Prediction: <a class="reference external" href="https://zindi.africa/competitions/cryptocurrency-closing-price-prediction">https://zindi.africa/competitions/cryptocurrency-closing-price-prediction</a></p>
<p>Cryptocurrencies are increasingly viewed as investment assets, necessitating accurate price predictions due to their volatility. This project aims to enhance price forecasting using machine learning techniques that analyze both quantitative (trading time series) and qualitative data (social media sentiment, news).</p>
<p>The goal is to develop models that predict cryptocurrency prices based on hourly data collected over a year, optimizing them to achieve a specified Root Mean Square Error (RMSE) threshold. Participants are encouraged to use various algorithms, including Neural Networks, to create highly accurate models that surpass validation benchmarks, ultimately aiding better investment decisions in the cryptocurrency market.</p>
<p>Question</p>
<ol class="arabic simple">
<li><p>how to handle missing value?</p></li>
</ol>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="todo">
<h1>TODO<a class="headerlink" href="#todo" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># impute non zero y</span>
<span class="c1"># tune ICA</span>
</pre></div>
</div>
</div>
</div>
<p>#Notes</p>
<ol class="arabic simple">
<li><p>This is a regression / prediction problem</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># gpu_info = !nvidia-smi</span>
<span class="c1"># gpu_info = &#39;\n&#39;.join(gpu_info)</span>
<span class="c1"># if gpu_info.find(&#39;failed&#39;) &gt;= 0:</span>
<span class="c1">#   print(&#39;Not connected to a GPU&#39;)</span>
<span class="c1"># else:</span>
<span class="c1">#   print(gpu_info)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # # # Load the Drive helper and mount</span>
<span class="c1"># from google.colab import drive</span>
<span class="c1"># drive.mount(&#39;/content/drive&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!unzip &quot;/content/drive/My Drive/crypto_prediction/data.zip&quot; -d &quot;/content&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import libraries</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">files</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load files</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Train.csv&#39;</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Test.csv&#39;</span><span class="p">)</span>
<span class="n">ss</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;SampleSubmission.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check data shapes</span>
<span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">ss</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((12632, 49), (6222, 48), (6222, 2))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Preview train</span>
<span class="n">train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>asset_id</th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>market_cap</th>
      <th>url_shares</th>
      <th>unique_url_shares</th>
      <th>reddit_posts</th>
      <th>reddit_posts_score</th>
      <th>reddit_comments</th>
      <th>reddit_comments_score</th>
      <th>tweets</th>
      <th>tweet_spam</th>
      <th>tweet_followers</th>
      <th>tweet_quotes</th>
      <th>tweet_retweets</th>
      <th>tweet_replies</th>
      <th>tweet_favorites</th>
      <th>tweet_sentiment1</th>
      <th>tweet_sentiment2</th>
      <th>tweet_sentiment3</th>
      <th>tweet_sentiment4</th>
      <th>tweet_sentiment5</th>
      <th>tweet_sentiment_impact1</th>
      <th>tweet_sentiment_impact2</th>
      <th>tweet_sentiment_impact3</th>
      <th>tweet_sentiment_impact4</th>
      <th>tweet_sentiment_impact5</th>
      <th>social_score</th>
      <th>average_sentiment</th>
      <th>news</th>
      <th>price_score</th>
      <th>social_impact_score</th>
      <th>correlation_rank</th>
      <th>galaxy_score</th>
      <th>volatility</th>
      <th>market_cap_rank</th>
      <th>percent_change_24h_rank</th>
      <th>volume_24h_rank</th>
      <th>social_volume_24h_rank</th>
      <th>social_score_24h_rank</th>
      <th>medium</th>
      <th>youtube</th>
      <th>social_volume</th>
      <th>percent_change_24h</th>
      <th>market_cap_global</th>
      <th>close</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ID_322qz6</td>
      <td>1</td>
      <td>9422.849081</td>
      <td>9428.490628</td>
      <td>9422.849081</td>
      <td>7.131986e+08</td>
      <td>1.737635e+11</td>
      <td>1689.0</td>
      <td>817.0</td>
      <td>55.0</td>
      <td>105.0</td>
      <td>61.0</td>
      <td>271.0</td>
      <td>3420.0</td>
      <td>1671.0</td>
      <td>11675867.0</td>
      <td>39.0</td>
      <td>1343.0</td>
      <td>448.0</td>
      <td>2237.0</td>
      <td>124.0</td>
      <td>330.0</td>
      <td>331.0</td>
      <td>2515.0</td>
      <td>120.0</td>
      <td>506133.0</td>
      <td>1326610.0</td>
      <td>1159677.0</td>
      <td>8406185.0</td>
      <td>281329.0</td>
      <td>11681999.0</td>
      <td>3.6</td>
      <td>69.0</td>
      <td>2.7</td>
      <td>3.6</td>
      <td>3.3</td>
      <td>66.0</td>
      <td>0.007118</td>
      <td>1.0</td>
      <td>606.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4422</td>
      <td>1.434516</td>
      <td>2.818066e+11</td>
      <td>9428.279323</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ID_3239o9</td>
      <td>1</td>
      <td>7985.359278</td>
      <td>7992.059917</td>
      <td>7967.567267</td>
      <td>4.004755e+08</td>
      <td>1.426942e+11</td>
      <td>920.0</td>
      <td>544.0</td>
      <td>20.0</td>
      <td>531.0</td>
      <td>103.0</td>
      <td>533.0</td>
      <td>1491.0</td>
      <td>242.0</td>
      <td>5917814.0</td>
      <td>195.0</td>
      <td>1070.0</td>
      <td>671.0</td>
      <td>3888.0</td>
      <td>1.0</td>
      <td>52.0</td>
      <td>315.0</td>
      <td>1100.0</td>
      <td>23.0</td>
      <td>1320.0</td>
      <td>381117.0</td>
      <td>1706376.0</td>
      <td>3754815.0</td>
      <td>80010.0</td>
      <td>5924770.0</td>
      <td>3.7</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>43.5</td>
      <td>0.009419</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2159</td>
      <td>-2.459507</td>
      <td>2.126897e+11</td>
      <td>7967.567267</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ID_323J9k</td>
      <td>1</td>
      <td>49202.033778</td>
      <td>49394.593518</td>
      <td>49068.057046</td>
      <td>3.017729e+09</td>
      <td>9.166977e+11</td>
      <td>1446.0</td>
      <td>975.0</td>
      <td>72.0</td>
      <td>1152.0</td>
      <td>187.0</td>
      <td>905.0</td>
      <td>9346.0</td>
      <td>4013.0</td>
      <td>47778746.0</td>
      <td>104.0</td>
      <td>2014.0</td>
      <td>1099.0</td>
      <td>11476.0</td>
      <td>331.0</td>
      <td>923.0</td>
      <td>864.0</td>
      <td>6786.0</td>
      <td>442.0</td>
      <td>9848462.0</td>
      <td>5178557.0</td>
      <td>2145663.0</td>
      <td>25510267.0</td>
      <td>5110490.0</td>
      <td>47796942.0</td>
      <td>3.7</td>
      <td>22.0</td>
      <td>3.1</td>
      <td>3.0</td>
      <td>3.3</td>
      <td>65.5</td>
      <td>0.013530</td>
      <td>1.0</td>
      <td>692.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>10602</td>
      <td>4.942448</td>
      <td>1.530712e+12</td>
      <td>49120.738484</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ID_323y5P</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>17.0</td>
      <td>424.0</td>
      <td>268.0</td>
      <td>443.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>285</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ID_324kJH</td>
      <td>1</td>
      <td>10535.737119</td>
      <td>10535.737119</td>
      <td>10384.798216</td>
      <td>1.150053e+09</td>
      <td>1.921183e+11</td>
      <td>1012.0</td>
      <td>638.0</td>
      <td>24.0</td>
      <td>42.0</td>
      <td>50.0</td>
      <td>173.0</td>
      <td>3262.0</td>
      <td>1652.0</td>
      <td>14422172.0</td>
      <td>21.0</td>
      <td>511.0</td>
      <td>190.0</td>
      <td>2284.0</td>
      <td>86.0</td>
      <td>280.0</td>
      <td>443.0</td>
      <td>2284.0</td>
      <td>169.0</td>
      <td>311017.0</td>
      <td>1977833.0</td>
      <td>731277.0</td>
      <td>10964321.0</td>
      <td>440730.0</td>
      <td>14426405.0</td>
      <td>3.7</td>
      <td>22.0</td>
      <td>4.7</td>
      <td>3.8</td>
      <td>4.4</td>
      <td>83.0</td>
      <td>0.010332</td>
      <td>1.0</td>
      <td>749.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>2.0</td>
      <td>3996</td>
      <td>2.609576</td>
      <td>3.386925e+11</td>
      <td>10384.798216</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>asset_id</th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>market_cap</th>
      <th>url_shares</th>
      <th>unique_url_shares</th>
      <th>reddit_posts</th>
      <th>reddit_posts_score</th>
      <th>reddit_comments</th>
      <th>reddit_comments_score</th>
      <th>tweets</th>
      <th>tweet_spam</th>
      <th>tweet_followers</th>
      <th>tweet_quotes</th>
      <th>tweet_retweets</th>
      <th>tweet_replies</th>
      <th>tweet_favorites</th>
      <th>tweet_sentiment1</th>
      <th>tweet_sentiment2</th>
      <th>tweet_sentiment3</th>
      <th>tweet_sentiment4</th>
      <th>tweet_sentiment5</th>
      <th>tweet_sentiment_impact1</th>
      <th>tweet_sentiment_impact2</th>
      <th>tweet_sentiment_impact3</th>
      <th>tweet_sentiment_impact4</th>
      <th>tweet_sentiment_impact5</th>
      <th>social_score</th>
      <th>average_sentiment</th>
      <th>news</th>
      <th>price_score</th>
      <th>social_impact_score</th>
      <th>correlation_rank</th>
      <th>galaxy_score</th>
      <th>volatility</th>
      <th>market_cap_rank</th>
      <th>percent_change_24h_rank</th>
      <th>volume_24h_rank</th>
      <th>social_volume_24h_rank</th>
      <th>social_score_24h_rank</th>
      <th>medium</th>
      <th>youtube</th>
      <th>social_volume</th>
      <th>percent_change_24h</th>
      <th>market_cap_global</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ID_323Sn2</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.0</td>
      <td>56.0</td>
      <td>2.0</td>
      <td>11.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>9</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ID_325SNW</td>
      <td>1</td>
      <td>11335.062188</td>
      <td>11351.690956</td>
      <td>11335.062188</td>
      <td>1.064152e+09</td>
      <td>2.101463e+11</td>
      <td>1664.0</td>
      <td>1045.0</td>
      <td>64.0</td>
      <td>213.0</td>
      <td>51.0</td>
      <td>274.0</td>
      <td>6046.0</td>
      <td>3034.0</td>
      <td>23453171.0</td>
      <td>119.0</td>
      <td>2305.0</td>
      <td>1367.0</td>
      <td>6252.0</td>
      <td>151.0</td>
      <td>565.0</td>
      <td>603.0</td>
      <td>4553.0</td>
      <td>174.0</td>
      <td>2900568.0</td>
      <td>1898920.0</td>
      <td>2268741.0</td>
      <td>14056214.0</td>
      <td>2338771.0</td>
      <td>23465365.0</td>
      <td>3.7</td>
      <td>39.0</td>
      <td>3.2</td>
      <td>3.4</td>
      <td>2.8</td>
      <td>65.5</td>
      <td>0.004407</td>
      <td>1.0</td>
      <td>711.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>7245</td>
      <td>-0.555698</td>
      <td>3.631052e+11</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ID_325uzE</td>
      <td>1</td>
      <td>6322.560756</td>
      <td>6328.362354</td>
      <td>6294.714484</td>
      <td>1.516268e+09</td>
      <td>1.153862e+11</td>
      <td>397.0</td>
      <td>255.0</td>
      <td>11.0</td>
      <td>72.0</td>
      <td>30.0</td>
      <td>112.0</td>
      <td>2404.0</td>
      <td>304.0</td>
      <td>3831278.0</td>
      <td>12.0</td>
      <td>346.0</td>
      <td>73.0</td>
      <td>604.0</td>
      <td>39.0</td>
      <td>103.0</td>
      <td>668.0</td>
      <td>1406.0</td>
      <td>188.0</td>
      <td>29147.0</td>
      <td>411178.0</td>
      <td>873284.0</td>
      <td>2389256.0</td>
      <td>129448.0</td>
      <td>3832828.0</td>
      <td>3.7</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.4</td>
      <td>65.5</td>
      <td>0.024035</td>
      <td>1.0</td>
      <td>715.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2702</td>
      <td>1.689370</td>
      <td>1.771075e+11</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ID_328qCx</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>96.0</td>
      <td>217.0</td>
      <td>244.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>225</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ID_3293uJ</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>26.0</td>
      <td>49.0</td>
      <td>33.0</td>
      <td>38.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>59</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>close</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ID_323Sn2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ID_325SNW</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ID_325uzE</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ID_328qCx</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ID_3293uJ</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if there any missing values in train set</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Percentage of Missing Values Per Column in Train Set&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">})</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
    <span class="n">percentage</span> <span class="o">=</span><span class="s1">&#39;</span><span class="si">{:,.0f}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_width</span><span class="p">(),</span><span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
    <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">+</span><span class="n">width</span><span class="o">+</span><span class="mf">0.02</span>
    <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_y</span><span class="p">()</span><span class="o">+</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">percentage</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5db5fe977d3b2f93d5aad8f6c38b56564b71324e32696bf1a3a06cabbcc7b388.png" src="../../_images/5db5fe977d3b2f93d5aad8f6c38b56564b71324e32696bf1a3a06cabbcc7b388.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if there missing values in test set</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Percentage of Missing Values Per Column in Test Set&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">})</span>

<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
    <span class="n">percentage</span> <span class="o">=</span><span class="s1">&#39;</span><span class="si">{:,.1f}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_width</span><span class="p">(),</span><span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
    <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">+</span><span class="n">width</span><span class="o">+</span><span class="mf">0.02</span>
    <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_y</span><span class="p">()</span><span class="o">+</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">percentage</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/141ba3566fe8534eabb5fa6ba16be150205b2b4ef06e97754a6feaa6dd71d937.png" src="../../_images/141ba3566fe8534eabb5fa6ba16be150205b2b4ef06e97754a6feaa6dd71d937.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fill missing values</span>
<span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>asset_id</th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>volume</th>
      <th>market_cap</th>
      <th>url_shares</th>
      <th>unique_url_shares</th>
      <th>reddit_posts</th>
      <th>reddit_posts_score</th>
      <th>reddit_comments</th>
      <th>reddit_comments_score</th>
      <th>tweets</th>
      <th>tweet_spam</th>
      <th>tweet_followers</th>
      <th>tweet_quotes</th>
      <th>tweet_retweets</th>
      <th>tweet_replies</th>
      <th>tweet_favorites</th>
      <th>tweet_sentiment1</th>
      <th>tweet_sentiment2</th>
      <th>tweet_sentiment3</th>
      <th>tweet_sentiment4</th>
      <th>tweet_sentiment5</th>
      <th>tweet_sentiment_impact1</th>
      <th>tweet_sentiment_impact2</th>
      <th>tweet_sentiment_impact3</th>
      <th>tweet_sentiment_impact4</th>
      <th>tweet_sentiment_impact5</th>
      <th>social_score</th>
      <th>average_sentiment</th>
      <th>news</th>
      <th>price_score</th>
      <th>social_impact_score</th>
      <th>correlation_rank</th>
      <th>galaxy_score</th>
      <th>volatility</th>
      <th>market_cap_rank</th>
      <th>percent_change_24h_rank</th>
      <th>volume_24h_rank</th>
      <th>social_volume_24h_rank</th>
      <th>social_score_24h_rank</th>
      <th>medium</th>
      <th>youtube</th>
      <th>social_volume</th>
      <th>percent_change_24h</th>
      <th>market_cap_global</th>
      <th>close</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ID_322qz6</td>
      <td>1</td>
      <td>9422.849081</td>
      <td>9428.490628</td>
      <td>9422.849081</td>
      <td>7.131986e+08</td>
      <td>1.737635e+11</td>
      <td>1689.0</td>
      <td>817.0</td>
      <td>55.0</td>
      <td>105.0</td>
      <td>61.0</td>
      <td>271.0</td>
      <td>3420.0</td>
      <td>1671.0</td>
      <td>11675867.0</td>
      <td>39.0</td>
      <td>1343.0</td>
      <td>448.0</td>
      <td>2237.0</td>
      <td>124.0</td>
      <td>330.0</td>
      <td>331.0</td>
      <td>2515.0</td>
      <td>120.0</td>
      <td>506133.0</td>
      <td>1326610.0</td>
      <td>1159677.0</td>
      <td>8406185.0</td>
      <td>281329.0</td>
      <td>11681999.0</td>
      <td>3.6</td>
      <td>69.0</td>
      <td>2.7</td>
      <td>3.6</td>
      <td>3.3</td>
      <td>66.0</td>
      <td>0.007118</td>
      <td>1.0</td>
      <td>606.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>4422</td>
      <td>1.434516</td>
      <td>2.818066e+11</td>
      <td>9428.279323</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ID_3239o9</td>
      <td>1</td>
      <td>7985.359278</td>
      <td>7992.059917</td>
      <td>7967.567267</td>
      <td>4.004755e+08</td>
      <td>1.426942e+11</td>
      <td>920.0</td>
      <td>544.0</td>
      <td>20.0</td>
      <td>531.0</td>
      <td>103.0</td>
      <td>533.0</td>
      <td>1491.0</td>
      <td>242.0</td>
      <td>5917814.0</td>
      <td>195.0</td>
      <td>1070.0</td>
      <td>671.0</td>
      <td>3888.0</td>
      <td>1.0</td>
      <td>52.0</td>
      <td>315.0</td>
      <td>1100.0</td>
      <td>23.0</td>
      <td>1320.0</td>
      <td>381117.0</td>
      <td>1706376.0</td>
      <td>3754815.0</td>
      <td>80010.0</td>
      <td>5924770.0</td>
      <td>3.7</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>43.5</td>
      <td>0.009419</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2159</td>
      <td>-2.459507</td>
      <td>2.126897e+11</td>
      <td>7967.567267</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ID_323J9k</td>
      <td>1</td>
      <td>49202.033778</td>
      <td>49394.593518</td>
      <td>49068.057046</td>
      <td>3.017729e+09</td>
      <td>9.166977e+11</td>
      <td>1446.0</td>
      <td>975.0</td>
      <td>72.0</td>
      <td>1152.0</td>
      <td>187.0</td>
      <td>905.0</td>
      <td>9346.0</td>
      <td>4013.0</td>
      <td>47778746.0</td>
      <td>104.0</td>
      <td>2014.0</td>
      <td>1099.0</td>
      <td>11476.0</td>
      <td>331.0</td>
      <td>923.0</td>
      <td>864.0</td>
      <td>6786.0</td>
      <td>442.0</td>
      <td>9848462.0</td>
      <td>5178557.0</td>
      <td>2145663.0</td>
      <td>25510267.0</td>
      <td>5110490.0</td>
      <td>47796942.0</td>
      <td>3.7</td>
      <td>22.0</td>
      <td>3.1</td>
      <td>3.0</td>
      <td>3.3</td>
      <td>65.5</td>
      <td>0.013530</td>
      <td>1.0</td>
      <td>692.0</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>10602</td>
      <td>4.942448</td>
      <td>1.530712e+12</td>
      <td>49120.738484</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ID_323y5P</td>
      <td>1</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>17.0</td>
      <td>424.0</td>
      <td>268.0</td>
      <td>443.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>285</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ID_324kJH</td>
      <td>1</td>
      <td>10535.737119</td>
      <td>10535.737119</td>
      <td>10384.798216</td>
      <td>1.150053e+09</td>
      <td>1.921183e+11</td>
      <td>1012.0</td>
      <td>638.0</td>
      <td>24.0</td>
      <td>42.0</td>
      <td>50.0</td>
      <td>173.0</td>
      <td>3262.0</td>
      <td>1652.0</td>
      <td>14422172.0</td>
      <td>21.0</td>
      <td>511.0</td>
      <td>190.0</td>
      <td>2284.0</td>
      <td>86.0</td>
      <td>280.0</td>
      <td>443.0</td>
      <td>2284.0</td>
      <td>169.0</td>
      <td>311017.0</td>
      <td>1977833.0</td>
      <td>731277.0</td>
      <td>10964321.0</td>
      <td>440730.0</td>
      <td>14426405.0</td>
      <td>3.7</td>
      <td>22.0</td>
      <td>4.7</td>
      <td>3.8</td>
      <td>4.4</td>
      <td>83.0</td>
      <td>0.010332</td>
      <td>1.0</td>
      <td>749.0</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>3996</td>
      <td>2.609576</td>
      <td>3.386925e+11</td>
      <td>10384.798216</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check for duplicates</span>
<span class="n">train</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(),</span> <span class="n">test</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(False, False)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SEED</span> <span class="o">=</span> <span class="mi">23</span>
<span class="c1"># Select main columns to be used in training</span>
<span class="n">main_cols</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">difference</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">,</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="s1">&#39;asset_id&#39;</span><span class="p">,</span> <span class="s1">&#39;social_volume_24h_rank&#39;</span><span class="p">,</span> <span class="s1">&#39;volume_24h_rank&#39;</span><span class="p">,</span> <span class="s1">&#39;market_cap_rank&#39;</span><span class="p">,</span> <span class="s1">&#39;social_score_24h_rank&#39;</span><span class="p">,</span> <span class="s1">&#39;tweet_followers&#39;</span><span class="p">])</span> <span class="c1"># assert_id exclude since all 1, volatility, &#39;youtube&#39;, </span>

<span class="n">X</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">main_cols</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># Split data into train and test sets</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="final">
<h1>Final<a class="headerlink" href="#final" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RepeatedKFold</span>

<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">ExtraTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>


<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># y_cleaned = y_train[y_train != 0]</span>
<span class="c1"># y_cleaned.index</span>
<span class="c1"># X_cleaned = X_train[X_train.index.isin(list(y_cleaned.index))]</span>
<span class="c1"># print(X_cleaned.shape)</span>
<span class="c1"># print(y_cleaned.shape)</span>
<span class="c1"># y_test_cleaned = y_test[y_test != 0]</span>
<span class="c1"># X_test_cleaned = X_test[X_test.index.isin(list(y_test_cleaned.index))]</span>
<span class="c1"># print(X_test_cleaned.shape)</span>
<span class="c1"># print(y_test_cleaned.shape)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(7774, 45)
(7774,)
(843, 45)
(843,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># used on X_train instead of X_delete as above</span>

<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">IsolationForest</span>

<span class="n">iso</span> <span class="o">=</span> <span class="n">IsolationForest</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">contamination</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">iso</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_train_cleaned</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
<span class="n">y_train_cleaned</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>

<span class="c1"># summarize the shape of the updated training dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train_cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train_cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">cleaned</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">X_train_cleaned</span><span class="o">.</span><span class="n">shape</span>

<span class="n">total</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of outlier row removed: &quot;</span><span class="p">,</span> <span class="n">total</span> <span class="o">-</span> <span class="n">cleaned</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;percentage of outliers removed: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">total</span><span class="o">-</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(11254, 45) (11254,)
number of outlier row removed:  114
percentage of outliers removed:  0.010028149190710767
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#submission</span>
<span class="n">ridge_rg</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>

<span class="c1">#ridge_rg.fit(X_train_cleaned, y_train_cleaned) # 81</span>

<span class="n">ridge_rg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> <span class="c1"># 77</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">ridge_rg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1">#ridge_rg.fit(X_delete_cleaned, y_delete_cleaned) # 81</span>
<span class="c1">#ridge_rg.fit(X_reduced, y_delete)x # 81</span>
<span class="c1">#y_pred = ridge_rg.predict(X_test_reduced)</span>

<span class="c1">#y_pred = ridge_rg.predict(X_test_imputed)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.7/dist-packages/sklearn/linear_model/_ridge.py:148: LinAlgWarning: Ill-conditioned matrix (rcond=2.94201e-28): result may not be accurate.
  overwrite_a=True).T
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>55.8501606006677
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># evaluate the model</span>

<span class="n">ridge_rg</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>

<span class="n">cv</span> <span class="o">=</span> <span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
<span class="c1">#n_scores = cross_val_score(ridge_rg, X_train, y_train, scoring=&#39;neg_root_mean_squared_error&#39;, cv=cv, n_jobs=-1, error_score=&#39;raise&#39;)</span>
<span class="n">n_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">X_cleaned</span><span class="p">,</span> <span class="n">y_cleaned</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">error_score</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE: </span><span class="si">%.3f</span><span class="s1"> (</span><span class="si">%.3f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">n_scores</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">n_scores</span><span class="p">)))</span> <span class="c1"># [&#39;id&#39;, &#39;close&#39;, &#39;asset_id&#39;] -&gt; RMSE: -61.251 (11.243)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: -67.142 (13.430)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># evaluate the model</span>

<span class="n">ext</span> <span class="o">=</span> <span class="n">ExtraTreesRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">130</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">39</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># 39-&gt;RMSE: -56.458 (8.914)</span>


<span class="n">cv</span> <span class="o">=</span> <span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">n_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">error_score</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
<span class="c1">#n_scores = cross_val_score(ext, X_cleaned, y_cleaned, scoring=&#39;neg_root_mean_squared_error&#39;, cv=cv, n_jobs=-1, error_score=&#39;raise&#39;)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE: </span><span class="si">%.3f</span><span class="s1"> (</span><span class="si">%.3f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">n_scores</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">n_scores</span><span class="p">)))</span> <span class="c1"># [&#39;id&#39;, &#39;close&#39;, &#39;asset_id&#39;] -&gt; RMSE: -61.251 (11.243)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: -56.201 (8.062)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fit_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_given</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_given</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">X_test_given</span><span class="o">=</span><span class="n">X_test</span><span class="p">):</span>
    <span class="c1"># # Fit Model</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_given</span><span class="p">,</span> <span class="n">y_given</span><span class="p">)</span>
    <span class="c1"># Predict</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_given</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">ExtraTreesRegressor</span>

<span class="n">ext</span> <span class="o">=</span> <span class="n">ExtraTreesRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">130</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">39</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  

<span class="n">fit_model</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">)</span><span class="c1"># 59.632469543757274</span>

<span class="c1">#fit_model(ext, X_cleaned, y_cleaned, X_test)</span>
<span class="c1">#fit_model(ext, X_delete, y_delete)</span>
<span class="c1"># 83</span>
<span class="c1">#fit_model(ext, X_train_scaled, y_train, X_test_scaled) #worse</span>
<span class="c1">#fit_model(ext, X_train_imp_mean, y_train, X_test_imp_mean) 137.67830689850263</span>
<span class="c1">#fit_model(ext, X_reduced, y_train, X_test_reduced)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>59.632469543757274
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-35-9cfad293a4d2&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">fit_model</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">)</span><span class="c1"># 59.632469543757274</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> 
<span class="ne">----&gt; </span><span class="mi">8</span> <span class="n">fit_model</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">X_cleaned</span><span class="p">,</span> <span class="n">y_cleaned</span><span class="p">,</span> <span class="n">X_test</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="c1">#fit_model(ext, X_delete, y_delete)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="c1"># 83</span>

<span class="nn">&lt;ipython-input-19-03d0bfdbf8fc&gt;</span> in <span class="ni">fit_model</span><span class="nt">(model, X_given, y_given, X_test_given)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_given</span><span class="p">,</span> <span class="n">y_given</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="c1"># Predict</span>
<span class="ne">----&gt; </span><span class="mi">5</span>     <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_given</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="nb">print</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/sklearn/ensemble/_forest.py</span> in <span class="ni">predict</span><span class="nt">(self, X)</span>
<span class="g g-Whitespace">    </span><span class="mi">764</span>         <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">765</span>         <span class="c1"># Check data</span>
<span class="ne">--&gt; </span><span class="mi">766</span>         <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_X_predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">767</span> 
<span class="g g-Whitespace">    </span><span class="mi">768</span>         <span class="c1"># Assign chunk of trees to jobs</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/sklearn/ensemble/_forest.py</span> in <span class="ni">_validate_X_predict</span><span class="nt">(self, X)</span>
<span class="g g-Whitespace">    </span><span class="mi">410</span>         <span class="n">check_is_fitted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">411</span> 
<span class="ne">--&gt; </span><span class="mi">412</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimators_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_validate_X_predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">check_input</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">413</span> 
<span class="g g-Whitespace">    </span><span class="mi">414</span>     <span class="nd">@property</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/sklearn/tree/_classes.py</span> in <span class="ni">_validate_X_predict</span><span class="nt">(self, X, check_input)</span>
<span class="g g-Whitespace">    </span><span class="mi">389</span>                              <span class="s2">&quot;match the input. Model n_features is </span><span class="si">%s</span><span class="s2"> and &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">390</span>                              <span class="s2">&quot;input n_features is </span><span class="si">%s</span><span class="s2"> &quot;</span>
<span class="ne">--&gt; </span><span class="mi">391</span>                              <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features_</span><span class="p">,</span> <span class="n">n_features</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">392</span> 
<span class="g g-Whitespace">    </span><span class="mi">393</span>         <span class="k">return</span> <span class="n">X</span>

<span class="ne">ValueError</span>: Number of features of the model must match the input. Model n_features is 44 and input n_features is 45 
</pre></div>
</div>
</div>
</div>
<section id="pre-processing">
<h2>Pre-processing<a class="headerlink" href="#pre-processing" title="Link to this heading">#</a></h2>
</section>
<section id="delete">
<h2>delete<a class="headerlink" href="#delete" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span>
<span class="n">n_zeros_allow</span> <span class="o">=</span><span class="mi">39</span>  <span class="c1">#(X_train.shape[1])//6, 41, 39(77)</span>
<span class="c1">#print(&quot;number of half columns&quot;,n_zeros_th)</span>

<span class="n">X_delete</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">X_train</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_zeros_allow</span><span class="p">]</span> <span class="c1">#X_train[(X_train != 0).all(1)]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_delete</span><span class="p">))</span>
<span class="n">X_delete</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">y_delete</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">y_train</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">X_delete</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1263
864
</pre></div>
</div>
</div>
</div>
</section>
<section id="isoforest">
<h2>isoforest<a class="headerlink" href="#isoforest" title="Link to this heading">#</a></h2>
<section id="x-delete">
<h3>x_delete<a class="headerlink" href="#x-delete" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # used on X_train instead of X_delete as above</span>

<span class="c1"># from sklearn.ensemble import IsolationForest</span>
<span class="c1"># from sklearn.metrics import make_scorer, f1_score</span>
<span class="c1"># from sklearn import model_selection</span>
<span class="c1"># from sklearn.datasets import make_classification</span>

<span class="c1"># iso = IsolationForest(random_state=SEED, contamination=0.1)</span>
<span class="c1"># y_pred = iso.fit_predict(X_delete)</span>
<span class="c1"># X_delete_cleaned = X_delete[np.where(y_pred == 1, True, False)]</span>
<span class="c1"># y_delete_cleaned = y_delete[np.where(y_pred == 1, True, False)]</span>

<span class="c1"># # summarize the shape of the updated training dataset</span>
<span class="c1"># print(X_delete_cleaned.shape, y_delete_cleaned.shape)</span>
<span class="c1"># cleaned,_ = X_delete_cleaned.shape</span>

<span class="c1"># total, _ = X_delete.shape</span>
<span class="c1"># print(&quot;number of outlier row removed: &quot;, total - cleaned)</span>
<span class="c1"># print(&quot;percentage of outliers removed: &quot;, (total-cleaned) / total)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-97-907510452ecf&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> 
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">iso</span> <span class="o">=</span> <span class="n">IsolationForest</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">contamination</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">9</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">iso</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X_delete</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="n">X_delete_cleaned</span> <span class="o">=</span> <span class="n">X_delete</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">y_delete_cleaned</span> <span class="o">=</span> <span class="n">y_delete</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>

<span class="ne">NameError</span>: name &#39;X_delete&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="x-train">
<h3>x_train<a class="headerlink" href="#x-train" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># used on X_train instead of X_delete as above</span>

<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">IsolationForest</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">f1_score</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">model_selection</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_classification</span>

<span class="n">iso</span> <span class="o">=</span> <span class="n">IsolationForest</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">contamination</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">iso</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_train_cleaned</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
<span class="n">y_train_cleaned</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>

<span class="c1"># summarize the shape of the updated training dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train_cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train_cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">cleaned</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">X_train_cleaned</span><span class="o">.</span><span class="n">shape</span>

<span class="n">total</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of outlier row removed: &quot;</span><span class="p">,</span> <span class="n">total</span> <span class="o">-</span> <span class="n">cleaned</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;percentage of outliers removed: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">total</span><span class="o">-</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(10799, 80) (10799,)
number of outlier row removed:  569
percentage of outliers removed:  0.05005277973258269
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="standardised-bad">
<h2>standardised (bad)<a class="headerlink" href="#standardised-bad" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_delete_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_delete</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="robust-scaler-bad-result">
<h2>robust scaler (bad result)<a class="headerlink" href="#robust-scaler-bad-result" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">RobustScaler</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_delete</span><span class="p">)</span>
<span class="n">X_delete_robust</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_delete</span><span class="p">)</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">X_test_robust</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="remove-nans-zeros-trial">
<h2>remove nans,zeros trial<a class="headerlink" href="#remove-nans-zeros-trial" title="Link to this heading">#</a></h2>
<p>remove rows contain half nan</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># np.random.seed([SEED])</span>
<span class="c1"># df = pd.DataFrame(np.random.choice([1, np.nan], size=(5, 10)))</span>

<span class="c1"># df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(5, 10)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># n_not_empty = 6 #df.shape[1]/2</span>
<span class="c1"># print(th)</span>
<span class="c1"># df.dropna(thresh = n_not_empty, axis = 0, inplace = True)</span>
<span class="c1"># df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>remove rows contain half zeros</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># np.random.seed([SEED])</span>
<span class="c1"># df = pd.DataFrame(np.random.choice([1, 0], size=(5, 10)))</span>

<span class="c1"># df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># df.eq(0).sum(axis=1)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    3
1    3
2    5
3    5
4    5
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># n_zeros =(df.shape[1])//2</span>
<span class="c1"># print(n_zeros)</span>
<span class="c1"># df[df.eq(0).sum(1) &lt; n_zeros]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>remove rows that contain at least one zero’s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span>
<span class="n">X_delete</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[(</span><span class="n">X_train</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_delete</span><span class="p">))</span>
<span class="n">X_delete</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">y_delete</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">y_train</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">X_delete</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10105
5724
</pre></div>
</div>
</div>
</div>
</section>
<section id="remove-half-zeros">
<h2>remove half zeros<a class="headerlink" href="#remove-half-zeros" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print(len(X_train))</span>
<span class="c1"># n_zeros_allow = 42  #(X_train.shape[1])//6</span>
<span class="c1"># #print(&quot;number of half columns&quot;,n_zeros_th)</span>

<span class="c1"># X_delete = X_train[X_train.eq(0).sum(1) &lt; n_zeros_allow] #X_train[(X_train != 0).all(1)]</span>
<span class="c1"># print(len(X_delete))</span>
<span class="c1"># X_delete.head()</span>
<span class="c1"># y_delete = y_train[y_train.index.isin(list(X_delete.index))]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10105
9703
</pre></div>
</div>
</div>
</div>
</section>
<section id="iso-forest-on-x-delete">
<h2>iso forest on X_delete<a class="headerlink" href="#iso-forest-on-x-delete" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">IsolationForest</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">f1_score</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">model_selection</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_classification</span>

<span class="n">iso</span> <span class="o">=</span> <span class="n">IsolationForest</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">iso</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X_delete</span><span class="p">)</span>
<span class="n">X_delete_cleaned</span> <span class="o">=</span> <span class="n">X_delete</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
<span class="n">y_delete_cleaned</span> <span class="o">=</span> <span class="n">y_delete</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>

<span class="c1"># summarize the shape of the updated training dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_delete_cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_delete_cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">cleaned</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">X_delete_cleaned</span><span class="o">.</span><span class="n">shape</span>

<span class="n">total</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">X_delete</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of outlier row removed: &quot;</span><span class="p">,</span> <span class="n">total</span> <span class="o">-</span> <span class="n">cleaned</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;percentage of outliers removed: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">total</span><span class="o">-</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6300, 45) (6300,)
number of outlier row removed:  631
percentage of outliers removed:  0.0910402539316116
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from sklearn.cluster import DBSCAN, not working</span>

<span class="c1"># db = DBSCAN(eps=0.0001, min_samples=100).fit(X_delete)</span>
<span class="c1"># X_delete_cleaned = X_delete[db.labels_ != -1]</span>
<span class="c1"># y_delete_cleaned = y_delete[db.labels_ != -1]</span>

<span class="c1"># # summarize the shape of the updated training dataset</span>
<span class="c1"># print(X_delete_cleaned.shape, y_delete_cleaned.shape)</span>
<span class="c1"># cleaned,_ = X_delete_cleaned.shape</span>

<span class="c1"># total, _ = X_delete.shape</span>
<span class="c1"># print(&quot;number of outlier row removed: &quot;, total - cleaned)</span>
<span class="c1"># print(&quot;percentage of outliers removed: &quot;, (total-cleaned) / total)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0, 45) (0,)
number of outlier row removed:  6931
percentage of outliers removed:  1.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from sklearn.ensemble import IsolationForest</span>
<span class="c1"># from sklearn.metrics import make_scorer, f1_score</span>
<span class="c1"># from sklearn import model_selection</span>
<span class="c1"># from sklearn.datasets import make_classification</span>

<span class="c1"># iso = IsolationForest(random_state=SEED, contamination=0.1)</span>
<span class="c1"># y_pred = iso.fit_predict(X_train)</span>
<span class="c1"># X_train_cleaned = X_train[np.where(y_pred == 1, True, False)]</span>
<span class="c1"># y_train_cleaned = y_train[np.where(y_pred == 1, True, False)]</span>

<span class="c1"># # summarize the shape of the updated training dataset</span>
<span class="c1"># print(X_train_cleaned.shape, y_train_cleaned.shape)</span>
<span class="c1"># cleaned,_ = X_train_cleaned.shape</span>

<span class="c1"># total, _ = X_train.shape</span>
<span class="c1"># print(&quot;number of outlier row removed: &quot;, total - cleaned)</span>
<span class="c1"># print(&quot;percentage of outliers removed: &quot;, (total-cleaned) / total)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(9094, 45) (9094,)
number of outlier row removed:  1011
percentage of outliers removed:  0.10004948045522019
</pre></div>
</div>
</div>
</div>
</section>
<section id="imputation">
<h2>imputation<a class="headerlink" href="#imputation" title="Link to this heading">#</a></h2>
<section id="univariate-bad-result">
<h3>univariate (bad result)<a class="headerlink" href="#univariate-bad-result" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="n">X_imp_median</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">missing_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">X_imp_median</span> <span class="o">=</span> <span class="n">X_imp_median</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">X_imp_median</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_imp_median</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>

<span class="c1"># dont impute row contain zero, thes outlier should be learnt to predict the missing value as in the final test set</span>
<span class="n">X_cleaned_zero</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">X_train</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="n">y_train</span><span class="o">.</span><span class="n">close</span> <span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>

<span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">X_cleaned_zero</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_imp_median</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X_imp_median</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">X_cleaned_zero</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_cleaned_zero</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span> <span class="c1"># replace row from one dataframe to another</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="n">X_test_imp_median</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">missing_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">X_test_imp_median</span> <span class="o">=</span> <span class="n">X_test_imp_median</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">X_test_imp_median</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_test_imp_median</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>

<span class="n">X_test_cleaned_zero</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">X_test</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>

<span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">X_test_cleaned_zero</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">X_test_imp_median</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X_test_imp_median</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">X_test_cleaned_zero</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test_cleaned_zero</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span> <span class="c1"># replace row from one dataframe to another</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#len(list(y_test[y_test==0].index))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>421
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # zeros</span>
<span class="c1"># y_cleaned_zero = y_train[y_train.close.astype(int) == 0]</span>
<span class="c1"># X_cleaned_zero = X_train[X_train.index.isin(list(y_cleaned_zero.index))]</span>

<span class="c1"># print(X_train.shape)</span>
<span class="c1"># print(y_train.shape)</span>
<span class="c1"># print()</span>
<span class="c1"># print(X_cleaned_zero.shape)</span>
<span class="c1"># print(y_cleaned_zero.shape)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># #(y_train==0).sum()</span>
<span class="c1"># # y_train[y_train.close == 0]</span>
<span class="c1"># X_cleaned_zero</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">X_imp_mean</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">X_imp_mean</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>social_volume               0.000000
reddit_comments             1.653765
reddit_posts                1.803308
reddit_comments_score       1.944053
reddit_posts_score          1.979240
news                       31.069669
average_sentiment          31.615060
tweet_sentiment3           31.615060
tweet_sentiment4           31.615060
tweet_sentiment5           31.615060
tweet_sentiment_impact1    31.615060
tweet_sentiment_impact2    31.615060
tweet_sentiment_impact3    31.615060
tweet_sentiment_impact4    31.615060
tweet_sentiment_impact5    31.615060
tweet_spam                 31.615060
tweets                     31.615060
unique_url_shares          31.615060
url_shares                 31.615060
volatility                 31.615060
tweet_sentiment2           31.615060
tweet_sentiment1           31.615060
tweet_favorites            31.615060
tweet_replies              31.615060
correlation_rank           31.615060
galaxy_score               31.615060
high                       31.615060
low                        31.615060
market_cap                 31.615060
market_cap_global          31.615060
tweet_retweets             31.615060
open                       31.615060
percent_change_24h_rank    31.615060
price_score                31.615060
social_impact_score        31.615060
social_score               31.615060
volume                     31.615060
tweet_quotes               31.615060
percent_change_24h         31.615060
youtube                    31.615060
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span> <span class="p">(</span><span class="n">X_train</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>social_volume               0.000000
reddit_comments             1.812104
reddit_posts                1.970443
reddit_comments_score       2.102393
reddit_posts_score          2.172766
high                       31.615060
low                        31.615060
open                       31.615060
volume                     31.720619
tweet_sentiment4           31.870162
tweet_sentiment5           31.870162
tweet_sentiment_impact2    31.870162
tweet_sentiment_impact3    31.870162
tweet_sentiment_impact4    31.870162
social_impact_score        31.870162
average_sentiment          31.870162
price_score                31.870162
tweet_sentiment_impact5    31.870162
tweet_spam                 31.870162
tweets                     31.870162
galaxy_score               31.870162
correlation_rank           31.870162
tweet_sentiment2           31.870162
tweet_sentiment3           31.870162
unique_url_shares          31.940535
url_shares                 31.940535
tweet_favorites            31.958128
tweet_retweets             31.958128
tweet_replies              32.019704
social_score               32.028501
tweet_quotes               32.054891
news                       32.054891
volatility                 32.186840
market_cap                 33.515130
market_cap_global          33.743842
percent_change_24h         33.998944
percent_change_24h_rank    35.749472
tweet_sentiment1           37.623153
tweet_sentiment_impact1    37.649543
youtube                    62.121745
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">X_test_imp_median</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test_imp_median</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>social_volume              0.000000
reddit_posts               0.079114
reddit_posts_score         0.158228
reddit_comments            0.395570
reddit_comments_score      0.474684
average_sentiment          3.243671
tweet_sentiment2           3.243671
tweet_sentiment3           3.243671
tweet_sentiment4           3.243671
tweet_sentiment5           3.243671
tweet_sentiment_impact1    3.243671
tweet_sentiment_impact2    3.243671
tweet_sentiment_impact3    3.243671
tweet_sentiment_impact4    3.243671
tweet_sentiment_impact5    3.243671
tweet_spam                 3.243671
tweets                     3.243671
unique_url_shares          3.243671
url_shares                 3.243671
volatility                 3.243671
tweet_sentiment1           3.243671
tweet_retweets             3.243671
tweet_favorites            3.243671
tweet_quotes               3.243671
correlation_rank           3.243671
galaxy_score               3.243671
high                       3.243671
low                        3.243671
market_cap                 3.243671
market_cap_global          3.243671
tweet_replies              3.243671
news                       3.243671
percent_change_24h         3.243671
percent_change_24h_rank    3.243671
price_score                3.243671
social_impact_score        3.243671
social_score               3.243671
volume                     3.243671
open                       3.243671
youtube                    3.243671
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">X_test</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>social_volume               0.000000
reddit_posts                1.344937
reddit_comments             1.898734
reddit_posts_score          1.977848
reddit_comments_score       2.136076
high                       33.306962
low                        33.306962
open                       33.306962
volume                     33.306962
average_sentiment          33.623418
tweet_sentiment2           33.623418
tweet_sentiment3           33.623418
tweet_sentiment5           33.623418
tweet_sentiment_impact2    33.623418
tweet_sentiment_impact3    33.623418
tweet_sentiment_impact4    33.623418
tweet_sentiment_impact5    33.623418
tweet_spam                 33.623418
tweets                     33.623418
tweet_sentiment4           33.623418
tweet_retweets             33.623418
tweet_favorites            33.623418
social_impact_score        33.623418
price_score                33.623418
correlation_rank           33.623418
galaxy_score               33.623418
tweet_quotes               33.702532
social_score               33.702532
url_shares                 33.702532
unique_url_shares          33.702532
tweet_replies              33.702532
volatility                 33.781646
news                       34.177215
market_cap                 35.047468
market_cap_global          35.205696
percent_change_24h         35.917722
percent_change_24h_rank    36.471519
tweet_sentiment_impact1    38.449367
tweet_sentiment1           38.449367
youtube                    62.025316
dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="multivariate">
<h3>multivariate<a class="headerlink" href="#multivariate" title="Link to this heading">#</a></h3>
<section id="convert-numpy-to-pandas">
<h4>convert numpy to pandas<a class="headerlink" href="#convert-numpy-to-pandas" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># no zeros</span>
<span class="n">y_cleaned</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">y_train</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">y_cleaned</span><span class="o">.</span><span class="n">index</span>
<span class="n">X_cleaned</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">X_train</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">y_cleaned</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">y_test_cleaned</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">X_test_cleaned</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">X_test</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">y_test_cleaned</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_test_cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_test_cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(7774, 40)
(7774,)
(843, 40)
(843,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># zeros</span>
<span class="n">y_cleaned_zero</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">y_train</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">X_cleaned_zero</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">X_train</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">y_cleaned_zero</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_cleaned_zero</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_cleaned_zero</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3594, 40)
(3594,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.experimental</span> <span class="kn">import</span> <span class="n">enable_iterative_imputer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">IterativeImputer</span>
<span class="n">imp_mean</span> <span class="o">=</span> <span class="n">IterativeImputer</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">missing_values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># here the missing value is instead 0 since we fill nan with zeros beforehand</span>

<span class="n">X_imputed</span> <span class="o">=</span> <span class="n">imp_mean</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_cleaned</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">X_imputed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_imputed</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">X_cleaned</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_new</span> <span class="o">=</span> <span class="n">X_imputed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_cleaned_zero</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_new</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average_sentiment</th>
      <th>correlation_rank</th>
      <th>galaxy_score</th>
      <th>high</th>
      <th>low</th>
      <th>market_cap</th>
      <th>market_cap_global</th>
      <th>news</th>
      <th>open</th>
      <th>percent_change_24h</th>
      <th>percent_change_24h_rank</th>
      <th>price_score</th>
      <th>reddit_comments</th>
      <th>reddit_comments_score</th>
      <th>reddit_posts</th>
      <th>reddit_posts_score</th>
      <th>social_impact_score</th>
      <th>social_score</th>
      <th>social_volume</th>
      <th>tweet_favorites</th>
      <th>tweet_quotes</th>
      <th>tweet_replies</th>
      <th>tweet_retweets</th>
      <th>tweet_sentiment1</th>
      <th>tweet_sentiment2</th>
      <th>tweet_sentiment3</th>
      <th>tweet_sentiment4</th>
      <th>tweet_sentiment5</th>
      <th>tweet_sentiment_impact1</th>
      <th>tweet_sentiment_impact2</th>
      <th>tweet_sentiment_impact3</th>
      <th>tweet_sentiment_impact4</th>
      <th>tweet_sentiment_impact5</th>
      <th>tweet_spam</th>
      <th>tweets</th>
      <th>unique_url_shares</th>
      <th>url_shares</th>
      <th>volatility</th>
      <th>volume</th>
      <th>youtube</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.6</td>
      <td>2.6</td>
      <td>68.0</td>
      <td>18318.452773</td>
      <td>18303.958107</td>
      <td>3.395272e+11</td>
      <td>5.449273e+11</td>
      <td>18.000000</td>
      <td>18318.452773</td>
      <td>-4.559145</td>
      <td>1076.0</td>
      <td>3.2</td>
      <td>67.0</td>
      <td>156.0</td>
      <td>51.0</td>
      <td>172.0</td>
      <td>4.2</td>
      <td>14111388.0</td>
      <td>5408.0</td>
      <td>2417.0</td>
      <td>41.0</td>
      <td>243.0</td>
      <td>521.0</td>
      <td>62.0</td>
      <td>572.0</td>
      <td>611.0</td>
      <td>3198.0</td>
      <td>89.0</td>
      <td>125248.0</td>
      <td>2618138.0</td>
      <td>3011192.0</td>
      <td>8098383.0</td>
      <td>256430.0</td>
      <td>1563.0</td>
      <td>4532.0</td>
      <td>740.0</td>
      <td>1669.0</td>
      <td>0.016692</td>
      <td>9.944220e+08</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.7</td>
      <td>4.7</td>
      <td>77.5</td>
      <td>7550.592958</td>
      <td>7538.033373</td>
      <td>1.379543e+11</td>
      <td>2.171955e+11</td>
      <td>36.000000</td>
      <td>7550.592958</td>
      <td>5.901404</td>
      <td>477.0</td>
      <td>3.1</td>
      <td>68.0</td>
      <td>265.0</td>
      <td>58.0</td>
      <td>192.0</td>
      <td>4.0</td>
      <td>20964482.0</td>
      <td>5818.0</td>
      <td>3868.0</td>
      <td>84.0</td>
      <td>437.0</td>
      <td>1409.0</td>
      <td>155.0</td>
      <td>154.0</td>
      <td>928.0</td>
      <td>3229.0</td>
      <td>244.0</td>
      <td>443382.0</td>
      <td>412029.0</td>
      <td>3674794.0</td>
      <td>16057947.0</td>
      <td>374229.0</td>
      <td>595.0</td>
      <td>4710.0</td>
      <td>946.0</td>
      <td>1644.0</td>
      <td>0.025393</td>
      <td>1.401598e+09</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.7</td>
      <td>3.3</td>
      <td>70.0</td>
      <td>9123.040273</td>
      <td>9115.024817</td>
      <td>1.673726e+11</td>
      <td>2.669533e+11</td>
      <td>25.000000</td>
      <td>9119.815677</td>
      <td>-0.093935</td>
      <td>1096.0</td>
      <td>2.8</td>
      <td>39.0</td>
      <td>60.0</td>
      <td>26.0</td>
      <td>113.0</td>
      <td>4.2</td>
      <td>12238225.0</td>
      <td>3905.0</td>
      <td>2203.0</td>
      <td>18.0</td>
      <td>1155.0</td>
      <td>2012.0</td>
      <td>73.0</td>
      <td>282.0</td>
      <td>326.0</td>
      <td>2409.0</td>
      <td>95.0</td>
      <td>174656.0</td>
      <td>1547011.0</td>
      <td>633933.0</td>
      <td>9617342.0</td>
      <td>264188.0</td>
      <td>1298.0</td>
      <td>3185.0</td>
      <td>630.0</td>
      <td>922.0</td>
      <td>0.005119</td>
      <td>6.270151e+08</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.6</td>
      <td>2.5</td>
      <td>70.5</td>
      <td>6315.471122</td>
      <td>6309.281509</td>
      <td>1.166195e+11</td>
      <td>1.766512e+11</td>
      <td>0.053464</td>
      <td>6315.471122</td>
      <td>-7.804890</td>
      <td>1125.0</td>
      <td>3.9</td>
      <td>89.0</td>
      <td>633.0</td>
      <td>27.0</td>
      <td>646.0</td>
      <td>4.1</td>
      <td>8026249.0</td>
      <td>2913.0</td>
      <td>2213.0</td>
      <td>56.0</td>
      <td>304.0</td>
      <td>427.0</td>
      <td>64.0</td>
      <td>169.0</td>
      <td>451.0</td>
      <td>1597.0</td>
      <td>133.0</td>
      <td>124026.0</td>
      <td>748828.0</td>
      <td>1227341.0</td>
      <td>5769267.0</td>
      <td>155603.0</td>
      <td>212.0</td>
      <td>2414.0</td>
      <td>383.0</td>
      <td>530.0</td>
      <td>0.016701</td>
      <td>1.389393e+09</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3.6</td>
      <td>4.5</td>
      <td>76.0</td>
      <td>46787.898272</td>
      <td>46250.250495</td>
      <td>8.654892e+11</td>
      <td>1.396854e+12</td>
      <td>27.000000</td>
      <td>46557.829521</td>
      <td>21.242381</td>
      <td>285.0</td>
      <td>3.4</td>
      <td>236.0</td>
      <td>528.0</td>
      <td>104.0</td>
      <td>554.0</td>
      <td>3.7</td>
      <td>217887100.0</td>
      <td>21873.0</td>
      <td>29993.0</td>
      <td>502.0</td>
      <td>1913.0</td>
      <td>7738.0</td>
      <td>390.0</td>
      <td>2574.0</td>
      <td>1411.0</td>
      <td>15475.0</td>
      <td>499.0</td>
      <td>21279720.0</td>
      <td>8320581.0</td>
      <td>7831069.0</td>
      <td>170831811.0</td>
      <td>9620719.0</td>
      <td>3313.0</td>
      <td>20349.0</td>
      <td>1157.0</td>
      <td>2118.0</td>
      <td>0.074106</td>
      <td>3.519595e+09</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average_sentiment</th>
      <th>correlation_rank</th>
      <th>galaxy_score</th>
      <th>high</th>
      <th>low</th>
      <th>market_cap</th>
      <th>market_cap_global</th>
      <th>news</th>
      <th>open</th>
      <th>percent_change_24h</th>
      <th>percent_change_24h_rank</th>
      <th>price_score</th>
      <th>reddit_comments</th>
      <th>reddit_comments_score</th>
      <th>reddit_posts</th>
      <th>reddit_posts_score</th>
      <th>social_impact_score</th>
      <th>social_score</th>
      <th>social_volume</th>
      <th>tweet_favorites</th>
      <th>tweet_quotes</th>
      <th>tweet_replies</th>
      <th>tweet_retweets</th>
      <th>tweet_sentiment1</th>
      <th>tweet_sentiment2</th>
      <th>tweet_sentiment3</th>
      <th>tweet_sentiment4</th>
      <th>tweet_sentiment5</th>
      <th>tweet_sentiment_impact1</th>
      <th>tweet_sentiment_impact2</th>
      <th>tweet_sentiment_impact3</th>
      <th>tweet_sentiment_impact4</th>
      <th>tweet_sentiment_impact5</th>
      <th>tweet_spam</th>
      <th>tweets</th>
      <th>unique_url_shares</th>
      <th>url_shares</th>
      <th>volatility</th>
      <th>volume</th>
      <th>youtube</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5350</th>
      <td>3.6</td>
      <td>2.6</td>
      <td>68.0</td>
      <td>18318.452773</td>
      <td>18303.958107</td>
      <td>3.395272e+11</td>
      <td>5.449273e+11</td>
      <td>18.0</td>
      <td>18318.452773</td>
      <td>-4.559145</td>
      <td>1076.0</td>
      <td>3.2</td>
      <td>67.0</td>
      <td>156.0</td>
      <td>51.0</td>
      <td>172.0</td>
      <td>4.2</td>
      <td>14111388.0</td>
      <td>5408</td>
      <td>2417.0</td>
      <td>41.0</td>
      <td>243.0</td>
      <td>521.0</td>
      <td>62.0</td>
      <td>572.0</td>
      <td>611.0</td>
      <td>3198.0</td>
      <td>89.0</td>
      <td>125248.0</td>
      <td>2618138.0</td>
      <td>3011192.0</td>
      <td>8098383.0</td>
      <td>256430.0</td>
      <td>1563.0</td>
      <td>4532.0</td>
      <td>740.0</td>
      <td>1669.0</td>
      <td>0.016692</td>
      <td>9.944220e+08</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2582</th>
      <td>3.7</td>
      <td>4.7</td>
      <td>77.5</td>
      <td>7550.592958</td>
      <td>7538.033373</td>
      <td>1.379543e+11</td>
      <td>2.171955e+11</td>
      <td>36.0</td>
      <td>7550.592958</td>
      <td>5.901404</td>
      <td>477.0</td>
      <td>3.1</td>
      <td>68.0</td>
      <td>265.0</td>
      <td>58.0</td>
      <td>192.0</td>
      <td>4.0</td>
      <td>20964482.0</td>
      <td>5818</td>
      <td>3868.0</td>
      <td>84.0</td>
      <td>437.0</td>
      <td>1409.0</td>
      <td>155.0</td>
      <td>154.0</td>
      <td>928.0</td>
      <td>3229.0</td>
      <td>244.0</td>
      <td>443382.0</td>
      <td>412029.0</td>
      <td>3674794.0</td>
      <td>16057947.0</td>
      <td>374229.0</td>
      <td>595.0</td>
      <td>4710.0</td>
      <td>946.0</td>
      <td>1644.0</td>
      <td>0.025393</td>
      <td>1.401598e+09</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>8857</th>
      <td>3.7</td>
      <td>3.3</td>
      <td>70.0</td>
      <td>9123.040273</td>
      <td>9115.024817</td>
      <td>1.673726e+11</td>
      <td>2.669533e+11</td>
      <td>25.0</td>
      <td>9119.815677</td>
      <td>-0.093935</td>
      <td>1096.0</td>
      <td>2.8</td>
      <td>39.0</td>
      <td>60.0</td>
      <td>26.0</td>
      <td>113.0</td>
      <td>4.2</td>
      <td>12238225.0</td>
      <td>3905</td>
      <td>2203.0</td>
      <td>18.0</td>
      <td>1155.0</td>
      <td>2012.0</td>
      <td>73.0</td>
      <td>282.0</td>
      <td>326.0</td>
      <td>2409.0</td>
      <td>95.0</td>
      <td>174656.0</td>
      <td>1547011.0</td>
      <td>633933.0</td>
      <td>9617342.0</td>
      <td>264188.0</td>
      <td>1298.0</td>
      <td>3185.0</td>
      <td>630.0</td>
      <td>922.0</td>
      <td>0.005119</td>
      <td>6.270151e+08</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>11178</th>
      <td>3.6</td>
      <td>2.5</td>
      <td>70.5</td>
      <td>6315.471122</td>
      <td>6309.281509</td>
      <td>1.166195e+11</td>
      <td>1.766512e+11</td>
      <td>0.0</td>
      <td>6315.471122</td>
      <td>-7.804890</td>
      <td>1125.0</td>
      <td>3.9</td>
      <td>89.0</td>
      <td>633.0</td>
      <td>27.0</td>
      <td>646.0</td>
      <td>4.1</td>
      <td>8026249.0</td>
      <td>2913</td>
      <td>2213.0</td>
      <td>56.0</td>
      <td>304.0</td>
      <td>427.0</td>
      <td>64.0</td>
      <td>169.0</td>
      <td>451.0</td>
      <td>1597.0</td>
      <td>133.0</td>
      <td>124026.0</td>
      <td>748828.0</td>
      <td>1227341.0</td>
      <td>5769267.0</td>
      <td>155603.0</td>
      <td>212.0</td>
      <td>2414.0</td>
      <td>383.0</td>
      <td>530.0</td>
      <td>0.016701</td>
      <td>1.389393e+09</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>10337</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>122.0</td>
      <td>200.0</td>
      <td>10.0</td>
      <td>26.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>132</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_imputed</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average_sentiment</th>
      <th>correlation_rank</th>
      <th>galaxy_score</th>
      <th>high</th>
      <th>low</th>
      <th>market_cap</th>
      <th>market_cap_global</th>
      <th>news</th>
      <th>open</th>
      <th>percent_change_24h</th>
      <th>percent_change_24h_rank</th>
      <th>price_score</th>
      <th>reddit_comments</th>
      <th>reddit_comments_score</th>
      <th>reddit_posts</th>
      <th>reddit_posts_score</th>
      <th>social_impact_score</th>
      <th>social_score</th>
      <th>social_volume</th>
      <th>tweet_favorites</th>
      <th>tweet_quotes</th>
      <th>tweet_replies</th>
      <th>tweet_retweets</th>
      <th>tweet_sentiment1</th>
      <th>tweet_sentiment2</th>
      <th>tweet_sentiment3</th>
      <th>tweet_sentiment4</th>
      <th>tweet_sentiment5</th>
      <th>tweet_sentiment_impact1</th>
      <th>tweet_sentiment_impact2</th>
      <th>tweet_sentiment_impact3</th>
      <th>tweet_sentiment_impact4</th>
      <th>tweet_sentiment_impact5</th>
      <th>tweet_spam</th>
      <th>tweets</th>
      <th>unique_url_shares</th>
      <th>url_shares</th>
      <th>volatility</th>
      <th>volume</th>
      <th>youtube</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3.6</td>
      <td>2.6</td>
      <td>68.0</td>
      <td>18318.452773</td>
      <td>18303.958107</td>
      <td>3.395272e+11</td>
      <td>5.449273e+11</td>
      <td>18.000000</td>
      <td>18318.452773</td>
      <td>-4.559145</td>
      <td>1076.0</td>
      <td>3.2</td>
      <td>67.0</td>
      <td>156.0</td>
      <td>51.0</td>
      <td>172.0</td>
      <td>4.2</td>
      <td>14111388.0</td>
      <td>5408.0</td>
      <td>2417.0</td>
      <td>41.0</td>
      <td>243.0</td>
      <td>521.0</td>
      <td>62.0</td>
      <td>572.0</td>
      <td>611.0</td>
      <td>3198.0</td>
      <td>89.0</td>
      <td>125248.0</td>
      <td>2618138.0</td>
      <td>3011192.0</td>
      <td>8098383.0</td>
      <td>256430.0</td>
      <td>1563.0</td>
      <td>4532.0</td>
      <td>740.0</td>
      <td>1669.0</td>
      <td>0.016692</td>
      <td>9.944220e+08</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.7</td>
      <td>4.7</td>
      <td>77.5</td>
      <td>7550.592958</td>
      <td>7538.033373</td>
      <td>1.379543e+11</td>
      <td>2.171955e+11</td>
      <td>36.000000</td>
      <td>7550.592958</td>
      <td>5.901404</td>
      <td>477.0</td>
      <td>3.1</td>
      <td>68.0</td>
      <td>265.0</td>
      <td>58.0</td>
      <td>192.0</td>
      <td>4.0</td>
      <td>20964482.0</td>
      <td>5818.0</td>
      <td>3868.0</td>
      <td>84.0</td>
      <td>437.0</td>
      <td>1409.0</td>
      <td>155.0</td>
      <td>154.0</td>
      <td>928.0</td>
      <td>3229.0</td>
      <td>244.0</td>
      <td>443382.0</td>
      <td>412029.0</td>
      <td>3674794.0</td>
      <td>16057947.0</td>
      <td>374229.0</td>
      <td>595.0</td>
      <td>4710.0</td>
      <td>946.0</td>
      <td>1644.0</td>
      <td>0.025393</td>
      <td>1.401598e+09</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.7</td>
      <td>3.3</td>
      <td>70.0</td>
      <td>9123.040273</td>
      <td>9115.024817</td>
      <td>1.673726e+11</td>
      <td>2.669533e+11</td>
      <td>25.000000</td>
      <td>9119.815677</td>
      <td>-0.093935</td>
      <td>1096.0</td>
      <td>2.8</td>
      <td>39.0</td>
      <td>60.0</td>
      <td>26.0</td>
      <td>113.0</td>
      <td>4.2</td>
      <td>12238225.0</td>
      <td>3905.0</td>
      <td>2203.0</td>
      <td>18.0</td>
      <td>1155.0</td>
      <td>2012.0</td>
      <td>73.0</td>
      <td>282.0</td>
      <td>326.0</td>
      <td>2409.0</td>
      <td>95.0</td>
      <td>174656.0</td>
      <td>1547011.0</td>
      <td>633933.0</td>
      <td>9617342.0</td>
      <td>264188.0</td>
      <td>1298.0</td>
      <td>3185.0</td>
      <td>630.0</td>
      <td>922.0</td>
      <td>0.005119</td>
      <td>6.270151e+08</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.6</td>
      <td>2.5</td>
      <td>70.5</td>
      <td>6315.471122</td>
      <td>6309.281509</td>
      <td>1.166195e+11</td>
      <td>1.766512e+11</td>
      <td>0.053464</td>
      <td>6315.471122</td>
      <td>-7.804890</td>
      <td>1125.0</td>
      <td>3.9</td>
      <td>89.0</td>
      <td>633.0</td>
      <td>27.0</td>
      <td>646.0</td>
      <td>4.1</td>
      <td>8026249.0</td>
      <td>2913.0</td>
      <td>2213.0</td>
      <td>56.0</td>
      <td>304.0</td>
      <td>427.0</td>
      <td>64.0</td>
      <td>169.0</td>
      <td>451.0</td>
      <td>1597.0</td>
      <td>133.0</td>
      <td>124026.0</td>
      <td>748828.0</td>
      <td>1227341.0</td>
      <td>5769267.0</td>
      <td>155603.0</td>
      <td>212.0</td>
      <td>2414.0</td>
      <td>383.0</td>
      <td>530.0</td>
      <td>0.016701</td>
      <td>1.389393e+09</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3.6</td>
      <td>4.5</td>
      <td>76.0</td>
      <td>46787.898272</td>
      <td>46250.250495</td>
      <td>8.654892e+11</td>
      <td>1.396854e+12</td>
      <td>27.000000</td>
      <td>46557.829521</td>
      <td>21.242381</td>
      <td>285.0</td>
      <td>3.4</td>
      <td>236.0</td>
      <td>528.0</td>
      <td>104.0</td>
      <td>554.0</td>
      <td>3.7</td>
      <td>217887100.0</td>
      <td>21873.0</td>
      <td>29993.0</td>
      <td>502.0</td>
      <td>1913.0</td>
      <td>7738.0</td>
      <td>390.0</td>
      <td>2574.0</td>
      <td>1411.0</td>
      <td>15475.0</td>
      <td>499.0</td>
      <td>21279720.0</td>
      <td>8320581.0</td>
      <td>7831069.0</td>
      <td>170831811.0</td>
      <td>9620719.0</td>
      <td>3313.0</td>
      <td>20349.0</td>
      <td>1157.0</td>
      <td>2118.0</td>
      <td>0.074106</td>
      <td>3.519595e+09</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print(len(X_train))</span>
<span class="c1"># X_no_zeros = X_train[(X_train != 0).all(1)]</span>
<span class="c1"># print(len(X_no_zeros))</span>
<span class="c1"># X_no_zeros.head()</span>
<span class="c1"># y_no_zeros = y_train[y_train.index.isin(list(X_no_zeros.index))]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10105
5684
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import numpy as np</span>
<span class="c1"># from sklearn.experimental import enable_iterative_imputer</span>
<span class="c1"># from sklearn.impute import IterativeImputer</span>
<span class="c1"># imp_mean = IterativeImputer(random_state=SEED, missing_values=0, max_iter=100) # here the missing value is instead 0 since we fill nan with zeros beforehand</span>

<span class="c1"># X_imputed = imp_mean.fit_transform(X_delete)</span>

<span class="c1"># import pandas as pd</span>
<span class="c1"># X_imputed = pd.DataFrame(X_imputed, columns = list(X_delete.columns))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.7/dist-packages/sklearn/impute/_iterative.py:686: ConvergenceWarning: [IterativeImputer] Early stopping criterion not reached.
  &quot; reached.&quot;, ConvergenceWarning)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#impute on x_delete</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.experimental</span> <span class="kn">import</span> <span class="n">enable_iterative_imputer</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">IterativeImputer</span>
<span class="n">imp_mean</span> <span class="o">=</span> <span class="n">IterativeImputer</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">missing_values</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample_posterior</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># here the missing value is instead 0 since we fill nan with zeros beforehand</span>

<span class="n">X_delete_imputed</span> <span class="o">=</span> <span class="n">imp_mean</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_delete</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">X_delete_imputed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_delete_imputed</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">X_delete</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_imputed</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">X_delete</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;std&#39;</span><span class="p">]]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">a</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">]</span>
<span class="n">b</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># drop column contains nan</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average_sentiment</th>
      <th>correlation_rank</th>
      <th>market_cap_rank</th>
      <th>price_score</th>
      <th>social_impact_score</th>
      <th>social_score_24h_rank</th>
      <th>social_volume_24h_rank</th>
      <th>volatility</th>
      <th>volume_24h_rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>std</th>
      <td>0.401672</td>
      <td>0.802339</td>
      <td>0.209366</td>
      <td>0.847917</td>
      <td>0.696761</td>
      <td>0.260664</td>
      <td>0.283554</td>
      <td>0.019206</td>
      <td>0.673301</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_imputed</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if there missing values in test set</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">X_imputed</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Percentage of Missing Values Per Column in Test Set&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">})</span>

<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
    <span class="n">percentage</span> <span class="o">=</span><span class="s1">&#39;</span><span class="si">{:,.1f}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_width</span><span class="p">(),</span><span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
    <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">+</span><span class="n">width</span><span class="o">+</span><span class="mf">0.02</span>
    <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_y</span><span class="p">()</span><span class="o">+</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">percentage</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="knn-imputer-bad-result">
<h3>Knn imputer (bad result)<a class="headerlink" href="#knn-imputer-bad-result" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">KNNImputer</span>

<span class="n">imputer</span> <span class="o">=</span> <span class="n">KNNImputer</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span> <span class="n">missing_values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X_imp_knn</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_delete</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="log-transform">
<h2>Log transform<a class="headerlink" href="#log-transform" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert all 0 to 1</span>
<span class="n">X_delete_one</span> <span class="o">=</span> <span class="n">X_delete</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if there missing values in test set</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">X_delete_one</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Percentage of Missing Values Per Column in X_delete_one Set&#39;</span><span class="p">,</span> <span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">})</span>

<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
    <span class="n">percentage</span> <span class="o">=</span><span class="s1">&#39;</span><span class="si">{:,.1f}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="n">X_delete_one</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_width</span><span class="p">(),</span><span class="n">p</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
    <span class="n">x</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span><span class="o">+</span><span class="n">width</span><span class="o">+</span><span class="mf">0.02</span>
    <span class="n">y</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">get_y</span><span class="p">()</span><span class="o">+</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">percentage</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/76c199f351ff264a256894e039f30724c99773c15e4a795a60fa9eb703de2fcc.png" src="../../_images/76c199f351ff264a256894e039f30724c99773c15e4a795a60fa9eb703de2fcc.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">X_delete_one</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s1">&#39;percent_change_24h&#39;</span><span class="p">]:</span>
    <span class="n">X_delete_one</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">X_delete_one</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_delete_one</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>average_sentiment</th>
      <th>correlation_rank</th>
      <th>galaxy_score</th>
      <th>high</th>
      <th>low</th>
      <th>market_cap</th>
      <th>market_cap_global</th>
      <th>market_cap_rank</th>
      <th>news</th>
      <th>open</th>
      <th>percent_change_24h</th>
      <th>percent_change_24h_rank</th>
      <th>price_score</th>
      <th>reddit_comments</th>
      <th>reddit_comments_score</th>
      <th>reddit_posts</th>
      <th>reddit_posts_score</th>
      <th>social_impact_score</th>
      <th>social_score</th>
      <th>social_score_24h_rank</th>
      <th>social_volume</th>
      <th>social_volume_24h_rank</th>
      <th>tweet_favorites</th>
      <th>tweet_followers</th>
      <th>tweet_quotes</th>
      <th>tweet_replies</th>
      <th>tweet_retweets</th>
      <th>tweet_sentiment1</th>
      <th>tweet_sentiment2</th>
      <th>tweet_sentiment3</th>
      <th>tweet_sentiment4</th>
      <th>tweet_sentiment5</th>
      <th>tweet_sentiment_impact1</th>
      <th>tweet_sentiment_impact2</th>
      <th>tweet_sentiment_impact3</th>
      <th>tweet_sentiment_impact4</th>
      <th>tweet_sentiment_impact5</th>
      <th>tweet_spam</th>
      <th>tweets</th>
      <th>unique_url_shares</th>
      <th>url_shares</th>
      <th>volatility</th>
      <th>volume</th>
      <th>volume_24h_rank</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
      <td>6931.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.280709</td>
      <td>1.145662</td>
      <td>4.167462</td>
      <td>9.335157</td>
      <td>9.330090</td>
      <td>25.168684</td>
      <td>25.533135</td>
      <td>0.000559</td>
      <td>2.644729</td>
      <td>9.332712</td>
      <td>0.431318</td>
      <td>6.213838</td>
      <td>1.041845</td>
      <td>4.115471</td>
      <td>5.454444</td>
      <td>3.596214</td>
      <td>5.197910</td>
      <td>1.275563</td>
      <td>16.317229</td>
      <td>0.004300</td>
      <td>8.406353</td>
      <td>0.012101</td>
      <td>7.898097</td>
      <td>16.349220</td>
      <td>4.198457</td>
      <td>5.836456</td>
      <td>6.738478</td>
      <td>4.166058</td>
      <td>5.470390</td>
      <td>6.280362</td>
      <td>7.768856</td>
      <td>5.078200</td>
      <td>11.657594</td>
      <td>13.838555</td>
      <td>14.259675</td>
      <td>15.944999</td>
      <td>13.154737</td>
      <td>6.661996</td>
      <td>8.145969</td>
      <td>6.469824</td>
      <td>6.935324</td>
      <td>-4.382385</td>
      <td>20.557646</td>
      <td>0.690247</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.141042</td>
      <td>0.271429</td>
      <td>0.460143</td>
      <td>1.016547</td>
      <td>1.015093</td>
      <td>4.906869</td>
      <td>5.190712</td>
      <td>0.025902</td>
      <td>1.377057</td>
      <td>1.015821</td>
      <td>3.595194</td>
      <td>1.670587</td>
      <td>0.333589</td>
      <td>0.685528</td>
      <td>0.865470</td>
      <td>0.750048</td>
      <td>1.087598</td>
      <td>0.226548</td>
      <td>2.131915</td>
      <td>0.054430</td>
      <td>0.739843</td>
      <td>0.090788</td>
      <td>1.377573</td>
      <td>2.017651</td>
      <td>1.224211</td>
      <td>1.210479</td>
      <td>1.179748</td>
      <td>1.700216</td>
      <td>1.140454</td>
      <td>0.866613</td>
      <td>1.063662</td>
      <td>1.011610</td>
      <td>4.170520</td>
      <td>1.949880</td>
      <td>1.704596</td>
      <td>1.872859</td>
      <td>1.984680</td>
      <td>1.236635</td>
      <td>1.085524</td>
      <td>0.856175</td>
      <td>0.935113</td>
      <td>0.890956</td>
      <td>2.056944</td>
      <td>0.259346</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-44.690403</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2.708050</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-6.450457</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.280934</td>
      <td>1.029619</td>
      <td>4.158883</td>
      <td>9.031338</td>
      <td>9.027570</td>
      <td>25.712651</td>
      <td>26.122971</td>
      <td>0.000000</td>
      <td>2.079442</td>
      <td>9.029454</td>
      <td>-1.161925</td>
      <td>6.410175</td>
      <td>0.993252</td>
      <td>3.688879</td>
      <td>4.897840</td>
      <td>3.178054</td>
      <td>4.521789</td>
      <td>1.098612</td>
      <td>16.027247</td>
      <td>0.000000</td>
      <td>8.078688</td>
      <td>0.000000</td>
      <td>7.289269</td>
      <td>16.026966</td>
      <td>3.465736</td>
      <td>5.257495</td>
      <td>6.228511</td>
      <td>4.143135</td>
      <td>4.948760</td>
      <td>5.948035</td>
      <td>7.424165</td>
      <td>4.744932</td>
      <td>11.877902</td>
      <td>13.143772</td>
      <td>13.928833</td>
      <td>15.629707</td>
      <td>12.519603</td>
      <td>5.811141</td>
      <td>7.851467</td>
      <td>6.316261</td>
      <td>6.738152</td>
      <td>-4.951654</td>
      <td>20.227576</td>
      <td>0.693147</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.308333</td>
      <td>1.163151</td>
      <td>4.219508</td>
      <td>9.176753</td>
      <td>9.171937</td>
      <td>25.882394</td>
      <td>26.317560</td>
      <td>0.000000</td>
      <td>3.178054</td>
      <td>9.174331</td>
      <td>0.364590</td>
      <td>6.682109</td>
      <td>1.098612</td>
      <td>4.043051</td>
      <td>5.416100</td>
      <td>3.663562</td>
      <td>5.147494</td>
      <td>1.335001</td>
      <td>16.459489</td>
      <td>0.000000</td>
      <td>8.392990</td>
      <td>0.000000</td>
      <td>7.906915</td>
      <td>16.457579</td>
      <td>4.234107</td>
      <td>5.899897</td>
      <td>6.771936</td>
      <td>4.624973</td>
      <td>5.525453</td>
      <td>6.318968</td>
      <td>7.786552</td>
      <td>5.204007</td>
      <td>12.701908</td>
      <td>13.912596</td>
      <td>14.339061</td>
      <td>16.060438</td>
      <td>13.185646</td>
      <td>6.677083</td>
      <td>8.186743</td>
      <td>6.551080</td>
      <td>7.016610</td>
      <td>-4.476917</td>
      <td>20.700272</td>
      <td>0.693147</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.308333</td>
      <td>1.308333</td>
      <td>4.276666</td>
      <td>9.479518</td>
      <td>9.476228</td>
      <td>26.106928</td>
      <td>26.647678</td>
      <td>0.000000</td>
      <td>3.610918</td>
      <td>9.478626</td>
      <td>1.777816</td>
      <td>6.863803</td>
      <td>1.193922</td>
      <td>4.465908</td>
      <td>6.017375</td>
      <td>4.094345</td>
      <td>5.855072</td>
      <td>1.410987</td>
      <td>16.943192</td>
      <td>0.000000</td>
      <td>8.744010</td>
      <td>0.000000</td>
      <td>8.581481</td>
      <td>16.939164</td>
      <td>4.993822</td>
      <td>6.552508</td>
      <td>7.324160</td>
      <td>5.010635</td>
      <td>6.167516</td>
      <td>6.693324</td>
      <td>8.194644</td>
      <td>5.669881</td>
      <td>13.566923</td>
      <td>14.756853</td>
      <td>14.787368</td>
      <td>16.502479</td>
      <td>13.919945</td>
      <td>7.603399</td>
      <td>8.561975</td>
      <td>6.794587</td>
      <td>7.318540</td>
      <td>-3.959629</td>
      <td>21.194629</td>
      <td>0.693147</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.410987</td>
      <td>1.609438</td>
      <td>4.471639</td>
      <td>11.026912</td>
      <td>11.019828</td>
      <td>27.762843</td>
      <td>28.352522</td>
      <td>1.791759</td>
      <td>5.823046</td>
      <td>11.025311</td>
      <td>31.076357</td>
      <td>7.306531</td>
      <td>1.609438</td>
      <td>7.195187</td>
      <td>12.227002</td>
      <td>6.214608</td>
      <td>10.327415</td>
      <td>1.609438</td>
      <td>20.250456</td>
      <td>0.693147</td>
      <td>11.852472</td>
      <td>0.693147</td>
      <td>13.358406</td>
      <td>20.249970</td>
      <td>9.954656</td>
      <td>10.542258</td>
      <td>11.740746</td>
      <td>8.213924</td>
      <td>8.945984</td>
      <td>9.216223</td>
      <td>11.822452</td>
      <td>8.551208</td>
      <td>17.880073</td>
      <td>18.477319</td>
      <td>18.023778</td>
      <td>19.849745</td>
      <td>18.202606</td>
      <td>9.532931</td>
      <td>11.843301</td>
      <td>8.492900</td>
      <td>9.220984</td>
      <td>0.000000</td>
      <td>24.671751</td>
      <td>2.302585</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.995732273553991
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="feature-selection">
<h1>feature selection<a class="headerlink" href="#feature-selection" title="Link to this heading">#</a></h1>
<section id="featureagglomeration">
<h2>FeatureAgglomeration<a class="headerlink" href="#featureagglomeration" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">cluster</span>

<span class="n">agglo</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">FeatureAgglomeration</span><span class="p">(</span><span class="n">affinity</span><span class="o">=</span><span class="s2">&quot;euclidean&quot;</span><span class="p">,</span> <span class="n">linkage</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">,</span> <span class="n">pooling_func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="mi">44</span><span class="p">)</span> <span class="c1"># , n_clusters=361)</span>
<span class="n">agglo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_delete</span><span class="p">)</span>

<span class="n">X_reduced</span> <span class="o">=</span> <span class="n">agglo</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_delete</span><span class="p">)</span>
<span class="n">X_reduced</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6931, 44)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">cluster</span>

<span class="n">agglo</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">FeatureAgglomeration</span><span class="p">(</span><span class="n">affinity</span><span class="o">=</span><span class="s2">&quot;euclidean&quot;</span><span class="p">,</span> <span class="n">linkage</span><span class="o">=</span><span class="s2">&quot;average&quot;</span><span class="p">,</span> <span class="n">pooling_func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">,</span> <span class="n">n_clusters</span><span class="o">=</span><span class="mi">44</span><span class="p">)</span> <span class="c1"># , n_clusters=361)</span>
<span class="n">agglo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">X_test_reduced</span> <span class="o">=</span> <span class="n">agglo</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">X_test_reduced</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2527, 44)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span> <span class="s1">&#39;feature_preprocessor:feature_agglomeration:affinity&#39;</span><span class="p">:</span> <span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_preprocessor:feature_agglomeration:linkage&#39;</span><span class="p">:</span> <span class="s1">&#39;average&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_preprocessor:feature_agglomeration:n_clusters&#39;</span><span class="p">:</span> <span class="mi">361</span><span class="p">,</span> <span class="s1">&#39;feature_preprocessor:feature_agglomeration:pooling_func&#39;</span><span class="p">:</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> 
</pre></div>
</div>
</div>
</div>
<p>#PCA</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;PCA - number of components&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;cumulative explained variance&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;cumulative explained variance&#39;)
</pre></div>
</div>
<img alt="../../_images/78a8cdad4f185efc261b9ddfd15dc36f3090d0cad4a998e89840ca0364bbf97b.png" src="../../_images/78a8cdad4f185efc261b9ddfd15dc36f3090d0cad4a998e89840ca0364bbf97b.png" />
</div>
</div>
<p>##performance compare using PCA</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">n_features</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# features&quot;</span><span class="p">,</span> <span class="n">n_features</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_features</span><span class="p">)</span>
    <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">ridge_rg</span><span class="p">(</span><span class="n">X_pca</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># features 15 
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-149-c0bdd76f2bd4&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">6</span>     <span class="n">ridge_rg</span><span class="p">(</span><span class="n">X_pca</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;ridge_rg&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">n_features</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# features&quot;</span><span class="p">,</span> <span class="n">n_features</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_features</span><span class="p">)</span>
    <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="c1">#ext_rg(X_pca)</span>
    <span class="n">ext_rg</span><span class="p">(</span><span class="n">X_pca</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for n_features in range(15,46,5):</span>
<span class="c1">#     print(&quot;# features&quot;, n_features, end=&quot; &quot;)</span>
<span class="c1">#     pca = PCA(n_components=n_features)</span>
<span class="c1">#     pca.fit(X_train)</span>
<span class="c1">#     X_pca = pca.transform(X_train)</span>
<span class="c1">#     X_pca_test = pca.transform(X_test)</span>
<span class="c1">#     #submission</span>
<span class="c1">#     ext_model = ExtraTreeRegressor(random_state=SEED, max_depth=21, splitter=&quot;best&quot;)</span>

<span class="c1">#     #ext_model.fit(X_train_cleaned, y_train_cleaned)</span>
<span class="c1">#     ext_model.fit(X_pca, y_train)</span>

<span class="c1">#     y_pred = ext_model.predict(X_pca_test)</span>

<span class="c1">#     from sklearn.metrics import mean_squared_error</span>
<span class="c1">#     a = mean_squared_error(y_pred, y_test, squared=False)</span>
<span class="c1">#     print(a)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># features 15 168.14742867151642
# features 20 189.1521141726684
# features 25 187.66648479503453
# features 30 184.77552379677832
# features 35 195.20320081495618
# features 40 191.40486048761647
# features 45 195.37489487992585
</pre></div>
</div>
</div>
</div>
<p>#Baseline score</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load libraries</span>

<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">set_option</span>
<span class="c1">#from pandas.tools.plotting import scatter_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span> <span class="c1"># scoring - https://scikit-learn.org/stable/modules/model_evaluation.html</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>

<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>#TabNet</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!pip install pytorch-tabnet</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytorch_tabnet.tab_model</span> <span class="kn">import</span> <span class="n">TabNetRegressor</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="c1">#criterion = torch.nn.MSELoss()</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">L1Loss</span><span class="p">()</span>

<span class="c1"># class RMSELoss(nn.Module):</span>
<span class="c1">#     def __init__(self, eps=1e-8):</span>
<span class="c1">#         super().__init__()</span>
<span class="c1">#         self.mse = nn.MSELoss()</span>
<span class="c1">#         self.eps = eps</span>
        
<span class="c1">#     def forward(self,yhat,y):</span>
<span class="c1">#         loss = torch.sqrt(self.mse(yhat,y) + self.eps)</span>
<span class="c1">#         return loss</span>

<span class="c1"># criterion = RMSELoss()</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">TabNetRegressor</span><span class="p">(</span>
    <span class="n">optimizer_fn</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">,</span>
    <span class="n">optimizer_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">9e-1</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">5e-4</span><span class="p">,</span> <span class="n">nesterov</span> <span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="c1"># 7 -&gt; 250</span>
    <span class="n">scheduler_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;patience&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;factor&quot;</span><span class="p">:</span><span class="mf">0.7</span><span class="p">},</span> <span class="c1"># 5, 0.7</span>
    <span class="c1">#n_steps=3,</span>
    <span class="n">lambda_sparse</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
    <span class="n">scheduler_fn</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">ReduceLROnPlateau</span><span class="p">,</span> <span class="n">mask_type</span><span class="o">=</span><span class="s1">&#39;entmax&#39;</span> 
    <span class="c1">#scheduler_fn=torch.optim.lr_scheduler.StepLR, mask_type=&#39;entmax&#39; # StepLR</span>
<span class="p">)</span>  

<span class="c1"># scheduler_params={&quot;step_size&quot;:10, # how to use learning rate scheduler</span>
<span class="c1">#                     &quot;gamma&quot;:0.7},</span>

<span class="c1"># y_train_net = y_delete.values.reshape(-1, 1)</span>
<span class="c1"># X_train_net = X_delete.values</span>

<span class="n">y_train_net</span> <span class="o">=</span> <span class="n">y_delete</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">X_train_net</span> <span class="o">=</span> <span class="n">X_scaled</span>

<span class="c1"># y_train_net = y_train.values.reshape(-1, 1)</span>
<span class="c1"># X_train_net = X_train.values</span>

<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
  <span class="n">X_train_net</span><span class="p">,</span> <span class="n">y_train_net</span><span class="p">,</span>
  <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">X_train_net</span><span class="p">,</span> <span class="n">y_train_net</span><span class="p">)],</span>
  <span class="n">eval_metric</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">],</span>
  <span class="n">max_epochs</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
  <span class="n">batch_size</span><span class="o">=</span><span class="mi">1024</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">virtual_batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
  <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
  <span class="n">patience</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
  <span class="n">loss_fn</span><span class="o">=</span><span class="n">criterion</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Device used : cuda
epoch 0  | loss: 15383.74796| val_0_rmse: 20871.8557|  0:00:00s
epoch 1  | loss: 15377.08634| val_0_rmse: 20853.42957|  0:00:00s
epoch 2  | loss: 15332.95692| val_0_rmse: 20727.96772|  0:00:01s
epoch 3  | loss: 15104.7989| val_0_rmse: 20272.3371|  0:00:01s
epoch 4  | loss: 14302.26489| val_0_rmse: 19000.18078|  0:00:01s
epoch 5  | loss: 12433.65079| val_0_rmse: 17297.30771|  0:00:01s
epoch 6  | loss: 9342.0368| val_0_rmse: 16835.30316|  0:00:02s
epoch 7  | loss: 7351.87619| val_0_rmse: 15392.02197|  0:00:02s
epoch 8  | loss: 7476.71652| val_0_rmse: 10772.26357|  0:00:03s
epoch 9  | loss: 6751.04557| val_0_rmse: 11512.46126|  0:00:03s
epoch 10 | loss: 5494.20289| val_0_rmse: 9879.65493|  0:00:03s
epoch 11 | loss: 4667.32959| val_0_rmse: 10297.51952|  0:00:04s
epoch 12 | loss: 4523.28553| val_0_rmse: 8872.59179|  0:00:04s
epoch 13 | loss: 3862.51647| val_0_rmse: 9890.17355|  0:00:04s
epoch 14 | loss: 3232.31004| val_0_rmse: 6278.20827|  0:00:05s
epoch 15 | loss: 2680.84944| val_0_rmse: 14841.73591|  0:00:05s
epoch 16 | loss: 1700.7792| val_0_rmse: 13043.2708|  0:00:05s
epoch 17 | loss: 1269.21187| val_0_rmse: 9414.43271|  0:00:05s
epoch 18 | loss: 1024.86142| val_0_rmse: 1164.71386|  0:00:06s
epoch 19 | loss: 1126.67504| val_0_rmse: 3455.35258|  0:00:06s
epoch 20 | loss: 1324.41327| val_0_rmse: 2681.43834|  0:00:06s
epoch 21 | loss: 1066.77404| val_0_rmse: 2973.03809|  0:00:07s
epoch 22 | loss: 1217.94097| val_0_rmse: 2700.43143|  0:00:07s
epoch 23 | loss: 1289.55254| val_0_rmse: 1792.07388|  0:00:07s
epoch 24 | loss: 1244.9865| val_0_rmse: 1771.05465|  0:00:08s
epoch 25 | loss: 1008.70281| val_0_rmse: 2448.51429|  0:00:08s
epoch 26 | loss: 1180.57997| val_0_rmse: 1311.03688|  0:00:08s
epoch 27 | loss: 1115.99997| val_0_rmse: 1383.76203|  0:00:09s
epoch 28 | loss: 1044.6621| val_0_rmse: 1161.70551|  0:00:09s
epoch 29 | loss: 1395.77444| val_0_rmse: 1394.4733|  0:00:09s
epoch 30 | loss: 1129.12751| val_0_rmse: 1556.70433|  0:00:10s
epoch 31 | loss: 1099.13101| val_0_rmse: 2000.19878|  0:00:10s
epoch 32 | loss: 1109.41025| val_0_rmse: 1344.81859|  0:00:10s
epoch 33 | loss: 1062.51602| val_0_rmse: 2744.10408|  0:00:11s
epoch 34 | loss: 1020.28153| val_0_rmse: 1055.80794|  0:00:11s
epoch 35 | loss: 1169.25984| val_0_rmse: 2492.17071|  0:00:11s
epoch 36 | loss: 1229.93882| val_0_rmse: 666.00948|  0:00:12s
epoch 37 | loss: 1021.43756| val_0_rmse: 1884.03683|  0:00:12s
epoch 38 | loss: 1247.26298| val_0_rmse: 820.95524|  0:00:12s
epoch 39 | loss: 1181.17994| val_0_rmse: 1599.54467|  0:00:13s
epoch 40 | loss: 1018.20645| val_0_rmse: 1157.74123|  0:00:13s
epoch 41 | loss: 1214.44794| val_0_rmse: 908.49951|  0:00:13s
epoch 42 | loss: 1182.30152| val_0_rmse: 1885.34903|  0:00:14s
epoch 43 | loss: 1060.45218| val_0_rmse: 1455.30289|  0:00:14s
epoch 44 | loss: 1153.9477| val_0_rmse: 1811.71702|  0:00:14s
epoch 45 | loss: 1086.04336| val_0_rmse: 1083.24652|  0:00:15s
epoch 46 | loss: 1049.82788| val_0_rmse: 1102.5988|  0:00:15s
epoch 47 | loss: 1050.24967| val_0_rmse: 2832.64156|  0:00:15s
epoch 48 | loss: 1079.55991| val_0_rmse: 1188.75111|  0:00:16s
epoch 49 | loss: 1032.55549| val_0_rmse: 774.50217|  0:00:16s
epoch 50 | loss: 1243.24045| val_0_rmse: 1000.2235|  0:00:16s
epoch 51 | loss: 1024.76835| val_0_rmse: 1016.13037|  0:00:16s
epoch 52 | loss: 961.69266| val_0_rmse: 1715.57262|  0:00:17s
epoch 53 | loss: 1126.23459| val_0_rmse: 1252.82037|  0:00:17s
epoch 54 | loss: 955.24083| val_0_rmse: 528.51947|  0:00:17s
epoch 55 | loss: 873.41541| val_0_rmse: 619.85041|  0:00:18s
epoch 56 | loss: 993.79623| val_0_rmse: 1431.35065|  0:00:18s
epoch 57 | loss: 1233.6993| val_0_rmse: 428.138 |  0:00:18s
epoch 58 | loss: 1022.93836| val_0_rmse: 1125.86517|  0:00:19s
epoch 59 | loss: 1127.28243| val_0_rmse: 532.16783|  0:00:19s
epoch 60 | loss: 1216.1286| val_0_rmse: 1959.06392|  0:00:19s
epoch 61 | loss: 1021.77763| val_0_rmse: 1519.30346|  0:00:20s
epoch 62 | loss: 1051.39611| val_0_rmse: 1294.05571|  0:00:20s
epoch 63 | loss: 1046.38175| val_0_rmse: 1392.26641|  0:00:20s
epoch 64 | loss: 1141.66201| val_0_rmse: 758.20799|  0:00:21s
epoch 65 | loss: 1027.60985| val_0_rmse: 1998.04427|  0:00:21s
epoch 66 | loss: 1210.66045| val_0_rmse: 2476.67543|  0:00:21s
epoch 67 | loss: 819.11585| val_0_rmse: 955.35153|  0:00:22s
epoch 68 | loss: 785.67879| val_0_rmse: 273.5246|  0:00:22s
epoch 69 | loss: 1012.90995| val_0_rmse: 657.10532|  0:00:22s
epoch 70 | loss: 976.19394| val_0_rmse: 1821.6502|  0:00:23s
epoch 71 | loss: 1020.05084| val_0_rmse: 1367.34244|  0:00:23s
epoch 72 | loss: 975.55922| val_0_rmse: 503.52247|  0:00:23s
epoch 73 | loss: 999.88751| val_0_rmse: 1746.08024|  0:00:24s
epoch 74 | loss: 1020.0052| val_0_rmse: 1153.19114|  0:00:24s
epoch 75 | loss: 1151.6459| val_0_rmse: 2470.3298|  0:00:24s
epoch 76 | loss: 931.20653| val_0_rmse: 1215.88265|  0:00:25s
epoch 77 | loss: 1002.72711| val_0_rmse: 3137.85244|  0:00:25s
epoch 78 | loss: 957.18269| val_0_rmse: 726.32051|  0:00:25s
epoch 79 | loss: 1010.73984| val_0_rmse: 617.18243|  0:00:26s
epoch 80 | loss: 1083.05176| val_0_rmse: 466.71262|  0:00:26s
epoch 81 | loss: 955.52577| val_0_rmse: 765.79269|  0:00:26s
epoch 82 | loss: 890.24052| val_0_rmse: 1164.36947|  0:00:27s
epoch 83 | loss: 950.08731| val_0_rmse: 1994.77306|  0:00:27s
epoch 84 | loss: 1063.53492| val_0_rmse: 682.58045|  0:00:27s
epoch 85 | loss: 930.95398| val_0_rmse: 1674.4135|  0:00:28s
epoch 86 | loss: 1033.14685| val_0_rmse: 784.8127|  0:00:28s
epoch 87 | loss: 944.67497| val_0_rmse: 911.04797|  0:00:28s
epoch 88 | loss: 820.92347| val_0_rmse: 1656.77515|  0:00:29s
epoch 89 | loss: 891.6126| val_0_rmse: 2418.38225|  0:00:29s
epoch 90 | loss: 948.88329| val_0_rmse: 694.39128|  0:00:29s
epoch 91 | loss: 883.03655| val_0_rmse: 1272.04447|  0:00:30s
epoch 92 | loss: 916.96259| val_0_rmse: 3030.4508|  0:00:30s
epoch 93 | loss: 1130.03461| val_0_rmse: 1600.68115|  0:00:30s
epoch 94 | loss: 882.01821| val_0_rmse: 351.93759|  0:00:31s
epoch 95 | loss: 993.37242| val_0_rmse: 572.25289|  0:00:31s
epoch 96 | loss: 966.90183| val_0_rmse: 891.93367|  0:00:31s
epoch 97 | loss: 752.06626| val_0_rmse: 852.67893|  0:00:32s
epoch 98 | loss: 906.17603| val_0_rmse: 432.83634|  0:00:32s
epoch 99 | loss: 988.53105| val_0_rmse: 1704.85859|  0:00:32s
epoch 100| loss: 791.93803| val_0_rmse: 3195.2082|  0:00:33s
epoch 101| loss: 827.3178| val_0_rmse: 3075.15443|  0:00:33s
epoch 102| loss: 1001.87178| val_0_rmse: 1898.30548|  0:00:33s
epoch 103| loss: 863.21853| val_0_rmse: 1078.32485|  0:00:34s
epoch 104| loss: 696.66993| val_0_rmse: 317.94375|  0:00:34s
epoch 105| loss: 961.55084| val_0_rmse: 794.36796|  0:00:34s
epoch 106| loss: 875.18467| val_0_rmse: 723.75986|  0:00:35s
epoch 107| loss: 860.50749| val_0_rmse: 670.11475|  0:00:35s
epoch 108| loss: 994.5111| val_0_rmse: 1475.24958|  0:00:35s
epoch 109| loss: 925.09206| val_0_rmse: 1693.20281|  0:00:36s
epoch 110| loss: 1182.81142| val_0_rmse: 1085.98511|  0:00:36s
epoch 111| loss: 868.38145| val_0_rmse: 558.22228|  0:00:36s
epoch 112| loss: 894.40939| val_0_rmse: 604.40667|  0:00:37s
epoch 113| loss: 778.36721| val_0_rmse: 711.25843|  0:00:37s
epoch 114| loss: 914.04849| val_0_rmse: 1853.93456|  0:00:37s
epoch 115| loss: 1171.13095| val_0_rmse: 1766.49206|  0:00:37s
epoch 116| loss: 960.18204| val_0_rmse: 1271.58757|  0:00:38s
epoch 117| loss: 856.59586| val_0_rmse: 374.3988|  0:00:38s
epoch 118| loss: 795.72472| val_0_rmse: 967.21102|  0:00:38s
epoch 119| loss: 845.99771| val_0_rmse: 1663.05781|  0:00:39s
epoch 120| loss: 714.42093| val_0_rmse: 1821.91026|  0:00:39s
epoch 121| loss: 923.86912| val_0_rmse: 2709.88254|  0:00:39s
epoch 122| loss: 649.50639| val_0_rmse: 501.18161|  0:00:40s
epoch 123| loss: 656.2344| val_0_rmse: 759.39188|  0:00:40s
epoch 124| loss: 770.31202| val_0_rmse: 2213.18895|  0:00:40s
epoch 125| loss: 849.7495| val_0_rmse: 1648.45866|  0:00:41s
epoch 126| loss: 753.14835| val_0_rmse: 1911.85168|  0:00:41s
epoch 127| loss: 836.62125| val_0_rmse: 786.91948|  0:00:41s
epoch 128| loss: 739.19819| val_0_rmse: 1031.8384|  0:00:42s
epoch 129| loss: 753.24204| val_0_rmse: 1934.90654|  0:00:42s
epoch 130| loss: 712.32419| val_0_rmse: 543.97809|  0:00:42s
epoch 131| loss: 808.76901| val_0_rmse: 860.01264|  0:00:43s
epoch 132| loss: 795.47274| val_0_rmse: 641.38055|  0:00:43s
epoch 133| loss: 655.67759| val_0_rmse: 2783.75686|  0:00:43s
epoch 134| loss: 904.60535| val_0_rmse: 627.93456|  0:00:44s
epoch 135| loss: 694.17548| val_0_rmse: 1007.02204|  0:00:44s
epoch 136| loss: 663.30564| val_0_rmse: 684.75167|  0:00:44s
epoch 137| loss: 666.6291| val_0_rmse: 2045.74612|  0:00:45s
epoch 138| loss: 904.50226| val_0_rmse: 1262.84181|  0:00:45s
epoch 139| loss: 688.93062| val_0_rmse: 2189.13012|  0:00:45s
epoch 140| loss: 716.70929| val_0_rmse: 380.40007|  0:00:46s
epoch 141| loss: 675.73614| val_0_rmse: 707.05279|  0:00:46s
epoch 142| loss: 727.37843| val_0_rmse: 683.21442|  0:00:46s
epoch 143| loss: 658.63747| val_0_rmse: 1952.75287|  0:00:47s
epoch 144| loss: 1095.97488| val_0_rmse: 2980.90999|  0:00:47s
epoch 145| loss: 1239.78875| val_0_rmse: 583.3558|  0:00:47s
epoch 146| loss: 685.64797| val_0_rmse: 293.54394|  0:00:48s
epoch 147| loss: 610.19849| val_0_rmse: 1312.11641|  0:00:48s
epoch 148| loss: 858.74327| val_0_rmse: 1345.06019|  0:00:48s
epoch 149| loss: 704.65503| val_0_rmse: 1661.38725|  0:00:49s
epoch 150| loss: 720.10001| val_0_rmse: 1463.17916|  0:00:49s
epoch 151| loss: 708.21034| val_0_rmse: 1143.56902|  0:00:49s
epoch 152| loss: 718.92223| val_0_rmse: 1220.51636|  0:00:49s
epoch 153| loss: 735.60171| val_0_rmse: 269.21477|  0:00:50s
epoch 154| loss: 827.22864| val_0_rmse: 1732.21193|  0:00:50s
epoch 155| loss: 743.04969| val_0_rmse: 779.20586|  0:00:51s
epoch 156| loss: 561.59607| val_0_rmse: 1080.75297|  0:00:51s
epoch 157| loss: 783.03509| val_0_rmse: 2406.39388|  0:00:51s
epoch 158| loss: 730.44057| val_0_rmse: 839.28133|  0:00:51s
epoch 159| loss: 724.74056| val_0_rmse: 570.50507|  0:00:52s
epoch 160| loss: 691.77502| val_0_rmse: 694.11146|  0:00:52s
epoch 161| loss: 687.54158| val_0_rmse: 1292.5415|  0:00:52s
epoch 162| loss: 841.76807| val_0_rmse: 1610.27744|  0:00:53s
epoch 163| loss: 664.86148| val_0_rmse: 1305.85232|  0:00:53s
epoch 164| loss: 607.43216| val_0_rmse: 1096.38765|  0:00:53s
epoch 165| loss: 687.68522| val_0_rmse: 471.86578|  0:00:54s
epoch 166| loss: 764.48634| val_0_rmse: 1432.30534|  0:00:54s
epoch 167| loss: 586.81474| val_0_rmse: 1034.47245|  0:00:54s
epoch 168| loss: 603.59442| val_0_rmse: 749.1932|  0:00:55s
epoch 169| loss: 653.95604| val_0_rmse: 1010.96613|  0:00:55s
epoch 170| loss: 673.77557| val_0_rmse: 486.75405|  0:00:55s
epoch 171| loss: 686.30328| val_0_rmse: 470.83742|  0:00:56s
epoch 172| loss: 648.03866| val_0_rmse: 318.98265|  0:00:56s
epoch 173| loss: 559.34644| val_0_rmse: 807.26415|  0:00:56s
epoch 174| loss: 598.88651| val_0_rmse: 1016.26098|  0:00:57s
epoch 175| loss: 625.38742| val_0_rmse: 664.03321|  0:00:57s
epoch 176| loss: 762.15783| val_0_rmse: 792.48149|  0:00:57s
epoch 177| loss: 638.33213| val_0_rmse: 739.17807|  0:00:58s
epoch 178| loss: 739.72233| val_0_rmse: 963.72436|  0:00:58s
epoch 179| loss: 604.21267| val_0_rmse: 1172.69749|  0:00:58s
epoch 180| loss: 678.50648| val_0_rmse: 1306.2589|  0:00:59s
epoch 181| loss: 730.19376| val_0_rmse: 1042.8117|  0:00:59s
epoch 182| loss: 575.9482| val_0_rmse: 697.50373|  0:00:59s
epoch 183| loss: 715.61283| val_0_rmse: 778.67068|  0:01:00s
epoch 184| loss: 632.63323| val_0_rmse: 825.73881|  0:01:00s
epoch 185| loss: 730.80087| val_0_rmse: 658.98325|  0:01:00s
epoch 186| loss: 643.99971| val_0_rmse: 983.89316|  0:01:01s
epoch 187| loss: 742.1372| val_0_rmse: 872.94688|  0:01:01s
epoch 188| loss: 869.8008| val_0_rmse: 963.27469|  0:01:01s
epoch 189| loss: 610.76895| val_0_rmse: 1038.37889|  0:01:02s
epoch 190| loss: 631.90802| val_0_rmse: 1033.0225|  0:01:02s
epoch 191| loss: 669.40349| val_0_rmse: 1051.96043|  0:01:02s
epoch 192| loss: 716.24454| val_0_rmse: 836.44888|  0:01:03s
epoch 193| loss: 556.34493| val_0_rmse: 712.8488|  0:01:03s
epoch 194| loss: 562.51421| val_0_rmse: 696.50354|  0:01:03s
epoch 195| loss: 707.78064| val_0_rmse: 1121.06037|  0:01:04s
epoch 196| loss: 715.84908| val_0_rmse: 1136.43046|  0:01:04s
epoch 197| loss: 689.62639| val_0_rmse: 769.5364|  0:01:04s
epoch 198| loss: 586.43469| val_0_rmse: 574.43675|  0:01:05s
epoch 199| loss: 757.30351| val_0_rmse: 735.76683|  0:01:05s
epoch 200| loss: 687.55176| val_0_rmse: 1026.16817|  0:01:05s
epoch 201| loss: 649.11818| val_0_rmse: 987.0765|  0:01:06s
epoch 202| loss: 671.46789| val_0_rmse: 809.58606|  0:01:06s
epoch 203| loss: 641.17037| val_0_rmse: 490.82273|  0:01:06s
epoch 204| loss: 690.37281| val_0_rmse: 612.97676|  0:01:07s
epoch 205| loss: 646.46648| val_0_rmse: 761.70948|  0:01:07s
epoch 206| loss: 663.11092| val_0_rmse: 1016.34662|  0:01:07s
epoch 207| loss: 733.32281| val_0_rmse: 1198.37564|  0:01:08s
epoch 208| loss: 608.78415| val_0_rmse: 1048.97521|  0:01:08s
epoch 209| loss: 577.29583| val_0_rmse: 899.99671|  0:01:08s
epoch 210| loss: 879.82324| val_0_rmse: 806.65712|  0:01:08s
epoch 211| loss: 686.43054| val_0_rmse: 634.51969|  0:01:09s
epoch 212| loss: 589.73648| val_0_rmse: 444.24784|  0:01:09s
epoch 213| loss: 589.42313| val_0_rmse: 600.94659|  0:01:10s
epoch 214| loss: 656.43823| val_0_rmse: 802.05142|  0:01:10s
epoch 215| loss: 712.47647| val_0_rmse: 919.45989|  0:01:10s
epoch 216| loss: 627.99809| val_0_rmse: 841.14625|  0:01:10s
epoch 217| loss: 637.66622| val_0_rmse: 782.71933|  0:01:11s
epoch 218| loss: 623.238 | val_0_rmse: 625.99267|  0:01:11s
epoch 219| loss: 647.54327| val_0_rmse: 849.7763|  0:01:11s
epoch 220| loss: 690.79333| val_0_rmse: 942.30351|  0:01:12s
epoch 221| loss: 644.57187| val_0_rmse: 918.33605|  0:01:12s
epoch 222| loss: 649.18577| val_0_rmse: 854.72585|  0:01:12s
epoch 223| loss: 596.08921| val_0_rmse: 579.18845|  0:01:13s
epoch 224| loss: 698.64025| val_0_rmse: 828.61643|  0:01:13s
epoch 225| loss: 719.71312| val_0_rmse: 1054.38368|  0:01:13s
epoch 226| loss: 697.44944| val_0_rmse: 958.92633|  0:01:14s
epoch 227| loss: 684.92476| val_0_rmse: 922.86794|  0:01:14s
epoch 228| loss: 600.40882| val_0_rmse: 840.03115|  0:01:14s
epoch 229| loss: 521.65149| val_0_rmse: 683.70147|  0:01:15s
epoch 230| loss: 566.4053| val_0_rmse: 513.72131|  0:01:15s
epoch 231| loss: 608.63586| val_0_rmse: 665.12069|  0:01:15s
epoch 232| loss: 530.6461| val_0_rmse: 855.19843|  0:01:16s
epoch 233| loss: 688.55103| val_0_rmse: 1003.46802|  0:01:16s
epoch 234| loss: 581.75444| val_0_rmse: 715.688 |  0:01:16s
epoch 235| loss: 606.88579| val_0_rmse: 714.46583|  0:01:17s
epoch 236| loss: 523.94473| val_0_rmse: 738.89638|  0:01:17s
epoch 237| loss: 615.70177| val_0_rmse: 907.23742|  0:01:17s
epoch 238| loss: 627.16348| val_0_rmse: 760.40032|  0:01:18s
epoch 239| loss: 589.31389| val_0_rmse: 801.88168|  0:01:18s
epoch 240| loss: 508.61754| val_0_rmse: 744.1287|  0:01:18s
epoch 241| loss: 693.63839| val_0_rmse: 773.89126|  0:01:19s
epoch 242| loss: 648.4201| val_0_rmse: 766.75149|  0:01:19s
epoch 243| loss: 741.77207| val_0_rmse: 839.4761|  0:01:19s
epoch 244| loss: 588.03488| val_0_rmse: 699.40201|  0:01:20s
epoch 245| loss: 643.77284| val_0_rmse: 784.91812|  0:01:20s
epoch 246| loss: 627.22055| val_0_rmse: 651.02804|  0:01:20s
epoch 247| loss: 566.22021| val_0_rmse: 682.84463|  0:01:21s
epoch 248| loss: 537.61247| val_0_rmse: 749.78413|  0:01:21s
epoch 249| loss: 694.01087| val_0_rmse: 863.47116|  0:01:21s
epoch 250| loss: 635.79076| val_0_rmse: 963.57989|  0:01:21s
epoch 251| loss: 593.61305| val_0_rmse: 865.34655|  0:01:22s
epoch 252| loss: 637.58064| val_0_rmse: 709.01996|  0:01:22s
epoch 253| loss: 659.78022| val_0_rmse: 613.78412|  0:01:22s
epoch 254| loss: 630.92955| val_0_rmse: 662.94636|  0:01:23s
epoch 255| loss: 654.97217| val_0_rmse: 837.38276|  0:01:23s
epoch 256| loss: 674.60894| val_0_rmse: 899.66138|  0:01:23s
epoch 257| loss: 615.63969| val_0_rmse: 854.78817|  0:01:24s
epoch 258| loss: 614.16575| val_0_rmse: 834.28244|  0:01:24s
epoch 259| loss: 644.85316| val_0_rmse: 802.31684|  0:01:24s
epoch 260| loss: 652.10361| val_0_rmse: 884.48061|  0:01:25s
epoch 261| loss: 543.20969| val_0_rmse: 890.40853|  0:01:25s
epoch 262| loss: 542.58097| val_0_rmse: 754.12584|  0:01:25s
epoch 263| loss: 692.97981| val_0_rmse: 876.32366|  0:01:26s
epoch 264| loss: 742.85151| val_0_rmse: 883.00713|  0:01:26s
epoch 265| loss: 658.84051| val_0_rmse: 864.98951|  0:01:26s
epoch 266| loss: 697.64505| val_0_rmse: 923.68497|  0:01:27s
epoch 267| loss: 603.38603| val_0_rmse: 795.92228|  0:01:27s
epoch 268| loss: 608.70209| val_0_rmse: 800.37272|  0:01:27s
epoch 269| loss: 571.39687| val_0_rmse: 768.82035|  0:01:28s
epoch 270| loss: 659.25033| val_0_rmse: 833.19779|  0:01:28s
epoch 271| loss: 619.55815| val_0_rmse: 825.41916|  0:01:28s
epoch 272| loss: 562.4479| val_0_rmse: 804.14553|  0:01:29s
epoch 273| loss: 676.54113| val_0_rmse: 933.2382|  0:01:29s
epoch 274| loss: 554.16433| val_0_rmse: 773.05774|  0:01:29s
epoch 275| loss: 595.97684| val_0_rmse: 735.79935|  0:01:29s
epoch 276| loss: 590.11908| val_0_rmse: 785.93849|  0:01:30s
epoch 277| loss: 730.26947| val_0_rmse: 792.01651|  0:01:30s
epoch 278| loss: 652.14268| val_0_rmse: 942.26797|  0:01:30s
epoch 279| loss: 676.80825| val_0_rmse: 747.22137|  0:01:31s
epoch 280| loss: 651.50329| val_0_rmse: 732.66597|  0:01:31s
epoch 281| loss: 677.69813| val_0_rmse: 798.66427|  0:01:31s
epoch 282| loss: 713.02005| val_0_rmse: 803.98659|  0:01:32s
epoch 283| loss: 735.66748| val_0_rmse: 909.19103|  0:01:32s
epoch 284| loss: 606.91314| val_0_rmse: 824.90634|  0:01:32s
epoch 285| loss: 673.44901| val_0_rmse: 930.824 |  0:01:33s
epoch 286| loss: 632.47607| val_0_rmse: 941.49846|  0:01:33s
epoch 287| loss: 635.57694| val_0_rmse: 819.90896|  0:01:33s
epoch 288| loss: 581.04002| val_0_rmse: 872.21457|  0:01:34s
epoch 289| loss: 841.56514| val_0_rmse: 961.75522|  0:01:34s
epoch 290| loss: 606.07037| val_0_rmse: 903.40937|  0:01:34s
epoch 291| loss: 685.32481| val_0_rmse: 850.19462|  0:01:35s
epoch 292| loss: 608.32438| val_0_rmse: 779.78668|  0:01:35s
epoch 293| loss: 656.1049| val_0_rmse: 895.74045|  0:01:35s
epoch 294| loss: 615.83444| val_0_rmse: 774.05542|  0:01:36s
epoch 295| loss: 616.73077| val_0_rmse: 761.7971|  0:01:36s
epoch 296| loss: 534.19808| val_0_rmse: 852.88929|  0:01:36s
epoch 297| loss: 588.04239| val_0_rmse: 807.10139|  0:01:37s
epoch 298| loss: 621.56352| val_0_rmse: 842.4037|  0:01:37s
epoch 299| loss: 673.51926| val_0_rmse: 893.81118|  0:01:37s
epoch 300| loss: 704.5639| val_0_rmse: 923.23966|  0:01:38s
epoch 301| loss: 529.72723| val_0_rmse: 790.2869|  0:01:38s
epoch 302| loss: 668.05417| val_0_rmse: 773.92455|  0:01:38s
epoch 303| loss: 763.00622| val_0_rmse: 913.31936|  0:01:39s
epoch 304| loss: 739.50499| val_0_rmse: 931.71867|  0:01:39s
epoch 305| loss: 507.82615| val_0_rmse: 789.21263|  0:01:39s
epoch 306| loss: 606.11607| val_0_rmse: 760.1402|  0:01:40s
epoch 307| loss: 612.74664| val_0_rmse: 745.4184|  0:01:40s
epoch 308| loss: 633.77292| val_0_rmse: 754.54149|  0:01:40s
epoch 309| loss: 631.52411| val_0_rmse: 745.58076|  0:01:41s
epoch 310| loss: 718.85119| val_0_rmse: 920.50404|  0:01:41s
epoch 311| loss: 630.62939| val_0_rmse: 822.7101|  0:01:41s
epoch 312| loss: 594.23688| val_0_rmse: 769.45466|  0:01:42s
epoch 313| loss: 684.54023| val_0_rmse: 936.96747|  0:01:42s
epoch 314| loss: 704.86774| val_0_rmse: 995.92536|  0:01:42s
epoch 315| loss: 478.77709| val_0_rmse: 817.10039|  0:01:43s
epoch 316| loss: 674.61845| val_0_rmse: 887.12379|  0:01:43s
epoch 317| loss: 723.53747| val_0_rmse: 894.02364|  0:01:43s
epoch 318| loss: 631.27734| val_0_rmse: 793.93243|  0:01:44s
epoch 319| loss: 678.14411| val_0_rmse: 884.38037|  0:01:44s
epoch 320| loss: 638.18084| val_0_rmse: 833.03109|  0:01:44s
epoch 321| loss: 634.05803| val_0_rmse: 837.61618|  0:01:45s
epoch 322| loss: 591.56643| val_0_rmse: 853.32489|  0:01:45s
epoch 323| loss: 639.17998| val_0_rmse: 838.03485|  0:01:45s
epoch 324| loss: 595.91438| val_0_rmse: 800.09765|  0:01:46s
epoch 325| loss: 648.78792| val_0_rmse: 900.56996|  0:01:46s
epoch 326| loss: 511.91412| val_0_rmse: 693.3009|  0:01:46s
epoch 327| loss: 591.45231| val_0_rmse: 828.78456|  0:01:47s
epoch 328| loss: 661.83948| val_0_rmse: 961.4829|  0:01:47s
epoch 329| loss: 571.95642| val_0_rmse: 803.46553|  0:01:47s
epoch 330| loss: 616.71178| val_0_rmse: 798.34631|  0:01:48s
epoch 331| loss: 579.62023| val_0_rmse: 808.17572|  0:01:48s
epoch 332| loss: 668.3341| val_0_rmse: 928.17702|  0:01:48s
epoch 333| loss: 693.7509| val_0_rmse: 933.8369|  0:01:49s
epoch 334| loss: 636.97938| val_0_rmse: 876.11979|  0:01:49s
epoch 335| loss: 774.29929| val_0_rmse: 898.8715|  0:01:49s
epoch 336| loss: 607.2768| val_0_rmse: 936.27224|  0:01:50s
epoch 337| loss: 688.80398| val_0_rmse: 865.70791|  0:01:50s
epoch 338| loss: 558.84119| val_0_rmse: 789.20271|  0:01:50s
epoch 339| loss: 616.97116| val_0_rmse: 885.10725|  0:01:51s
epoch 340| loss: 702.06919| val_0_rmse: 938.05358|  0:01:51s
epoch 341| loss: 599.08949| val_0_rmse: 769.49847|  0:01:51s
epoch 342| loss: 634.95877| val_0_rmse: 885.22415|  0:01:52s
epoch 343| loss: 563.88217| val_0_rmse: 793.85532|  0:01:52s
epoch 344| loss: 627.29334| val_0_rmse: 730.3468|  0:01:52s
epoch 345| loss: 632.13732| val_0_rmse: 787.25765|  0:01:52s
epoch 346| loss: 716.68168| val_0_rmse: 929.28762|  0:01:53s
epoch 347| loss: 557.68958| val_0_rmse: 837.71005|  0:01:53s
epoch 348| loss: 535.2286| val_0_rmse: 833.30299|  0:01:53s
epoch 349| loss: 587.18246| val_0_rmse: 867.66121|  0:01:54s
epoch 350| loss: 640.82979| val_0_rmse: 914.75443|  0:01:54s
epoch 351| loss: 596.00324| val_0_rmse: 902.36442|  0:01:54s
epoch 352| loss: 758.72884| val_0_rmse: 1060.29621|  0:01:55s
epoch 353| loss: 708.81901| val_0_rmse: 1015.05587|  0:01:55s
epoch 354| loss: 727.19638| val_0_rmse: 980.33031|  0:01:55s
epoch 355| loss: 536.41927| val_0_rmse: 703.67459|  0:01:56s
epoch 356| loss: 632.50849| val_0_rmse: 682.69041|  0:01:56s
epoch 357| loss: 655.70405| val_0_rmse: 790.00559|  0:01:56s
epoch 358| loss: 577.02314| val_0_rmse: 834.95917|  0:01:57s
epoch 359| loss: 679.31845| val_0_rmse: 924.12866|  0:01:57s
epoch 360| loss: 598.90748| val_0_rmse: 717.87419|  0:01:57s
epoch 361| loss: 633.20257| val_0_rmse: 889.85698|  0:01:58s
epoch 362| loss: 592.23585| val_0_rmse: 779.77696|  0:01:58s
epoch 363| loss: 646.83985| val_0_rmse: 806.11963|  0:01:58s
epoch 364| loss: 623.13284| val_0_rmse: 784.51586|  0:01:59s
epoch 365| loss: 619.19234| val_0_rmse: 773.65607|  0:01:59s
epoch 366| loss: 586.7416| val_0_rmse: 729.44596|  0:01:59s
epoch 367| loss: 623.4382| val_0_rmse: 780.96067|  0:02:00s
epoch 368| loss: 602.33024| val_0_rmse: 814.64434|  0:02:00s
epoch 369| loss: 595.49955| val_0_rmse: 826.06534|  0:02:00s
epoch 370| loss: 701.30351| val_0_rmse: 986.98688|  0:02:01s
epoch 371| loss: 617.91532| val_0_rmse: 901.82476|  0:02:01s
epoch 372| loss: 646.8438| val_0_rmse: 870.75244|  0:02:01s
epoch 373| loss: 701.97185| val_0_rmse: 833.52565|  0:02:02s
epoch 374| loss: 654.21728| val_0_rmse: 872.7599|  0:02:02s
epoch 375| loss: 635.04553| val_0_rmse: 864.64937|  0:02:02s
epoch 376| loss: 608.67277| val_0_rmse: 814.10488|  0:02:03s
epoch 377| loss: 708.84631| val_0_rmse: 869.18742|  0:02:03s
epoch 378| loss: 592.60806| val_0_rmse: 857.76325|  0:02:03s
epoch 379| loss: 624.75615| val_0_rmse: 893.19586|  0:02:04s
epoch 380| loss: 663.316 | val_0_rmse: 789.28374|  0:02:04s
epoch 381| loss: 682.85168| val_0_rmse: 842.74373|  0:02:04s
epoch 382| loss: 583.52365| val_0_rmse: 792.14863|  0:02:04s
epoch 383| loss: 603.3215| val_0_rmse: 797.24732|  0:02:05s
epoch 384| loss: 643.85557| val_0_rmse: 744.84791|  0:02:05s
epoch 385| loss: 685.69005| val_0_rmse: 875.24594|  0:02:06s
epoch 386| loss: 610.27685| val_0_rmse: 881.63249|  0:02:06s
epoch 387| loss: 596.9058| val_0_rmse: 764.22809|  0:02:06s
epoch 388| loss: 676.10544| val_0_rmse: 808.09853|  0:02:07s
epoch 389| loss: 600.48163| val_0_rmse: 721.51776|  0:02:07s
epoch 390| loss: 682.03957| val_0_rmse: 818.69819|  0:02:07s
epoch 391| loss: 640.47204| val_0_rmse: 868.56535|  0:02:07s
epoch 392| loss: 637.21986| val_0_rmse: 884.63039|  0:02:08s
epoch 393| loss: 617.41466| val_0_rmse: 910.26574|  0:02:08s
epoch 394| loss: 659.35516| val_0_rmse: 852.58136|  0:02:08s
epoch 395| loss: 563.59685| val_0_rmse: 828.29569|  0:02:09s
epoch 396| loss: 623.87709| val_0_rmse: 870.28384|  0:02:09s
epoch 397| loss: 620.52426| val_0_rmse: 750.31266|  0:02:09s
epoch 398| loss: 564.57325| val_0_rmse: 872.87429|  0:02:10s
epoch 399| loss: 598.30348| val_0_rmse: 844.64581|  0:02:10s
epoch 400| loss: 592.87029| val_0_rmse: 818.39859|  0:02:10s
epoch 401| loss: 656.5562| val_0_rmse: 896.82915|  0:02:11s
epoch 402| loss: 695.44346| val_0_rmse: 858.73438|  0:02:11s
epoch 403| loss: 577.9875| val_0_rmse: 808.62597|  0:02:11s
epoch 404| loss: 693.82384| val_0_rmse: 873.7176|  0:02:12s
epoch 405| loss: 615.93248| val_0_rmse: 736.89518|  0:02:12s
epoch 406| loss: 732.33569| val_0_rmse: 876.66089|  0:02:12s
epoch 407| loss: 604.76919| val_0_rmse: 886.06102|  0:02:13s
epoch 408| loss: 640.75427| val_0_rmse: 751.23081|  0:02:13s
epoch 409| loss: 664.71146| val_0_rmse: 756.66825|  0:02:13s
epoch 410| loss: 725.76448| val_0_rmse: 875.85614|  0:02:14s
epoch 411| loss: 693.8325| val_0_rmse: 857.5247|  0:02:14s
epoch 412| loss: 721.22253| val_0_rmse: 882.22373|  0:02:14s
epoch 413| loss: 623.06052| val_0_rmse: 851.87262|  0:02:15s
epoch 414| loss: 620.14478| val_0_rmse: 791.59267|  0:02:15s
epoch 415| loss: 686.81944| val_0_rmse: 760.91097|  0:02:15s
epoch 416| loss: 636.88745| val_0_rmse: 854.73483|  0:02:16s
epoch 417| loss: 720.35892| val_0_rmse: 914.81682|  0:02:16s
epoch 418| loss: 624.02816| val_0_rmse: 905.40542|  0:02:16s
epoch 419| loss: 626.06127| val_0_rmse: 818.84895|  0:02:17s
epoch 420| loss: 563.10335| val_0_rmse: 784.81559|  0:02:17s
epoch 421| loss: 502.63541| val_0_rmse: 662.37839|  0:02:17s
epoch 422| loss: 618.9571| val_0_rmse: 744.22406|  0:02:18s
epoch 423| loss: 624.42972| val_0_rmse: 827.31691|  0:02:18s
epoch 424| loss: 630.27896| val_0_rmse: 875.77563|  0:02:18s
epoch 425| loss: 638.87292| val_0_rmse: 963.54465|  0:02:19s
epoch 426| loss: 563.0647| val_0_rmse: 826.94368|  0:02:19s
epoch 427| loss: 659.77691| val_0_rmse: 801.64509|  0:02:19s
epoch 428| loss: 631.62959| val_0_rmse: 871.12957|  0:02:20s
epoch 429| loss: 705.49845| val_0_rmse: 831.02839|  0:02:20s
epoch 430| loss: 663.37498| val_0_rmse: 841.21267|  0:02:20s
epoch 431| loss: 610.23862| val_0_rmse: 771.83087|  0:02:21s
epoch 432| loss: 634.57347| val_0_rmse: 795.67669|  0:02:21s
epoch 433| loss: 799.18753| val_0_rmse: 883.36005|  0:02:21s
epoch 434| loss: 715.48067| val_0_rmse: 867.04198|  0:02:22s
epoch 435| loss: 561.69036| val_0_rmse: 883.8357|  0:02:22s
epoch 436| loss: 720.70297| val_0_rmse: 944.35951|  0:02:22s
epoch 437| loss: 611.07695| val_0_rmse: 814.41547|  0:02:23s
epoch 438| loss: 610.80349| val_0_rmse: 862.70325|  0:02:23s
epoch 439| loss: 635.55859| val_0_rmse: 868.80574|  0:02:23s
epoch 440| loss: 632.50201| val_0_rmse: 780.10286|  0:02:23s
epoch 441| loss: 606.14988| val_0_rmse: 801.17976|  0:02:24s
epoch 442| loss: 640.09874| val_0_rmse: 870.93862|  0:02:24s
epoch 443| loss: 629.69876| val_0_rmse: 854.27369|  0:02:24s
epoch 444| loss: 657.94391| val_0_rmse: 826.1386|  0:02:25s
epoch 445| loss: 626.63351| val_0_rmse: 751.17038|  0:02:25s
epoch 446| loss: 629.2315| val_0_rmse: 832.12683|  0:02:26s
epoch 447| loss: 677.93623| val_0_rmse: 826.77104|  0:02:26s
epoch 448| loss: 583.5286| val_0_rmse: 810.20513|  0:02:26s
epoch 449| loss: 673.41178| val_0_rmse: 827.1757|  0:02:26s
epoch 450| loss: 580.8493| val_0_rmse: 753.65502|  0:02:27s
epoch 451| loss: 571.45372| val_0_rmse: 833.42302|  0:02:27s
epoch 452| loss: 638.74695| val_0_rmse: 892.65048|  0:02:27s
epoch 453| loss: 653.83  | val_0_rmse: 797.75712|  0:02:28s
epoch 454| loss: 659.61164| val_0_rmse: 830.70415|  0:02:28s
epoch 455| loss: 658.88046| val_0_rmse: 810.98442|  0:02:28s
epoch 456| loss: 714.58604| val_0_rmse: 821.98657|  0:02:29s
epoch 457| loss: 546.12119| val_0_rmse: 836.67177|  0:02:29s
epoch 458| loss: 623.0132| val_0_rmse: 739.56405|  0:02:29s
epoch 459| loss: 726.48769| val_0_rmse: 697.12039|  0:02:30s
epoch 460| loss: 644.32227| val_0_rmse: 806.6029|  0:02:30s
epoch 461| loss: 548.79692| val_0_rmse: 694.26271|  0:02:30s
epoch 462| loss: 679.05121| val_0_rmse: 875.31619|  0:02:31s
epoch 463| loss: 731.10261| val_0_rmse: 933.01594|  0:02:31s
epoch 464| loss: 540.87479| val_0_rmse: 794.18028|  0:02:31s
epoch 465| loss: 635.52941| val_0_rmse: 866.14156|  0:02:32s
epoch 466| loss: 619.98887| val_0_rmse: 771.87808|  0:02:32s
epoch 467| loss: 802.98857| val_0_rmse: 939.02134|  0:02:32s
epoch 468| loss: 641.00724| val_0_rmse: 929.72282|  0:02:33s
epoch 469| loss: 556.88513| val_0_rmse: 939.6745|  0:02:33s
epoch 470| loss: 684.13484| val_0_rmse: 885.01557|  0:02:33s
epoch 471| loss: 615.27049| val_0_rmse: 847.57251|  0:02:34s
epoch 472| loss: 643.78176| val_0_rmse: 809.795 |  0:02:34s
epoch 473| loss: 584.74349| val_0_rmse: 857.03104|  0:02:34s
epoch 474| loss: 554.93719| val_0_rmse: 754.05675|  0:02:35s
epoch 475| loss: 658.32865| val_0_rmse: 809.45976|  0:02:35s
epoch 476| loss: 555.36442| val_0_rmse: 751.64629|  0:02:35s
epoch 477| loss: 618.89578| val_0_rmse: 756.88188|  0:02:36s
epoch 478| loss: 663.20538| val_0_rmse: 833.46991|  0:02:36s
epoch 479| loss: 591.42686| val_0_rmse: 806.57901|  0:02:36s
epoch 480| loss: 598.50462| val_0_rmse: 812.83459|  0:02:36s
epoch 481| loss: 665.08416| val_0_rmse: 820.33898|  0:02:37s
epoch 482| loss: 607.06775| val_0_rmse: 858.98682|  0:02:37s
epoch 483| loss: 645.46275| val_0_rmse: 857.79667|  0:02:38s
epoch 484| loss: 652.35003| val_0_rmse: 845.65378|  0:02:38s
epoch 485| loss: 552.50943| val_0_rmse: 829.86297|  0:02:38s
epoch 486| loss: 703.41056| val_0_rmse: 810.98604|  0:02:38s
epoch 487| loss: 495.95592| val_0_rmse: 729.6242|  0:02:39s
epoch 488| loss: 604.21425| val_0_rmse: 797.90604|  0:02:39s
epoch 489| loss: 685.2489| val_0_rmse: 800.3271|  0:02:39s
epoch 490| loss: 601.63803| val_0_rmse: 812.56778|  0:02:40s
epoch 491| loss: 666.14288| val_0_rmse: 945.9116|  0:02:40s
epoch 492| loss: 577.51837| val_0_rmse: 804.27101|  0:02:40s
epoch 493| loss: 603.45326| val_0_rmse: 815.51193|  0:02:41s
epoch 494| loss: 586.72253| val_0_rmse: 767.23301|  0:02:41s
epoch 495| loss: 527.75941| val_0_rmse: 698.20773|  0:02:41s
epoch 496| loss: 577.90281| val_0_rmse: 835.88323|  0:02:42s
epoch 497| loss: 618.09879| val_0_rmse: 796.81467|  0:02:42s
epoch 498| loss: 696.82005| val_0_rmse: 854.34995|  0:02:42s
epoch 499| loss: 727.05933| val_0_rmse: 916.25607|  0:02:43s
epoch 500| loss: 547.61071| val_0_rmse: 810.95855|  0:02:43s
epoch 501| loss: 684.40904| val_0_rmse: 805.98701|  0:02:43s
epoch 502| loss: 619.99804| val_0_rmse: 798.56421|  0:02:44s
epoch 503| loss: 736.6762| val_0_rmse: 922.79297|  0:02:44s
epoch 504| loss: 538.39113| val_0_rmse: 833.07848|  0:02:44s
epoch 505| loss: 618.2415| val_0_rmse: 837.61263|  0:02:45s
epoch 506| loss: 577.1689| val_0_rmse: 802.29606|  0:02:45s
epoch 507| loss: 728.17697| val_0_rmse: 885.57899|  0:02:45s
epoch 508| loss: 609.54267| val_0_rmse: 760.98435|  0:02:46s
epoch 509| loss: 664.66729| val_0_rmse: 781.82119|  0:02:46s
epoch 510| loss: 647.59828| val_0_rmse: 941.35495|  0:02:46s
epoch 511| loss: 589.22063| val_0_rmse: 814.00232|  0:02:47s
epoch 512| loss: 650.12905| val_0_rmse: 788.11516|  0:02:47s
epoch 513| loss: 602.41104| val_0_rmse: 897.16308|  0:02:47s
epoch 514| loss: 563.21575| val_0_rmse: 878.03657|  0:02:48s
epoch 515| loss: 681.26362| val_0_rmse: 907.807 |  0:02:48s
epoch 516| loss: 641.73963| val_0_rmse: 971.91303|  0:02:48s
epoch 517| loss: 614.60923| val_0_rmse: 840.44606|  0:02:49s
epoch 518| loss: 608.46478| val_0_rmse: 886.7337|  0:02:49s
epoch 519| loss: 556.49442| val_0_rmse: 733.23613|  0:02:49s
epoch 520| loss: 573.41321| val_0_rmse: 723.93251|  0:02:50s
epoch 521| loss: 598.99786| val_0_rmse: 786.12253|  0:02:50s
epoch 522| loss: 606.38857| val_0_rmse: 891.97917|  0:02:50s
epoch 523| loss: 645.54786| val_0_rmse: 920.37069|  0:02:51s
epoch 524| loss: 707.57367| val_0_rmse: 998.11728|  0:02:51s
epoch 525| loss: 581.57559| val_0_rmse: 817.97298|  0:02:51s
epoch 526| loss: 644.02537| val_0_rmse: 908.43207|  0:02:52s
epoch 527| loss: 560.96699| val_0_rmse: 914.32263|  0:02:52s
epoch 528| loss: 545.2848| val_0_rmse: 778.54009|  0:02:52s
epoch 529| loss: 665.84576| val_0_rmse: 823.10963|  0:02:53s
epoch 530| loss: 696.02818| val_0_rmse: 823.39911|  0:02:53s
epoch 531| loss: 631.76508| val_0_rmse: 728.68406|  0:02:53s
epoch 532| loss: 681.10156| val_0_rmse: 938.7774|  0:02:54s
epoch 533| loss: 668.44143| val_0_rmse: 865.19223|  0:02:54s
epoch 534| loss: 718.12018| val_0_rmse: 844.74059|  0:02:54s
epoch 535| loss: 656.70846| val_0_rmse: 789.17395|  0:02:55s
epoch 536| loss: 631.7241| val_0_rmse: 830.81647|  0:02:55s
epoch 537| loss: 641.63881| val_0_rmse: 871.93985|  0:02:55s
epoch 538| loss: 603.37827| val_0_rmse: 822.35992|  0:02:56s
epoch 539| loss: 646.0931| val_0_rmse: 742.38786|  0:02:56s
epoch 540| loss: 659.30639| val_0_rmse: 803.49375|  0:02:56s
epoch 541| loss: 677.78004| val_0_rmse: 914.49419|  0:02:57s
epoch 542| loss: 516.39587| val_0_rmse: 749.56863|  0:02:57s
epoch 543| loss: 594.81364| val_0_rmse: 871.77559|  0:02:57s
epoch 544| loss: 744.36789| val_0_rmse: 886.30928|  0:02:58s
epoch 545| loss: 650.7092| val_0_rmse: 805.58671|  0:02:58s
epoch 546| loss: 519.29046| val_0_rmse: 705.3801|  0:02:58s
epoch 547| loss: 621.44618| val_0_rmse: 854.0153|  0:02:59s
epoch 548| loss: 669.6966| val_0_rmse: 889.94916|  0:02:59s
epoch 549| loss: 586.32722| val_0_rmse: 863.66973|  0:02:59s
epoch 550| loss: 692.09796| val_0_rmse: 895.3411|  0:02:59s
epoch 551| loss: 685.83525| val_0_rmse: 893.95024|  0:03:00s
epoch 552| loss: 631.65179| val_0_rmse: 891.76112|  0:03:00s
epoch 553| loss: 590.00582| val_0_rmse: 856.3819|  0:03:01s
epoch 554| loss: 666.03301| val_0_rmse: 875.5319|  0:03:01s
epoch 555| loss: 650.423 | val_0_rmse: 808.61661|  0:03:01s
epoch 556| loss: 646.72206| val_0_rmse: 801.24211|  0:03:01s
epoch 557| loss: 741.10922| val_0_rmse: 1030.22011|  0:03:02s
epoch 558| loss: 664.90197| val_0_rmse: 992.14754|  0:03:02s
epoch 559| loss: 569.61862| val_0_rmse: 776.18693|  0:03:02s
epoch 560| loss: 703.86035| val_0_rmse: 855.67678|  0:03:03s
epoch 561| loss: 638.35141| val_0_rmse: 770.66516|  0:03:03s
epoch 562| loss: 595.1932| val_0_rmse: 774.76484|  0:03:03s
epoch 563| loss: 607.87903| val_0_rmse: 801.41103|  0:03:04s
epoch 564| loss: 642.27327| val_0_rmse: 828.27012|  0:03:04s
epoch 565| loss: 698.97928| val_0_rmse: 773.90413|  0:03:04s
epoch 566| loss: 664.49525| val_0_rmse: 884.81414|  0:03:05s
epoch 567| loss: 568.10835| val_0_rmse: 823.41631|  0:03:05s
epoch 568| loss: 649.95576| val_0_rmse: 895.76794|  0:03:05s
epoch 569| loss: 657.35582| val_0_rmse: 919.4699|  0:03:06s
epoch 570| loss: 637.07085| val_0_rmse: 927.61749|  0:03:06s
epoch 571| loss: 680.41523| val_0_rmse: 939.17534|  0:03:06s
epoch 572| loss: 610.04658| val_0_rmse: 836.3388|  0:03:07s
epoch 573| loss: 572.49802| val_0_rmse: 824.28379|  0:03:07s
epoch 574| loss: 608.35036| val_0_rmse: 797.04229|  0:03:07s
epoch 575| loss: 717.10673| val_0_rmse: 865.75969|  0:03:08s
epoch 576| loss: 699.60754| val_0_rmse: 923.4922|  0:03:08s
epoch 577| loss: 640.75191| val_0_rmse: 792.78857|  0:03:08s
epoch 578| loss: 565.4341| val_0_rmse: 801.83206|  0:03:09s
epoch 579| loss: 655.31268| val_0_rmse: 804.43563|  0:03:09s
epoch 580| loss: 604.47237| val_0_rmse: 772.31992|  0:03:09s
epoch 581| loss: 631.90427| val_0_rmse: 758.93941|  0:03:10s
epoch 582| loss: 648.59091| val_0_rmse: 847.15695|  0:03:10s
epoch 583| loss: 658.97042| val_0_rmse: 824.16638|  0:03:10s
epoch 584| loss: 559.86908| val_0_rmse: 770.95888|  0:03:11s
epoch 585| loss: 630.57688| val_0_rmse: 745.24375|  0:03:11s
epoch 586| loss: 811.1134| val_0_rmse: 923.59035|  0:03:11s
epoch 587| loss: 442.70387| val_0_rmse: 655.12602|  0:03:12s
epoch 588| loss: 657.14495| val_0_rmse: 784.45496|  0:03:12s
epoch 589| loss: 702.91866| val_0_rmse: 779.42489|  0:03:12s
epoch 590| loss: 702.92998| val_0_rmse: 860.38143|  0:03:13s
epoch 591| loss: 550.12501| val_0_rmse: 837.93551|  0:03:13s
epoch 592| loss: 601.23064| val_0_rmse: 813.27252|  0:03:13s
epoch 593| loss: 618.92219| val_0_rmse: 753.95672|  0:03:14s
epoch 594| loss: 603.08981| val_0_rmse: 673.26213|  0:03:14s
epoch 595| loss: 620.1782| val_0_rmse: 740.38469|  0:03:14s
epoch 596| loss: 624.45392| val_0_rmse: 700.11618|  0:03:15s
epoch 597| loss: 650.54722| val_0_rmse: 877.26872|  0:03:15s
epoch 598| loss: 672.34876| val_0_rmse: 843.54955|  0:03:15s
epoch 599| loss: 623.95686| val_0_rmse: 779.9139|  0:03:16s
epoch 600| loss: 601.78742| val_0_rmse: 794.01044|  0:03:16s
epoch 601| loss: 582.00597| val_0_rmse: 842.97832|  0:03:16s
epoch 602| loss: 719.24893| val_0_rmse: 945.36356|  0:03:17s
epoch 603| loss: 582.61305| val_0_rmse: 808.10799|  0:03:17s
epoch 604| loss: 671.06453| val_0_rmse: 878.67458|  0:03:17s
epoch 605| loss: 532.25981| val_0_rmse: 706.93265|  0:03:18s
epoch 606| loss: 589.96779| val_0_rmse: 735.03226|  0:03:18s
epoch 607| loss: 639.3516| val_0_rmse: 840.97079|  0:03:18s
epoch 608| loss: 565.99608| val_0_rmse: 813.62981|  0:03:18s
epoch 609| loss: 562.34334| val_0_rmse: 925.67547|  0:03:19s
epoch 610| loss: 631.49621| val_0_rmse: 801.37947|  0:03:19s
epoch 611| loss: 679.35512| val_0_rmse: 944.66055|  0:03:20s
epoch 612| loss: 636.62629| val_0_rmse: 795.7097|  0:03:20s
epoch 613| loss: 556.3659| val_0_rmse: 738.00538|  0:03:20s
epoch 614| loss: 653.36231| val_0_rmse: 823.14851|  0:03:20s
epoch 615| loss: 631.29432| val_0_rmse: 834.03206|  0:03:21s
epoch 616| loss: 686.38841| val_0_rmse: 919.62425|  0:03:21s
epoch 617| loss: 579.22164| val_0_rmse: 804.478 |  0:03:21s
epoch 618| loss: 702.68851| val_0_rmse: 848.90246|  0:03:22s
epoch 619| loss: 586.02103| val_0_rmse: 726.94889|  0:03:22s
epoch 620| loss: 680.67536| val_0_rmse: 812.11878|  0:03:22s
epoch 621| loss: 651.64503| val_0_rmse: 889.79025|  0:03:23s
epoch 622| loss: 688.84645| val_0_rmse: 942.77167|  0:03:23s
epoch 623| loss: 604.96061| val_0_rmse: 819.40867|  0:03:23s
epoch 624| loss: 641.07116| val_0_rmse: 900.46072|  0:03:24s
epoch 625| loss: 666.62448| val_0_rmse: 842.33257|  0:03:24s
epoch 626| loss: 532.17407| val_0_rmse: 755.49645|  0:03:24s
epoch 627| loss: 625.47458| val_0_rmse: 772.98817|  0:03:25s
epoch 628| loss: 605.43004| val_0_rmse: 831.18288|  0:03:25s
epoch 629| loss: 704.15481| val_0_rmse: 927.43195|  0:03:25s
epoch 630| loss: 651.95155| val_0_rmse: 822.96995|  0:03:26s
epoch 631| loss: 662.89265| val_0_rmse: 848.00755|  0:03:26s
epoch 632| loss: 578.91643| val_0_rmse: 779.64335|  0:03:26s
epoch 633| loss: 686.82375| val_0_rmse: 913.83091|  0:03:27s
epoch 634| loss: 653.77472| val_0_rmse: 897.83018|  0:03:27s
epoch 635| loss: 608.00632| val_0_rmse: 909.13318|  0:03:27s
epoch 636| loss: 698.12195| val_0_rmse: 871.84831|  0:03:28s
epoch 637| loss: 609.07258| val_0_rmse: 807.60435|  0:03:28s
epoch 638| loss: 707.41239| val_0_rmse: 837.9203|  0:03:28s
epoch 639| loss: 615.32666| val_0_rmse: 770.86554|  0:03:29s
epoch 640| loss: 628.55071| val_0_rmse: 792.43875|  0:03:29s
epoch 641| loss: 572.92239| val_0_rmse: 699.32591|  0:03:29s
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-64-cacafe65364a&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span>   <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span>   <span class="n">patience</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
<span class="ne">---&gt; </span><span class="mi">50</span>   <span class="n">loss_fn</span><span class="o">=</span><span class="n">criterion</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span> <span class="p">)</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/pytorch_tabnet/abstract_model.py</span> in <span class="ni">fit</span><span class="nt">(self, X_train, y_train, eval_set, eval_name, eval_metric, loss_fn, weights, max_epochs, patience, batch_size, virtual_batch_size, num_workers, drop_last, callbacks, pin_memory, from_unsupervised)</span>
<span class="g g-Whitespace">    </span><span class="mi">221</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_callback_container</span><span class="o">.</span><span class="n">on_epoch_begin</span><span class="p">(</span><span class="n">epoch_idx</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">222</span> 
<span class="ne">--&gt; </span><span class="mi">223</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_train_epoch</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">224</span> 
<span class="g g-Whitespace">    </span><span class="mi">225</span>             <span class="c1"># Apply predict epoch to all eval sets</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/pytorch_tabnet/abstract_model.py</span> in <span class="ni">_train_epoch</span><span class="nt">(self, train_loader)</span>
<span class="g g-Whitespace">    </span><span class="mi">432</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_callback_container</span><span class="o">.</span><span class="n">on_batch_begin</span><span class="p">(</span><span class="n">batch_idx</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">433</span> 
<span class="ne">--&gt; </span><span class="mi">434</span>             <span class="n">batch_logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_batch</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">435</span> 
<span class="g g-Whitespace">    </span><span class="mi">436</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_callback_container</span><span class="o">.</span><span class="n">on_batch_end</span><span class="p">(</span><span class="n">batch_idx</span><span class="p">,</span> <span class="n">batch_logs</span><span class="p">)</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/pytorch_tabnet/abstract_model.py</span> in <span class="ni">_train_batch</span><span class="nt">(self, X, y)</span>
<span class="g g-Whitespace">    </span><span class="mi">474</span> 
<span class="g g-Whitespace">    </span><span class="mi">475</span>         <span class="c1"># Perform backward pass and optimization</span>
<span class="ne">--&gt; </span><span class="mi">476</span>         <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">477</span>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clip_value</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">478</span>             <span class="n">clip_grad_norm_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">clip_value</span><span class="p">)</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/torch/_tensor.py</span> in <span class="ni">backward</span><span class="nt">(self, gradient, retain_graph, create_graph, inputs)</span>
<span class="g g-Whitespace">    </span><span class="mi">253</span>                 <span class="n">create_graph</span><span class="o">=</span><span class="n">create_graph</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">254</span>                 <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">255</span>         <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gradient</span><span class="p">,</span> <span class="n">retain_graph</span><span class="p">,</span> <span class="n">create_graph</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">256</span> 
<span class="g g-Whitespace">    </span><span class="mi">257</span>     <span class="k">def</span> <span class="nf">register_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">):</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/torch/autograd/__init__.py</span> in <span class="ni">backward</span><span class="nt">(tensors, grad_tensors, retain_graph, create_graph, grad_variables, inputs)</span>
<span class="g g-Whitespace">    </span><span class="mi">147</span>     <span class="n">Variable</span><span class="o">.</span><span class="n">_execution_engine</span><span class="o">.</span><span class="n">run_backward</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span>         <span class="n">tensors</span><span class="p">,</span> <span class="n">grad_tensors_</span><span class="p">,</span> <span class="n">retain_graph</span><span class="p">,</span> <span class="n">create_graph</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">149</span>         <span class="n">allow_unreachable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">accumulate_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># allow_unreachable flag</span>
<span class="g g-Whitespace">    </span><span class="mi">150</span> 
<span class="g g-Whitespace">    </span><span class="mi">151</span> 

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TabNetRegressor(n_d=8, n_a=8, n_steps=3, gamma=1.3, cat_idxs=[], cat_dims=[], cat_emb_dim=1, n_independent=2, n_shared=2, epsilon=1e-15, momentum=0.02, lambda_sparse=0.0001, seed=0, clip_value=1, verbose=1, optimizer_fn=&lt;class &#39;torch.optim.adam.Adam&#39;&gt;, optimizer_params={&#39;lr&#39;: 0.07}, scheduler_fn=&lt;class &#39;torch.optim.lr_scheduler.ReduceLROnPlateau&#39;&gt;, scheduler_params={&#39;patience&#39;: 5, &#39;factor&#39;: 0.5}, mask_type=&#39;entmax&#39;, input_dim=44, output_dim=1, device_name=&#39;auto&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># save tabnet model</span>
<span class="n">saving_path_name</span> <span class="o">=</span> <span class="s2">&quot;./tabnet_model_test_1&quot;</span>
<span class="n">saved_filepath</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="n">saving_path_name</span><span class="p">)</span>

<span class="c1"># define new model with basic parameters and load state dict weights</span>
<span class="n">loaded_clf</span> <span class="o">=</span> <span class="n">TabNetRegressor</span><span class="p">(</span>
    <span class="n">optimizer_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="mf">7e-2</span><span class="p">),</span> <span class="c1"># 7 -&gt; 250</span>
    <span class="n">scheduler_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;patience&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;factor&quot;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">},</span> <span class="c1"># 0.7</span>
    <span class="c1">#n_steps=3,</span>
    <span class="n">lambda_sparse</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
    <span class="n">scheduler_fn</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">ReduceLROnPlateau</span><span class="p">,</span> <span class="n">mask_type</span><span class="o">=</span><span class="s1">&#39;entmax&#39;</span> 
    <span class="c1">#scheduler_fn=torch.optim.lr_scheduler.StepLR, mask_type=&#39;entmax&#39; # StepLR</span>
<span class="p">)</span>  

<span class="n">loaded_clf</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">saved_filepath</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preds</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>252.5939150788076
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from pytorch_tabnet.pretraining import TabNetPretrainer</span>
<span class="c1"># from pytorch_tabnet.tab_model import TabNetRegressor</span>
<span class="c1"># import torch</span>

<span class="c1"># unsupervised_model = TabNetPretrainer(</span>
<span class="c1">#     optimizer_fn=torch.optim.Adam,</span>
   
<span class="c1">#     mask_type=&#39;entmax&#39;, # &quot;sparsemax&quot;,</span>
    
    
<span class="c1"># )</span>

<span class="c1"># unsupervised_model.fit(</span>
<span class="c1">#     X_train=X_train_net,</span>
<span class="c1">#     eval_set=[X_train_net],</span>
<span class="c1">#     pretraining_ratio=0.8,</span>
<span class="c1">#     drop_last=False,</span>
<span class="c1">#     batch_size=2048, virtual_batch_size=128,</span>
<span class="c1"># )</span>

<span class="c1"># clf = TabNetRegressor()  </span>

<span class="c1"># clf.fit(</span>
<span class="c1">#   X_train_net, y_train_net,</span>
<span class="c1">#   eval_set=[(X_train_net, y_train_net)],</span>
<span class="c1">#   eval_metric=[&#39;rmse&#39;],</span>
<span class="c1">#   from_unsupervised=unsupervised_model,</span>
<span class="c1">#    max_epochs=2000</span>
<span class="c1"># )</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unsupervised_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">RuntimeError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-31-08e7c2fd1e80&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">unsupervised_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/pytorch_tabnet/pretraining.py</span> in <span class="ni">predict</span><span class="nt">(self, X)</span>
<span class="g g-Whitespace">    </span><span class="mi">399</span>         <span class="k">for</span> <span class="n">batch_nb</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataloader</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">400</span>             <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">401</span>             <span class="n">output</span><span class="p">,</span> <span class="n">embeded_x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span>             <span class="n">predictions</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">403</span>             <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py</span> in <span class="ni">_call_impl</span><span class="nt">(self, *input, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1049</span>         <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backward_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_pre_hooks</span> <span class="ow">or</span> <span class="n">_global_backward_hooks</span>
<span class="g g-Whitespace">   </span><span class="mi">1050</span>                 <span class="ow">or</span> <span class="n">_global_forward_hooks</span> <span class="ow">or</span> <span class="n">_global_forward_pre_hooks</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1051</span>             <span class="k">return</span> <span class="n">forward_call</span><span class="p">(</span><span class="o">*</span><span class="nb">input</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1052</span>         <span class="c1"># Do not call functions when jit is used</span>
<span class="g g-Whitespace">   </span><span class="mi">1053</span>         <span class="n">full_backward_hooks</span><span class="p">,</span> <span class="n">non_full_backward_hooks</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/pytorch_tabnet/tab_network.py</span> in <span class="ni">forward</span><span class="nt">(self, x)</span>
<span class="g g-Whitespace">    </span><span class="mi">368</span>             <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">embedded_x</span><span class="p">,</span> <span class="n">obf_vars</span>
<span class="g g-Whitespace">    </span><span class="mi">369</span>         <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">370</span>             <span class="n">steps_out</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">embedded_x</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">371</span>             <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">steps_out</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">372</span>             <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">embedded_x</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">embedded_x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py</span> in <span class="ni">_call_impl</span><span class="nt">(self, *input, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1049</span>         <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backward_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_pre_hooks</span> <span class="ow">or</span> <span class="n">_global_backward_hooks</span>
<span class="g g-Whitespace">   </span><span class="mi">1050</span>                 <span class="ow">or</span> <span class="n">_global_forward_hooks</span> <span class="ow">or</span> <span class="n">_global_forward_pre_hooks</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1051</span>             <span class="k">return</span> <span class="n">forward_call</span><span class="p">(</span><span class="o">*</span><span class="nb">input</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1052</span>         <span class="c1"># Do not call functions when jit is used</span>
<span class="g g-Whitespace">   </span><span class="mi">1053</span>         <span class="n">full_backward_hooks</span><span class="p">,</span> <span class="n">non_full_backward_hooks</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/pytorch_tabnet/tab_network.py</span> in <span class="ni">forward</span><span class="nt">(self, x, prior)</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span> 
<span class="g g-Whitespace">    </span><span class="mi">149</span>     <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prior</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">150</span>         <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_bn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">151</span> 
<span class="g g-Whitespace">    </span><span class="mi">152</span>         <span class="k">if</span> <span class="n">prior</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/torch/nn/modules/module.py</span> in <span class="ni">_call_impl</span><span class="nt">(self, *input, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1049</span>         <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backward_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_hooks</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forward_pre_hooks</span> <span class="ow">or</span> <span class="n">_global_backward_hooks</span>
<span class="g g-Whitespace">   </span><span class="mi">1050</span>                 <span class="ow">or</span> <span class="n">_global_forward_hooks</span> <span class="ow">or</span> <span class="n">_global_forward_pre_hooks</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1051</span>             <span class="k">return</span> <span class="n">forward_call</span><span class="p">(</span><span class="o">*</span><span class="nb">input</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1052</span>         <span class="c1"># Do not call functions when jit is used</span>
<span class="g g-Whitespace">   </span><span class="mi">1053</span>         <span class="n">full_backward_hooks</span><span class="p">,</span> <span class="n">non_full_backward_hooks</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/torch/nn/modules/batchnorm.py</span> in <span class="ni">forward</span><span class="nt">(self, input)</span>
<span class="g g-Whitespace">    </span><span class="mi">176</span>             <span class="n">bn_training</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">177</span>             <span class="n">exponential_average_factor</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">178</span>             <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">179</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">180</span> 

<span class="nn">/usr/local/lib/python3.7/dist-packages/torch/nn/functional.py</span> in <span class="ni">batch_norm</span><span class="nt">(input, running_mean, running_var, weight, bias, training, momentum, eps)</span>
<span class="g g-Whitespace">   </span><span class="mi">2280</span> 
<span class="g g-Whitespace">   </span><span class="mi">2281</span>     <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">batch_norm</span><span class="p">(</span>
<span class="ne">-&gt; </span><span class="mi">2282</span>         <span class="nb">input</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">bias</span><span class="p">,</span> <span class="n">running_mean</span><span class="p">,</span> <span class="n">running_var</span><span class="p">,</span> <span class="n">training</span><span class="p">,</span> <span class="n">momentum</span><span class="p">,</span> <span class="n">eps</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">enabled</span>
<span class="g g-Whitespace">   </span><span class="mi">2283</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2284</span> 

<span class="ne">RuntimeError</span>: running_mean should contain 44 elements not 1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preds</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>#Model selection</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RepeatedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">ExtraTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
<span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">RobustScaler</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.kernel_ridge</span> <span class="kn">import</span> <span class="n">KernelRidge</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span>
</pre></div>
</div>
</div>
</div>
<p>##GradientBoostingRegressor</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># evaluate the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor</span><span class="p">()</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">n_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">error_score</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE: </span><span class="si">%.3f</span><span class="s1"> (</span><span class="si">%.3f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">n_scores</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">n_scores</span><span class="p">)))</span> <span class="c1"># RMSE: -89.512 (8.465)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: -89.512 (8.465)
</pre></div>
</div>
</div>
</div>
<p>##<em>ExtraTreeRegressor</em></p>
<section id="iso">
<h3>iso<a class="headerlink" href="#iso" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># used on X_train instead of X_delete as above</span>

<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">IsolationForest</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">f1_score</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">model_selection</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_classification</span>

<span class="n">iso</span> <span class="o">=</span> <span class="n">IsolationForest</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">contamination</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">iso</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_train_cleaned</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
<span class="n">y_train_cleaned</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>

<span class="c1"># summarize the shape of the updated training dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train_cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train_cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">cleaned</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">X_train_cleaned</span><span class="o">.</span><span class="n">shape</span>

<span class="n">total</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of outlier row removed: &quot;</span><span class="p">,</span> <span class="n">total</span> <span class="o">-</span> <span class="n">cleaned</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;percentage of outliers removed: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">total</span><span class="o">-</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(9094, 45) (9094,)
number of outlier row removed:  1011
percentage of outliers removed:  0.10004948045522019
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # used on X_train instead of X_delete as above</span>

<span class="c1"># from sklearn.ensemble import IsolationForest</span>
<span class="c1"># from sklearn.metrics import make_scorer, f1_score</span>
<span class="c1"># from sklearn import model_selection</span>
<span class="c1"># from sklearn.datasets import make_classification</span>

<span class="c1"># iso = IsolationForest(random_state=SEED, contamination=0.3)</span>
<span class="c1"># y_pred = iso.fit_predict(X_imputed)</span>
<span class="c1"># X_imputed_cleaned = X_imputed[np.where(y_pred == 1, True, False)]</span>
<span class="c1"># y_imputed_cleaned = y_train[np.where(y_pred == 1, True, False)]</span>

<span class="c1"># # summarize the shape of the updated training dataset</span>
<span class="c1"># print(X_imputed_cleaned.shape, y_imputed_cleaned.shape)</span>
<span class="c1"># cleaned,_ = X_imputed_cleaned.shape</span>

<span class="c1"># total, _ = X_imputed.shape</span>
<span class="c1"># print(&quot;number of outlier row removed: &quot;, total - cleaned)</span>
<span class="c1"># print(&quot;percentage of outliers removed: &quot;, (total-cleaned) / total)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="evaluate-the-model">
<h3>evaluate the model<a class="headerlink" href="#evaluate-the-model" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ext_rg</span><span class="p">(</span><span class="n">X_given</span><span class="p">,</span><span class="n">y_given</span><span class="o">=</span><span class="n">y_train</span><span class="p">):</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">ExtraTreeRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span> <span class="c1">#ExtraTreeRegressor(random_state=SEED, max_depth=26)</span>
  <span class="c1">#model = ExtraTreeRegressor(random_state=SEED, criterion=&quot;friedman_mse&quot;, max_depth=None, max_features=0.7929825166874074, max_leaf_nodes=None, min_impurity_decrease=0, min_samples_leaf=2, min_samples_split=6, min_weight_fraction_leaf=0)</span>
  <span class="c1">#model = SimpleRegressionPipeline({&#39;data_preprocessing:categorical_transformer:categorical_encoding:__choice__&#39;: &#39;no_encoding&#39;, &#39;data_preprocessing:categorical_transformer:category_coalescence:__choice__&#39;: &#39;minority_coalescer&#39;, &#39;data_preprocessing:numerical_transformer:imputation:strategy&#39;: &#39;mean&#39;, &#39;data_preprocessing:numerical_transformer:rescaling:__choice__&#39;: &#39;minmax&#39;, &#39;feature_preprocessor:__choice__&#39;: &#39;feature_agglomeration&#39;, &#39;regressor:__choice__&#39;: &#39;extra_trees&#39;, &#39;data_preprocessing:categorical_transformer:category_coalescence:minority_coalescer:minimum_fraction&#39;: 0.013555629780288401, &#39;feature_preprocessor:feature_agglomeration:affinity&#39;: &#39;euclidean&#39;, &#39;feature_preprocessor:feature_agglomeration:linkage&#39;: &#39;average&#39;, &#39;feature_preprocessor:feature_agglomeration:n_clusters&#39;: 361, &#39;feature_preprocessor:feature_agglomeration:pooling_func&#39;: &#39;median&#39;, &#39;regressor:extra_trees:bootstrap&#39;: &#39;False&#39;, &#39;regressor:extra_trees:criterion&#39;: &#39;friedman_mse&#39;, &#39;regressor:extra_trees:max_depth&#39;: &#39;None&#39;, &#39;regressor:extra_trees:max_features&#39;: 0.7929825166874074, &#39;regressor:extra_trees:max_leaf_nodes&#39;: &#39;None&#39;, &#39;regressor:extra_trees:min_impurity_decrease&#39;: 0.0, &#39;regressor:extra_trees:min_samples_leaf&#39;: 2, &#39;regressor:extra_trees:min_samples_split&#39;: 6, &#39;regressor:extra_trees:min_weight_fraction_leaf&#39;: 0.0})</span>
  
  <span class="n">cv</span> <span class="o">=</span> <span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
  <span class="n">n_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_given</span><span class="p">,</span> <span class="n">y_given</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE: </span><span class="si">%.3f</span><span class="s1"> (</span><span class="si">%.3f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">n_scores</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">n_scores</span><span class="p">)))</span> <span class="c1"># RMSE: -104.756 (33.902), X_train_cleaned -&gt; RMSE: -39.699 (14.663)</span>

<span class="c1">#ext_rg(X_train) # current: RMSE: -82.658 (14.536), without youtube, medium columns -&gt; RMSE: -80.446 (18.064)</span>
<span class="c1">#ext_rg(X_train_cleaned, y_train_cleaned)</span>
<span class="n">ext_rg</span><span class="p">(</span><span class="n">X_delete</span><span class="p">,</span> <span class="n">y_delete</span><span class="p">)</span>
<span class="c1">#ext_rg(X_imp_mean, y_delete)</span>
<span class="c1">#ext_rg(X_reduced, y_delete)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: -105.176 (20.966)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;regressor:extra_trees:bootstrap&#39;</span><span class="p">:</span> <span class="s1">&#39;False&#39;</span><span class="p">,</span> <span class="s1">&#39;regressor:extra_trees:criterion&#39;</span><span class="p">:</span> <span class="s1">&#39;friedman_mse&#39;</span><span class="p">,</span> <span class="s1">&#39;regressor:extra_trees:max_depth&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;regressor:extra_trees:max_features&#39;</span><span class="p">:</span> <span class="mf">0.7929825166874074</span><span class="p">,</span> <span class="s1">&#39;regressor:extra_trees:max_leaf_nodes&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;regressor:extra_trees:min_impurity_decrease&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;regressor:extra_trees:min_samples_leaf&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;regressor:extra_trees:min_samples_split&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;regressor:extra_trees:min_weight_fraction_leaf&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="submission">
<h2>submission<a class="headerlink" href="#submission" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#submission</span>
<span class="n">ext_model</span> <span class="o">=</span> <span class="n">ExtraTreeRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">splitter</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>

<span class="c1">#ext_model.fit(X_train_cleaned, y_train_cleaned)</span>
<span class="c1">#ext_model.fit(X_train, y_train) # 103.01549008547863, 104.76005740251006 - remove highly missing cols</span>

<span class="c1">#ext_model.fit(X_no_zeros, y_no_zeros) worse</span>
<span class="c1">#ext_model.fit(X_imputed, y_train)</span>

<span class="n">ext_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_delete</span><span class="p">,</span> <span class="n">y_delete</span><span class="p">)</span> 
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">ext_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1">#ext_model.fit(X_scaled, y_delete) # zero mean worse</span>
<span class="c1">#y_pred = ext_model.predict(X_test_scaled)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3210.1832141707114
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf</span> <span class="o">=</span> <span class="n">ExtraTreeRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_delete</span><span class="p">,</span> <span class="n">y_delete</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>

<span class="c1"># #############################################################################</span>
<span class="c1"># Plot feature importance</span>
<span class="n">feature_importance</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="c1"># make importances relative to max importance</span>
<span class="n">feature_importance</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">feature_importance</span> <span class="o">/</span> <span class="n">feature_importance</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">sorted_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">feature_importance</span><span class="p">)</span>

<span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sorted_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># start from 1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">feature_importance</span><span class="p">[</span><span class="n">sorted_idx</span><span class="p">],</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">X_delete</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">sorted_idx</span><span class="p">])</span><span class="c1">#boston.feature_names[sorted_idx])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Relative Importance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Variable Importance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7bce1cda364a5ae02c963d4e3abba45f8b23c21599c12b251755c911d1b7e3aa.png" src="../../_images/7bce1cda364a5ae02c963d4e3abba45f8b23c21599c12b251755c911d1b7e3aa.png" />
</div>
</div>
<p>##random tree</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># evaluate the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">()</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
<span class="c1">#n_scores = cross_val_score(model, X_train_cleaned, y_train_cleaned, scoring=&#39;neg_root_mean_squared_error&#39;, cv=cv, n_jobs=-1, error_score=&#39;raise&#39;)</span>
<span class="n">n_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">error_score</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE: </span><span class="si">%.3f</span><span class="s1"> (</span><span class="si">%.3f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">n_scores</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">n_scores</span><span class="p">)))</span> <span class="c1"># RMSE: -57.897 (6.050), x_trained_clean -&gt; RMSE: -55.651 (21.680), X_delete -&gt; -124.312 (30.900)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#submission</span>
<span class="n">rand_tree_model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span> <span class="c1"># , max_depth=21</span>

<span class="c1">#rand_tree_model.fit(X_train_cleaned, y_train_cleaned)</span>
<span class="c1">#rand_tree_model.fit(X_train, y_train)</span>
<span class="n">rand_tree_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_delete</span><span class="p">,</span> <span class="n">y_delete</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">rand_tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>78.83659223649168
</pre></div>
</div>
</div>
</div>
</section>
<section id="bayeisan-regressor">
<h2>bayeisan regressor<a class="headerlink" href="#bayeisan-regressor" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>
<span class="n">poly</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">interaction_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_poly</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="n">X_test_poly</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(11368, 40)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_poly</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(11368, 3241)
</pre></div>
</div>
</div>
</div>
</section>
<section id="add-features">
<h2>add features<a class="headerlink" href="#add-features" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SEED</span> <span class="o">=</span> <span class="mi">23</span>
<span class="c1"># Select main columns to be used in training</span>
<span class="n">main_cols</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">difference</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;close&#39;</span><span class="p">,</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="s1">&#39;asset_id&#39;</span><span class="p">,</span> <span class="s1">&#39;social_volume_24h_rank&#39;</span><span class="p">,</span> <span class="s1">&#39;volume_24h_rank&#39;</span><span class="p">,</span> <span class="s1">&#39;market_cap_rank&#39;</span><span class="p">,</span> <span class="s1">&#39;social_score_24h_rank&#39;</span><span class="p">,</span> <span class="s1">&#39;tweet_followers&#39;</span><span class="p">])</span> <span class="c1"># assert_id exclude since all 1, volatility, &#39;youtube&#39;, </span>
<span class="c1">#main_cols = train.columns.difference([&#39;id&#39;, &#39;close&#39;,&#39;medium&#39;,&#39;asset_id&#39;])</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">main_cols</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># Split data into train and test sets</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="c1">#X_train, X_test, y_train, y_test = train_test_split(X,y,test_size=0.2, random_state=23)</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>close</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>18305.759089</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7538.033373</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9123.040273</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6309.281509</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span><span class="p">,</span> <span class="n">TruncatedSVD</span><span class="p">,</span> <span class="n">FastICA</span>
<span class="kn">from</span> <span class="nn">sklearn.random_projection</span> <span class="kn">import</span> <span class="n">GaussianRandomProjection</span><span class="p">,</span> <span class="n">SparseRandomProjection</span>

<span class="n">N_COMP</span> <span class="o">=</span> <span class="mi">40</span>  <span class="c1"># 30 PCA - 53, ICA: 40 - 49.5, 35 - 50</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start decomposition process...&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ICA&quot;</span><span class="p">)</span>
<span class="n">ica</span> <span class="o">=</span> <span class="n">FastICA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">ica_results_train</span> <span class="o">=</span> <span class="n">ica</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">ica_results_test</span> <span class="o">=</span> <span class="n">ica</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Append decomposition components to datasets...&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>


    <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;ica_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ica_results_train</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">X_test</span><span class="p">[</span><span class="s1">&#39;ica_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ica_results_test</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

   
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Train shape: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">Test shape: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start decomposition process...
ICA
Append decomposition components to datasets...

Train shape: (11368, 80)
Test shape: (1264, 80)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:18: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:19: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from sklearn.decomposition import PCA, TruncatedSVD, FastICA</span>
<span class="c1"># from sklearn.random_projection import GaussianRandomProjection, SparseRandomProjection</span>

<span class="c1"># N_COMP = 40  # 30 PCA - 53, ICA: 40 - 49.5, 35 - 50</span>

<span class="c1"># print(&quot;\nStart decomposition process...&quot;)</span>
<span class="c1"># # print(&quot;PCA&quot;)</span>
<span class="c1"># # pca = PCA(n_components=N_COMP, random_state=17)</span>
<span class="c1"># # pca_results_train = pca.fit_transform(X_train)</span>
<span class="c1"># # pca_results_test = pca.transform(X_test)</span>
<span class="c1"># # print(pca.explained_variance_ratio_)</span>

<span class="c1"># # print(&quot;tSVD&quot;)</span>
<span class="c1"># # tsvd = TruncatedSVD(n_components=N_COMP, random_state=17)</span>
<span class="c1"># # tsvd_results_train = tsvd.fit_transform(X_train)</span>
<span class="c1"># # tsvd_results_test = tsvd.transform(X_test)</span>

<span class="c1"># print(&quot;ICA&quot;)</span>
<span class="c1"># ica = FastICA(n_components=40, random_state=17)</span>
<span class="c1"># ica_results_train = ica.fit_transform(X_train)</span>
<span class="c1"># ica_results_test = ica.transform(X_test)</span>

<span class="c1"># # print(&quot;GRP&quot;) # to be reduced</span>
<span class="c1"># # grp = GaussianRandomProjection(n_components=N_COMP, eps=0.1, random_state=17)</span>
<span class="c1"># # grp_results_train = grp.fit_transform(X_train)</span>
<span class="c1"># # grp_results_test = grp.transform(X_test)</span>

<span class="c1"># # print(&quot;SRP&quot;)</span>
<span class="c1"># # srp = SparseRandomProjection(n_components=N_COMP, dense_output=True, random_state=17)</span>
<span class="c1"># # srp_results_train = srp.fit_transform(X_train)</span>
<span class="c1"># # srp_results_test = srp.transform(X_test)</span>

<span class="c1"># print(&quot;Append decomposition components to datasets...&quot;)</span>
<span class="c1"># for i in range(1, N_COMP + 1):</span>
<span class="c1">#     # X_train[&#39;pca_&#39; + str(i)] = pca_results_train[:, i - 1]</span>
<span class="c1">#     # X_test[&#39;pca_&#39; + str(i)] = pca_results_test[:, i - 1]</span>
    
   
<span class="c1">#     # X_train[&#39;tsvd_&#39; + str(i)] = tsvd_results_train[:, i - 1]</span>
<span class="c1">#     # X_test[&#39;tsvd_&#39; + str(i)] = tsvd_results_test[:, i - 1]</span>

<span class="c1">#     X_train[&#39;ica_&#39; + str(i)] = ica_results_train[:, i - 1]</span>
<span class="c1">#     X_test[&#39;ica_&#39; + str(i)] = ica_results_test[:, i - 1]</span>


<span class="c1">#     # X_train[&#39;grp_&#39; + str(i)] = grp_results_train[:, i - 1]</span>
<span class="c1">#     # X_test[&#39;grp_&#39; + str(i)] = grp_results_test[:, i - 1]</span>

<span class="c1">#     # X_train[&#39;srp_&#39; + str(i)] = srp_results_train[:, i - 1]</span>
<span class="c1">#     # X_test[&#39;srp_&#39; + str(i)] = srp_results_test[:, i - 1]</span>

<span class="c1"># print(&#39;\nTrain shape: {}\nTest shape: {}&#39;.format(X_train.shape, X_test.shape))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start decomposition process...
ICA
Append decomposition components to datasets...

Train shape: (11368, 80)
Test shape: (1264, 80)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:42: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:43: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from sklearn import linear_model</span>

<span class="c1"># reg = linear_model.BayesianRidge(compute_score=True)</span>
<span class="c1"># #submission</span>

<span class="c1"># reg.fit(X_poly, y_train)</span>

<span class="c1"># y_pred = reg.predict(X_test_poly)</span>

<span class="c1"># from sklearn.metrics import mean_squared_error</span>
<span class="c1"># mean_squared_error(y_pred, y_test, squared=False)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>230906.94924252375
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>

<span class="n">reg</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">BayesianRidge</span><span class="p">(</span><span class="n">compute_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#submission</span>

<span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>39721963.81229357
</pre></div>
</div>
</div>
</div>
<p>##kNN regressor</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="n">neigh</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">n_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">neigh</span><span class="p">,</span> <span class="n">X_train_cleaned</span><span class="p">,</span> <span class="n">y_train_cleaned</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">error_score</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE: </span><span class="si">%.3f</span><span class="s1"> (</span><span class="si">%.3f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">n_scores</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">n_scores</span><span class="p">)))</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: -307.799 (65.892)
</pre></div>
</div>
</div>
</div>
<p>##xgboost</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!pip install xgboost</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_t</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[:</span><span class="o">-</span><span class="mi">1000</span><span class="p">]</span>
<span class="n">X_t</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(10368, 80)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#submission</span>
<span class="n">SEED</span> <span class="o">=</span> <span class="mi">104</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;reg:squarederror&#39;</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="c1">#16</span>
                     <span class="n">learning_rate</span><span class="o">=</span> <span class="mf">0.0764</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">booster</span><span class="o">=</span><span class="s2">&quot;gbtree&quot;</span><span class="p">,</span> <span class="c1"># , subsample=0.90,</span>
                      <span class="n">tree_method</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="c1"># gpu_hist</span>
                      <span class="n">subsample</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">colsample_bytree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">reg_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="c1"># 52.96502463981406:0.5 without those added columns</span>
                      <span class="n">reg_lambda</span><span class="o">=</span><span class="mi">1</span> 
                     <span class="c1"># min_child_weight, TODO</span>
                     <span class="p">)</span> <span class="c1">#54.14-&gt;0.0765</span>
<span class="c1"># cut_off = -1000</span>
<span class="c1"># X_t = X_train[:cut_off]</span>
<span class="c1"># y_t = y_train[:cut_off]</span>
<span class="c1"># X_c = X_train[cut_off:]</span>
<span class="c1"># y_c = y_train[cut_off:]</span>

<span class="c1">#model.fit(X_t, y_t, eval_metric=&quot;rmse&quot;,  eval_set=[(X_t, y_t), (X_c, y_c)], verbose=True) # 49.51422068156787</span>

<span class="c1">#model.fit(X_log, y_train)</span>
<span class="c1">#model.fit(X_poly, y_train)</span>
<span class="c1">#model.fit(X_train_cleaned, y_train_cleaned)</span>
<span class="c1">#model.fit(X_imp_median, y_train)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> <span class="c1"># 49.51422068156787</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>


<span class="c1">#y_pred = model.predict(X_test_imp_median)</span>


<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>53.15319123794743
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span><span class="p">[(</span><span class="n">y_pred</span><span class="o">&lt;</span><span class="mi">2000</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>71.24768553984339
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span><span class="p">[</span><span class="n">y_pred</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.], dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span><span class="p">[</span><span class="n">y_pred</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>49.514220424855345
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># model = XGBRegressor(objective=&#39;reg:squarederror&#39;, max_depth=16, n_estimators=150, #16</span>
<span class="c1">#                      learning_rate=0.0764, random_state=SEED, gamma=0, booster=&quot;gbtree&quot;, # , subsample=0.90,</span>
<span class="c1">#                       tree_method=&#39;auto&#39;, # gpu_hist</span>
<span class="c1">#                       subsample=1,</span>
<span class="c1">#                       colsample_bytree=1,</span>
<span class="c1">#                       reg_alpha=0.5, # 52.96502463981406:0.5 without those added columns</span>
<span class="c1">#                       reg_lambda=1</span>
<span class="c1">#                      ) #54.14-&gt;0.0765</span>


<span class="c1"># cv = RepeatedKFold(n_splits=10, n_repeats=1, random_state=SEED)</span>
<span class="c1"># #n_scores = cross_val_score(model, X_train, y_train, scoring=&#39;neg_root_mean_squared_error&#39;, cv=cv, n_jobs=-1, error_score=&#39;raise&#39;)</span>
<span class="c1"># #n_scores = cross_val_score(model, X_cleaned, y_cleaned, scoring=&#39;neg_root_mean_squared_error&#39;, cv=cv, n_jobs=-1, error_score=&#39;raise&#39;)</span>
<span class="c1"># n_scores = cross_val_score(model, X_log, y_train, scoring=&#39;neg_root_mean_squared_error&#39;, cv=cv, n_jobs=-1, error_score=&#39;raise&#39;)</span>

<span class="c1"># print(&#39;RMSE: %.3f (%.3f)&#39; % (mean(n_scores), std(n_scores))) # RMSEE: -63.467 (4.710)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: -62.982 (4.828)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># model = XGBRegressor(objective=&#39;reg:squarederror&#39;, max_depth=16, n_estimators=200, </span>
<span class="c1">#                      learning_rate=0.07, random_state=SEED, gamma=0, booster=&quot;gbtree&quot;, # , subsample=0.90,</span>
<span class="c1">#                       tree_method=&#39;auto&#39;, # gpu_hist</span>
<span class="c1">#                       subsample=1,</span>
<span class="c1">#                       colsample_bytree=1,</span>
<span class="c1">#                       reg_alpha=0.5, # 52.96502463981406:0.5 without those added columns</span>
<span class="c1">#                       reg_lambda=1</span>
<span class="c1">#                      ) #54.14-&gt;0.0765</span>

<span class="c1"># model.fit(X_cleaned, y_cleaned) #61.3</span>

<span class="c1"># y_pred = model.predict(X_test_cleaned)</span>

<span class="c1"># from sklearn.metrics import mean_squared_error</span>
<span class="c1"># mean_squared_error(y_pred, y_test_cleaned, squared=False)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>60.97172522355311
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">X_log</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
  <span class="n">X_log</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_log</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">X_log</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">X_log</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_log</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1">#X_train[&#39;high&#39;].iloc(10337)</span>
<span class="c1">#X_train[&#39;high&#39;].loc[[10337]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">X_test_log</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
  <span class="n">X_test_log</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test_log</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">X_test_log</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">X_test_log</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test_log</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>average_sentiment         -0.686842
correlation_rank          -0.298934
galaxy_score              -0.615003
high                      -0.667238
low                       -0.667464
market_cap                -0.622442
market_cap_global         -0.614809
market_cap_rank           -0.609482
news                       0.054088
open                      -0.667327
percent_change_24h        -0.018558
percent_change_24h_rank   -0.095172
price_score               -0.192176
reddit_comments           -1.439801
reddit_comments_score     -1.830200
reddit_posts              -0.778394
reddit_posts_score        -0.905402
social_impact_score       -0.510264
social_score              -0.656834
social_score_24h_rank     -0.446903
social_volume             -0.991945
social_volume_24h_rank    -0.224202
tweet_favorites           -0.537656
tweet_followers           -0.673813
tweet_quotes              -0.172718
tweet_replies             -0.453357
tweet_retweets            -0.527589
tweet_sentiment1          -0.248925
tweet_sentiment2          -0.451036
tweet_sentiment3          -0.628043
tweet_sentiment4          -0.628258
tweet_sentiment5          -0.487821
tweet_sentiment_impact1   -0.341086
tweet_sentiment_impact2   -0.621575
tweet_sentiment_impact3   -0.670192
tweet_sentiment_impact4   -0.675430
tweet_sentiment_impact5   -0.594638
tweet_spam                -0.506890
tweets                    -0.638259
unique_url_shares          0.679240
url_shares                 0.963782
volatility                 0.491662
volume                    -0.700363
volume_24h_rank            0.150905
youtube                    2.738911
dtype: float64
</pre></div>
</div>
</div>
</div>
<section id="importance">
<h3>importance<a class="headerlink" href="#importance" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">plot_importance</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1">#print(model.feature_importances_)</span>
<span class="c1"># plot feature importance</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">plot_importance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/436a372c2c328467fe9850fe0d6bdc3010de03ec1e53b6fd0f5b291bfffc1adf.png" src="../../_images/436a372c2c328467fe9850fe0d6bdc3010de03ec1e53b6fd0f5b291bfffc1adf.png" />
</div>
</div>
</section>
</section>
<section id="submit">
<h2>submit<a class="headerlink" href="#submit" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">FastICA</span>

<span class="n">test_submit</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">main_cols</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start decomposition process...&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ICA&quot;</span><span class="p">)</span>
<span class="n">submit_ica_test</span> <span class="o">=</span> <span class="n">ica</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_submit</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Append decomposition components to datasets...&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N_COMP</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>

    <span class="n">test_submit</span><span class="p">[</span><span class="s1">&#39;ica_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">submit_ica_test</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Train shape: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">Test shape: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">test_submit</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start decomposition process...
ICA
Append decomposition components to datasets...

Train shape: (11368, 80)
Test shape: (6222, 80)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make predictions in test set and prepare submission file</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_submit</span><span class="p">)</span> <span class="c1"># test[main_cols]</span>
<span class="n">sub_file</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">sub_file</span><span class="o">.</span><span class="n">close</span> <span class="o">=</span> <span class="n">predictions</span>
<span class="n">sub_file</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;Baseline.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sub_file</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>close</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ID_323Sn2</td>
      <td>0.000854</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ID_325SNW</td>
      <td>11350.486328</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ID_325uzE</td>
      <td>6315.891113</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ID_328qCx</td>
      <td>0.000854</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ID_3293uJ</td>
      <td>0.000854</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;Baseline.csv&#39;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">
    async function download(id, filename, size) {
      if (!google.colab.kernel.accessAllowed) {
        return;
      }
      const div = document.createElement('div');
      const label = document.createElement('label');
      label.textContent = `Downloading "${filename}": `;
      div.appendChild(label);
      const progress = document.createElement('progress');
      progress.max = size;
      div.appendChild(progress);
      document.body.appendChild(div);

      const buffers = [];
      let downloaded = 0;

      const channel = await google.colab.kernel.comms.open(id);
      // Send a message to notify the kernel that we're ready.
      channel.send({})

      for await (const message of channel.messages) {
        // Send a message to notify the kernel that we're ready.
        channel.send({})
        if (message.buffers) {
          for (const buffer of message.buffers) {
            buffers.push(buffer);
            downloaded += buffer.byteLength;
            progress.value = downloaded;
          }
        }
      }
      const blob = new Blob(buffers, {type: 'application/binary'});
      const a = document.createElement('a');
      a.href = window.URL.createObjectURL(blob);
      a.download = filename;
      div.appendChild(a);
      a.click();
      div.remove();
    }
  </script><script type="application/javascript">download("download_906dd3ed-0144-465a-802c-3d5bcaad6939", "Baseline.csv", 127763)</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>

<span class="n">dmatrix</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">params</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;objective&#39;</span><span class="p">:</span><span class="s1">&#39;reg:squarederror&#39;</span><span class="p">,</span>
         <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> 
         <span class="s1">&#39;colsample_bylevel&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span>
         <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="c1"># 0.5,</span>
        <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
        <span class="c1">#&#39;alpha &#39;:2,</span>
        <span class="s1">&#39;lambda &#39;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">,</span>
         <span class="s1">&#39;random_state&#39;</span><span class="p">:</span><span class="n">SEED</span><span class="p">}</span>
<span class="n">cv_results</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">cv</span><span class="p">(</span><span class="n">dtrain</span><span class="o">=</span><span class="n">dmatrix</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">nfold</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rmse&#39;</span><span class="p">},</span> <span class="n">as_pandas</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE: </span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cv_results</span><span class="p">[</span><span class="s1">&#39;test-rmse-mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 160.86
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
           <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
           <span class="s1">&#39;subsample&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
           <span class="s1">&#39;colsample_bytree&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
           <span class="s1">&#39;colsample_bylevel&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
           <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]}</span>
<span class="n">xgbr</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">(</span><span class="n">seed</span> <span class="o">=</span> <span class="n">SEED</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="s1">&#39;reg:squarederror&#39;</span><span class="p">)</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">xgbr</span><span class="p">,</span>
                         <span class="n">param_distributions</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                         <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span>
                         <span class="n">n_iter</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best parameters:&quot;</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lowest RMSE: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">clf</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 5 folds for each of 25 candidates, totalling 125 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Parallel(n_jobs=1)]: Using backend SequentialBackend with 1 concurrent workers.
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-374-9352ad7aba9f&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>                          <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> 
<span class="ne">---&gt; </span><span class="mi">18</span> <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> 
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best parameters:&quot;</span><span class="p">,</span> <span class="n">clf</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/sklearn/model_selection/_search.py</span> in <span class="ni">fit</span><span class="nt">(self, X, y, groups, **fit_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">708</span>                 <span class="k">return</span> <span class="n">results</span>
<span class="g g-Whitespace">    </span><span class="mi">709</span> 
<span class="ne">--&gt; </span><span class="mi">710</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_run_search</span><span class="p">(</span><span class="n">evaluate_candidates</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">711</span> 
<span class="g g-Whitespace">    </span><span class="mi">712</span>         <span class="c1"># For multi-metric evaluation, store the best_index_, best_params_ and</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/sklearn/model_selection/_search.py</span> in <span class="ni">_run_search</span><span class="nt">(self, evaluate_candidates)</span>
<span class="g g-Whitespace">   </span><span class="mi">1482</span>         <span class="n">evaluate_candidates</span><span class="p">(</span><span class="n">ParameterSampler</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1483</span>             <span class="bp">self</span><span class="o">.</span><span class="n">param_distributions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_iter</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">1484</span>             <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">))</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/sklearn/model_selection/_search.py</span> in <span class="ni">evaluate_candidates</span><span class="nt">(candidate_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">687</span>                                <span class="k">for</span> <span class="n">parameters</span><span class="p">,</span> <span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">688</span>                                <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">candidate_params</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">689</span>                                           <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">groups</span><span class="p">)))</span>
<span class="g g-Whitespace">    </span><span class="mi">690</span> 
<span class="g g-Whitespace">    </span><span class="mi">691</span>                 <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/joblib/parallel.py</span> in <span class="ni">__call__</span><span class="nt">(self, iterable)</span>
<span class="g g-Whitespace">   </span><span class="mi">1042</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_iterating</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_iterator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1043</span> 
<span class="ne">-&gt; </span><span class="mi">1044</span>             <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_one_batch</span><span class="p">(</span><span class="n">iterator</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1045</span>                 <span class="k">pass</span>
<span class="g g-Whitespace">   </span><span class="mi">1046</span> 

<span class="nn">/usr/local/lib/python3.7/dist-packages/joblib/parallel.py</span> in <span class="ni">dispatch_one_batch</span><span class="nt">(self, iterator)</span>
<span class="g g-Whitespace">    </span><span class="mi">857</span>                 <span class="k">return</span> <span class="kc">False</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>             <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">859</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">860</span>                 <span class="k">return</span> <span class="kc">True</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span> 

<span class="nn">/usr/local/lib/python3.7/dist-packages/joblib/parallel.py</span> in <span class="ni">_dispatch</span><span class="nt">(self, batch)</span>
<span class="g g-Whitespace">    </span><span class="mi">775</span>         <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">776</span>             <span class="n">job_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jobs</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">777</span>             <span class="n">job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">cb</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">778</span>             <span class="c1"># A job can complete so quickly than its callback is</span>
<span class="g g-Whitespace">    </span><span class="mi">779</span>             <span class="c1"># called before we get here, causing self._jobs to</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/joblib/_parallel_backends.py</span> in <span class="ni">apply_async</span><span class="nt">(self, func, callback)</span>
<span class="g g-Whitespace">    </span><span class="mi">206</span>     <span class="k">def</span> <span class="nf">apply_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">207</span><span class="w">         </span><span class="sd">&quot;&quot;&quot;Schedule a func to be run&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">208</span>         <span class="n">result</span> <span class="o">=</span> <span class="n">ImmediateResult</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span>         <span class="k">if</span> <span class="n">callback</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">210</span>             <span class="n">callback</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/joblib/_parallel_backends.py</span> in <span class="ni">__init__</span><span class="nt">(self, batch)</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span>         <span class="c1"># Don&#39;t delay the application, to avoid keeping the input</span>
<span class="g g-Whitespace">    </span><span class="mi">571</span>         <span class="c1"># arguments in memory</span>
<span class="ne">--&gt; </span><span class="mi">572</span>         <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">batch</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">573</span> 
<span class="g g-Whitespace">    </span><span class="mi">574</span>     <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/joblib/parallel.py</span> in <span class="ni">__call__</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span>         <span class="k">with</span> <span class="n">parallel_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_jobs</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">262</span>             <span class="k">return</span> <span class="p">[</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">263</span>                     <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">264</span> 
<span class="g g-Whitespace">    </span><span class="mi">265</span>     <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/joblib/parallel.py</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span>         <span class="k">with</span> <span class="n">parallel_backend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_jobs</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">262</span>             <span class="k">return</span> <span class="p">[</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">263</span>                     <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">264</span> 
<span class="g g-Whitespace">    </span><span class="mi">265</span>     <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/sklearn/model_selection/_validation.py</span> in <span class="ni">_fit_and_score</span><span class="nt">(estimator, X, y, scorer, train, test, verbose, parameters, fit_params, return_train_score, return_parameters, return_n_test_samples, return_times, return_estimator, error_score)</span>
<span class="g g-Whitespace">    </span><span class="mi">513</span>             <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">514</span>         <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">515</span>             <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">516</span> 
<span class="g g-Whitespace">    </span><span class="mi">517</span>     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/xgboost/sklearn.py</span> in <span class="ni">fit</span><span class="nt">(self, X, y, sample_weight, eval_set, eval_metric, early_stopping_rounds, verbose, xgb_model, sample_weight_eval_set, callbacks)</span>
<span class="g g-Whitespace">    </span><span class="mi">394</span>                               <span class="n">evals_result</span><span class="o">=</span><span class="n">evals_result</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">feval</span><span class="o">=</span><span class="n">feval</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">395</span>                               <span class="n">verbose_eval</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">xgb_model</span><span class="o">=</span><span class="n">xgb_model</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">396</span>                               <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">397</span> 
<span class="g g-Whitespace">    </span><span class="mi">398</span>         <span class="k">if</span> <span class="n">evals_result</span><span class="p">:</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/xgboost/training.py</span> in <span class="ni">train</span><span class="nt">(params, dtrain, num_boost_round, evals, obj, feval, maximize, early_stopping_rounds, evals_result, verbose_eval, xgb_model, callbacks, learning_rates)</span>
<span class="g g-Whitespace">    </span><span class="mi">214</span>                            <span class="n">evals</span><span class="o">=</span><span class="n">evals</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">215</span>                            <span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">feval</span><span class="o">=</span><span class="n">feval</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">216</span>                            <span class="n">xgb_model</span><span class="o">=</span><span class="n">xgb_model</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">217</span> 
<span class="g g-Whitespace">    </span><span class="mi">218</span> 

<span class="nn">/usr/local/lib/python3.7/dist-packages/xgboost/training.py</span> in <span class="ni">_train_internal</span><span class="nt">(params, dtrain, num_boost_round, evals, obj, feval, xgb_model, callbacks)</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span>         <span class="c1"># Skip the first update if it is a recovery step.</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span>         <span class="k">if</span> <span class="n">version</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">74</span>             <span class="n">bst</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dtrain</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">75</span>             <span class="n">bst</span><span class="o">.</span><span class="n">save_rabit_checkpoint</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span>             <span class="n">version</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nn">/usr/local/lib/python3.7/dist-packages/xgboost/core.py</span> in <span class="ni">update</span><span class="nt">(self, dtrain, iteration, fobj)</span>
<span class="g g-Whitespace">   </span><span class="mi">1107</span>         <span class="k">if</span> <span class="n">fobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1108</span>             <span class="n">_check_call</span><span class="p">(</span><span class="n">_LIB</span><span class="o">.</span><span class="n">XGBoosterUpdateOneIter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">(</span><span class="n">iteration</span><span class="p">),</span>
<span class="ne">-&gt; </span><span class="mi">1109</span>                                                     <span class="n">dtrain</span><span class="o">.</span><span class="n">handle</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">1110</span>         <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1111</span>             <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dtrain</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p>##LGBM</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!pip install lightgbm</span>
<span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMRegressor</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LGBMRegressor</span><span class="p">()</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">n_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">error_score</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAE: </span><span class="si">%.3f</span><span class="s1"> (</span><span class="si">%.3f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">n_scores</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">n_scores</span><span class="p">)))</span> <span class="c1"># MAE: -107.906 (15.543)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE: -107.906 (15.543)
</pre></div>
</div>
</div>
</div>
<p>##catboost</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!pip install catboost</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">catboost</span> <span class="kn">import</span> <span class="n">CatBoostRegressor</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">CatBoostRegressor</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">n_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">error_score</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAE: </span><span class="si">%.3f</span><span class="s1"> (</span><span class="si">%.3f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">n_scores</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">n_scores</span><span class="p">)))</span> <span class="c1"># MAE: -227.432 (38.044)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-153-a1fc2d15dbff&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">catboost</span> <span class="kn">import</span> <span class="n">CatBoostRegressor</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">model</span> <span class="o">=</span> <span class="n">CatBoostRegressor</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">cv</span> <span class="o">=</span> <span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">n_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">error_score</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAE: </span><span class="si">%.3f</span><span class="s1"> (</span><span class="si">%.3f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">n_scores</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">n_scores</span><span class="p">)))</span> <span class="c1"># MAE: -227.432 (38.044)</span>

<span class="ne">TypeError</span>: __init__() got an unexpected keyword argument &#39;learning_rate&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">catboost</span> <span class="kn">import</span> <span class="n">CatBoostRegressor</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">CatBoostRegressor</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.365</span><span class="p">,</span> <span class="n">l2_leaf_reg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loss_function</span><span class="o">=</span><span class="s2">&quot;RMSE&quot;</span><span class="p">)</span> <span class="c1"># 5-193</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>163.97489758483152
</pre></div>
</div>
</div>
</div>
<p>##SVR</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="c1">#regr = make_pipeline(StandardScaler(), SVR(C=1.0, epsilon=0.2))</span>
<span class="n">regr</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">cv</span> <span class="o">=</span> <span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">n_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">regr</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">error_score</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAE: </span><span class="si">%.3f</span><span class="s1"> (</span><span class="si">%.3f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">n_scores</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">n_scores</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE: -13137.179 (606.234)
</pre></div>
</div>
</div>
</div>
<p>##ridge</p>
<section id="test">
<h3>test<a class="headerlink" href="#test" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#ridge_rg = make_pipeline(StandardScaler(), Ridge(alpha=1.0))</span>
<span class="k">def</span> <span class="nf">ridge_rg</span><span class="p">(</span><span class="n">X_given</span><span class="p">,</span> <span class="n">y_given</span><span class="o">=</span><span class="n">y_train</span><span class="p">):</span>
  <span class="n">ridge_rg</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span> <span class="c1"># 52</span>
  <span class="c1">#ridge_rg = make_pipeline(RobustScaler(), Ridge(alpha=1.0)) # 77</span>
  <span class="c1">#ridge_rg = KernelRidge(alpha=1.0)</span>

  <span class="n">cv</span> <span class="o">=</span> <span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
  <span class="n">n_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">ridge_rg</span><span class="p">,</span> <span class="n">X_given</span><span class="p">,</span> <span class="n">y_given</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">error_score</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE: </span><span class="si">%.3f</span><span class="s1"> (</span><span class="si">%.3f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">n_scores</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">n_scores</span><span class="p">)))</span>

<span class="c1">#ridge_rg(X_imp_mean,y_delete) </span>
<span class="c1">#ridge_rg(X_cleaned,y_cleaned) # RMSE: -63.052 (6.967)</span>
<span class="c1">#ridge_rg(X_delete_cleaned,y_delete_cleaned) # RMSE: -32.634 (56.319)</span>
<span class="c1">#ridge_rg(X_train_cleaned,y_train_cleaned) # RMSE: -19.272 (11.371), alpha = 100 -&gt; RMSE: -17.142 (2.080)</span>
<span class="c1">#ridge_rg(X_train, y_train) </span>
<span class="c1">#ridge_rg(X_imputed, y_delete)</span>
<span class="c1">#ridge_rg(X_delete_cleaned, y_delete_cleaned)</span>
<span class="c1">#ridge_rg(X_delete_robust, y_delete)</span>
<span class="c1">#ridge_rg(X_imp_knn, y_delete)</span>
<span class="c1">#ridge_rg(X_reduced, y_delete)</span>
<span class="n">ridge_rg</span><span class="p">(</span><span class="n">X_imp_median</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: -17.580 (2.005)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#submission</span>
<span class="n">ridge_rg</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>

<span class="n">ridge_rg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_cleaned</span><span class="p">,</span> <span class="n">y_train_cleaned</span><span class="p">)</span> <span class="c1"># 81</span>
<span class="c1">#ridge_rg.fit(X_train, y_train) # 77</span>
<span class="c1">#ridge_rg.fit(X_delete, y_delete) # 81</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">ridge_rg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1">#ridge_rg.fit(X_delete_cleaned, y_delete_cleaned) # 81</span>
<span class="c1">#ridge_rg.fit(X_reduced, y_delete)x # 81</span>
<span class="c1">#y_pred = ridge_rg.predict(X_test_reduced)</span>

<span class="c1">#y_pred = ridge_rg.predict(X_test_imputed)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.7/dist-packages/sklearn/linear_model/_ridge.py:148: LinAlgWarning: Ill-conditioned matrix (rcond=1.61801e-27): result may not be accurate.
  overwrite_a=True).T
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>83.38126033859747
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#y_pred[y_pred&lt;0] = 0</span>
<span class="n">y_pred</span><span class="p">[(</span><span class="n">y_pred</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#X_train_cleaned.describe()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>83.38057545483085
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span><span class="p">[</span><span class="n">y_pred</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0.])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make predictions in test set and prepare submission file</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">ridge_rg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="n">main_cols</span><span class="p">])</span>
<span class="n">sub_file</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">sub_file</span><span class="o">.</span><span class="n">close</span> <span class="o">=</span> <span class="n">predictions</span>
<span class="n">sub_file</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;Baseline.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sub_file</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>close</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ID_323Sn2</td>
      <td>-0.929759</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ID_325SNW</td>
      <td>11364.683493</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ID_325uzE</td>
      <td>6303.025363</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ID_328qCx</td>
      <td>-0.333211</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ID_3293uJ</td>
      <td>-0.496252</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;Baseline.csv&#39;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">
    async function download(id, filename, size) {
      if (!google.colab.kernel.accessAllowed) {
        return;
      }
      const div = document.createElement('div');
      const label = document.createElement('label');
      label.textContent = `Downloading "${filename}": `;
      div.appendChild(label);
      const progress = document.createElement('progress');
      progress.max = size;
      div.appendChild(progress);
      document.body.appendChild(div);

      const buffers = [];
      let downloaded = 0;

      const channel = await google.colab.kernel.comms.open(id);
      // Send a message to notify the kernel that we're ready.
      channel.send({})

      for await (const message of channel.messages) {
        // Send a message to notify the kernel that we're ready.
        channel.send({})
        if (message.buffers) {
          for (const buffer of message.buffers) {
            buffers.push(buffer);
            downloaded += buffer.byteLength;
            progress.value = downloaded;
          }
        }
      }
      const blob = new Blob(buffers, {type: 'application/binary'});
      const a = document.createElement('a');
      a.href = window.URL.createObjectURL(blob);
      a.download = filename;
      div.appendChild(a);
      a.click();
      div.remove();
    }
  </script><script type="application/javascript">download("download_dcbd0986-83eb-402d-91f5-56f3b8c395d0", "Baseline.csv", 178394)</script></div>
</div>
</section>
<section id="formal">
<h3>formal<a class="headerlink" href="#formal" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#submission</span>
<span class="n">ridge_rg</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>


<span class="c1">#ridge_rg = make_pipeline(StandardScaler(), Ridge(alpha=10.0)) # 77</span>
<span class="c1">#ridge_rg.fit(X_train_cleaned, y_train_cleaned)</span>
<span class="c1">#ridge_rg.fit(X_train, y_train) # 77.54780979871404</span>
<span class="c1">#ridge_rg.fit(X_imputed, y_train)</span>
<span class="c1">#ridge_rg.fit(X_delete, y_delete) # 77.58237723128258</span>
<span class="c1">#ridge_rg.fit(X_delete_cleaned, y_delete_cleaned) # 83.99180726695666</span>
<span class="c1">#ridge_rg.fit(X_delete_imputed, y_delete) # 83.99180726695666</span>
<span class="c1"># ridge_rg.fit(X_delete, y_delete) </span>

<span class="c1"># y_pred = ridge_rg.predict(X_test)</span>


<span class="c1"># ridge_rg.fit(X_delete_robust, y_delete) </span>
<span class="c1"># y_pred = ridge_rg.predict(X_test_robust) 222</span>


<span class="n">ridge_rg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_delete_robust</span><span class="p">,</span> <span class="n">y_delete</span><span class="p">)</span> 
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">ridge_rg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_robust</span><span class="p">)</span> <span class="mi">222</span>


<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>222.34371163499102
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="used-on-x-train-instead-of-x-delete-as-above">
<h2>used on X_train instead of X_delete as above<a class="headerlink" href="#used-on-x-train-instead-of-x-delete-as-above" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># used on X_train instead of X_delete as above</span>

<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">IsolationForest</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">f1_score</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">model_selection</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_classification</span>

<span class="n">iso</span> <span class="o">=</span> <span class="n">IsolationForest</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">contamination</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">iso</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_train_cleaned</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
<span class="n">y_train_cleaned</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>

<span class="c1"># summarize the shape of the updated training dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train_cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train_cleaned</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">cleaned</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">X_train_cleaned</span><span class="o">.</span><span class="n">shape</span>

<span class="n">total</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of outlier row removed: &quot;</span><span class="p">,</span> <span class="n">total</span> <span class="o">-</span> <span class="n">cleaned</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;percentage of outliers removed: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">total</span><span class="o">-</span><span class="n">cleaned</span><span class="p">)</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(9599, 47) (9599,)
number of outlier row removed:  506
percentage of outliers removed:  0.05007422068283028
</pre></div>
</div>
</div>
</div>
<section id="param-tuning">
<h3>param tuning<a class="headerlink" href="#param-tuning" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ridge_rg</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">()</span>
<span class="c1"># define grid</span>
<span class="n">grid</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">grid</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="c1"># define search</span>
<span class="n">search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">ridge_rg</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># perform the search</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="c1"># summarize</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">results</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Config: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">results</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: -52.000
Config: {&#39;alpha&#39;: 3.95}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.7/dist-packages/sklearn/linear_model/_ridge.py:148: LinAlgWarning: Ill-conditioned matrix (rcond=1.48786e-27): result may not be accurate.
  overwrite_a=True).T
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=RepeatedKFold(n_repeats=3, n_splits=10, random_state=23),
             error_score=nan,
             estimator=Ridge(alpha=1.0, copy_X=True, fit_intercept=True,
                             max_iter=None, normalize=False, random_state=None,
                             solver=&#39;auto&#39;, tol=0.001),
             iid=&#39;deprecated&#39;, n_jobs=-1,
             param_grid={&#39;alpha&#39;: array([0.  , 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, 0.1 ,
       0.11, 0.12, 0.13, 0.14, 0.15, 0....
       1.43, 1.44, 1.45, 1.46, 1.47, 1.48, 1.49, 1.5 , 1.51, 1.52, 1.53,
       1.54, 1.55, 1.56, 1.57, 1.58, 1.59, 1.6 , 1.61, 1.62, 1.63, 1.64,
       1.65, 1.66, 1.67, 1.68, 1.69, 1.7 , 1.71, 1.72, 1.73, 1.74, 1.75,
       1.76, 1.77, 1.78, 1.79, 1.8 , 1.81, 1.82, 1.83, 1.84, 1.85, 1.86,
       1.87, 1.88, 1.89, 1.9 , 1.91, 1.92, 1.93, 1.94, 1.95, 1.96, 1.97,
       1.98, 1.99])},
             pre_dispatch=&#39;2*n_jobs&#39;, refit=True, return_train_score=False,
             scoring=&#39;neg_root_mean_squared_error&#39;, verbose=0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clf</span><span class="o">.</span><span class="n">grid_scores_</span><span class="p">]</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Cs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Gammas</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Cs</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Gammas</span><span class="p">,</span> <span class="n">scores</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;C: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Gamma&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean score&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>##Lasso reg</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span>
<span class="n">lasso_rg</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">n_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">lasso_rg</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">error_score</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAE: </span><span class="si">%.3f</span><span class="s1"> (</span><span class="si">%.3f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">n_scores</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">n_scores</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE: -88.216 (14.829)
</pre></div>
</div>
</div>
</div>
<p>##Elasticnet</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">ElasticNet</span>
<span class="n">elastic</span> <span class="o">=</span> <span class="n">ElasticNet</span><span class="p">()</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">n_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">elastic</span><span class="p">,</span> <span class="n">X_train_cleaned</span><span class="p">,</span> <span class="n">y_train_cleaned</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">error_score</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAE: </span><span class="si">%.3f</span><span class="s1"> (</span><span class="si">%.3f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">n_scores</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">n_scores</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE: -34.489 (5.653)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#submission</span>
<span class="n">elastic</span> <span class="o">=</span> <span class="n">ElasticNet</span><span class="p">()</span>
<span class="c1">#ridge_rg = make_pipeline(StandardScaler(), Ridge(alpha=0.8))</span>
<span class="n">elastic</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_cleaned</span><span class="p">,</span> <span class="n">y_train_cleaned</span><span class="p">)</span>
<span class="c1">#elastic.fit(X_train, y_train)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">elastic</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>91.70903709500718
</pre></div>
</div>
</div>
</div>
<p>##RGF regression</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>rgf_python
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rgf.sklearn</span> <span class="kn">import</span> <span class="n">RGFRegressor</span>
<span class="n">rgf_rg</span> <span class="o">=</span> <span class="n">RGFRegressor</span><span class="p">(</span><span class="n">max_leaf</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;RGF_Sib&quot;</span><span class="p">,</span> <span class="n">test_interval</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s2">&quot;LS&quot;</span><span class="p">)</span>

<span class="n">cv</span> <span class="o">=</span> <span class="n">RepeatedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_repeats</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
<span class="n">n_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">rgf_rg</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_root_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">error_score</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAE: </span><span class="si">%.3f</span><span class="s1"> (</span><span class="si">%.3f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">n_scores</span><span class="p">),</span> <span class="n">std</span><span class="p">(</span><span class="n">n_scores</span><span class="p">)))</span> <span class="c1"># MAE: -473.728 (29.295)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE: -473.728 (29.295)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="linear-regression">
<h2>linear regression<a class="headerlink" href="#linear-regression" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instantiate model</span>
<span class="n">lm2</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="c1"># Fit Model</span>
<span class="n">lm2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="c1"># Predict</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">lm2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>69.88118625011259
</pre></div>
</div>
</div>
</div>
</section>
<section id="autosklearn">
<h2>autosklearn<a class="headerlink" href="#autosklearn" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!pip install auto-sklearn</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">autosklearn.regression</span>
<span class="kn">from</span> <span class="nn">autosklearn.metrics</span> <span class="kn">import</span> <span class="n">root_mean_squared_error</span> 
<span class="n">n_mins</span> <span class="o">=</span> <span class="mi">90</span>
<span class="n">automl</span> <span class="o">=</span> <span class="n">autosklearn</span><span class="o">.</span><span class="n">regression</span><span class="o">.</span><span class="n">AutoSklearnRegressor</span><span class="p">(</span>
    <span class="n">time_left_for_this_task</span><span class="o">=</span><span class="n">n_mins</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
    <span class="c1">#include_preprocessors=[&quot;no_preprocessing&quot;], exclude_preprocessors=None,</span>
    <span class="n">exclude_estimators</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sgd&quot;</span><span class="p">,</span> <span class="s2">&quot;gaussian_process&quot;</span><span class="p">,</span> <span class="s2">&quot;ard_regression&quot;</span><span class="p">,</span> <span class="s2">&quot;liblinear_svr&quot;</span><span class="p">],</span> <span class="c1">#,</span>
    <span class="n">per_run_time_limit</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">ensemble_size</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="n">root_mean_squared_error</span> 
<span class="c1">#    n_jobs=4</span>
<span class="p">)</span>
<span class="n">automl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_delete</span><span class="p">,</span> <span class="n">y_delete</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">automl</span><span class="o">.</span><span class="n">leaderboard</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">automl</span><span class="o">.</span><span class="n">show_models</span><span class="p">())</span>

<span class="n">train_predictions</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="c1">#submission</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">train_predictions</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          rank  ensemble_weight         type       cost   duration
model_id                                                          
138          1         0.666667  extra_trees  72.733075   9.529518
212          2         0.166667     adaboost  79.614408  10.006911
162          3         0.166667     adaboost  82.752278   4.703150
[(0.666667, SimpleRegressionPipeline({&#39;data_preprocessing:categorical_transformer:categorical_encoding:__choice__&#39;: &#39;no_encoding&#39;, &#39;data_preprocessing:categorical_transformer:category_coalescence:__choice__&#39;: &#39;minority_coalescer&#39;, &#39;data_preprocessing:numerical_transformer:imputation:strategy&#39;: &#39;mean&#39;, &#39;data_preprocessing:numerical_transformer:rescaling:__choice__&#39;: &#39;minmax&#39;, &#39;feature_preprocessor:__choice__&#39;: &#39;feature_agglomeration&#39;, &#39;regressor:__choice__&#39;: &#39;extra_trees&#39;, &#39;data_preprocessing:categorical_transformer:category_coalescence:minority_coalescer:minimum_fraction&#39;: 0.013555629780288401, &#39;feature_preprocessor:feature_agglomeration:affinity&#39;: &#39;euclidean&#39;, &#39;feature_preprocessor:feature_agglomeration:linkage&#39;: &#39;average&#39;, &#39;feature_preprocessor:feature_agglomeration:n_clusters&#39;: 361, &#39;feature_preprocessor:feature_agglomeration:pooling_func&#39;: &#39;median&#39;, &#39;regressor:extra_trees:bootstrap&#39;: &#39;False&#39;, &#39;regressor:extra_trees:criterion&#39;: &#39;friedman_mse&#39;, &#39;regressor:extra_trees:max_depth&#39;: &#39;None&#39;, &#39;regressor:extra_trees:max_features&#39;: 0.7929825166874074, &#39;regressor:extra_trees:max_leaf_nodes&#39;: &#39;None&#39;, &#39;regressor:extra_trees:min_impurity_decrease&#39;: 0.0, &#39;regressor:extra_trees:min_samples_leaf&#39;: 2, &#39;regressor:extra_trees:min_samples_split&#39;: 6, &#39;regressor:extra_trees:min_weight_fraction_leaf&#39;: 0.0},
dataset_properties={
  &#39;task&#39;: 4,
  &#39;sparse&#39;: False,
  &#39;multioutput&#39;: False,
  &#39;target_type&#39;: &#39;regression&#39;,
  &#39;signed&#39;: False})),
(0.166667, SimpleRegressionPipeline({&#39;data_preprocessing:categorical_transformer:categorical_encoding:__choice__&#39;: &#39;encoding&#39;, &#39;data_preprocessing:categorical_transformer:category_coalescence:__choice__&#39;: &#39;no_coalescense&#39;, &#39;data_preprocessing:numerical_transformer:imputation:strategy&#39;: &#39;median&#39;, &#39;data_preprocessing:numerical_transformer:rescaling:__choice__&#39;: &#39;standardize&#39;, &#39;feature_preprocessor:__choice__&#39;: &#39;extra_trees_preproc_for_regression&#39;, &#39;regressor:__choice__&#39;: &#39;adaboost&#39;, &#39;feature_preprocessor:extra_trees_preproc_for_regression:bootstrap&#39;: &#39;True&#39;, &#39;feature_preprocessor:extra_trees_preproc_for_regression:criterion&#39;: &#39;mse&#39;, &#39;feature_preprocessor:extra_trees_preproc_for_regression:max_depth&#39;: &#39;None&#39;, &#39;feature_preprocessor:extra_trees_preproc_for_regression:max_features&#39;: 0.19782436692694, &#39;feature_preprocessor:extra_trees_preproc_for_regression:max_leaf_nodes&#39;: &#39;None&#39;, &#39;feature_preprocessor:extra_trees_preproc_for_regression:min_samples_leaf&#39;: 17, &#39;feature_preprocessor:extra_trees_preproc_for_regression:min_samples_split&#39;: 20, &#39;feature_preprocessor:extra_trees_preproc_for_regression:min_weight_fraction_leaf&#39;: 0.0, &#39;feature_preprocessor:extra_trees_preproc_for_regression:n_estimators&#39;: 100, &#39;regressor:adaboost:learning_rate&#39;: 0.12607892443038982, &#39;regressor:adaboost:loss&#39;: &#39;exponential&#39;, &#39;regressor:adaboost:max_depth&#39;: 9, &#39;regressor:adaboost:n_estimators&#39;: 294},
dataset_properties={
  &#39;task&#39;: 4,
  &#39;sparse&#39;: False,
  &#39;multioutput&#39;: False,
  &#39;target_type&#39;: &#39;regression&#39;,
  &#39;signed&#39;: False})),
(0.166667, SimpleRegressionPipeline({&#39;data_preprocessing:categorical_transformer:categorical_encoding:__choice__&#39;: &#39;one_hot_encoding&#39;, &#39;data_preprocessing:categorical_transformer:category_coalescence:__choice__&#39;: &#39;no_coalescense&#39;, &#39;data_preprocessing:numerical_transformer:imputation:strategy&#39;: &#39;most_frequent&#39;, &#39;data_preprocessing:numerical_transformer:rescaling:__choice__&#39;: &#39;none&#39;, &#39;feature_preprocessor:__choice__&#39;: &#39;select_percentile_regression&#39;, &#39;regressor:__choice__&#39;: &#39;adaboost&#39;, &#39;feature_preprocessor:select_percentile_regression:percentile&#39;: 41.86380543467466, &#39;feature_preprocessor:select_percentile_regression:score_func&#39;: &#39;mutual_info&#39;, &#39;regressor:adaboost:learning_rate&#39;: 1.057700995650525, &#39;regressor:adaboost:loss&#39;: &#39;exponential&#39;, &#39;regressor:adaboost:max_depth&#39;: 6, &#39;regressor:adaboost:n_estimators&#39;: 123},
dataset_properties={
  &#39;task&#39;: 4,
  &#39;sparse&#39;: False,
  &#39;multioutput&#39;: False,
  &#39;target_type&#39;: &#39;regression&#39;,
  &#39;signed&#39;: False})),
]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>75.24776710829738
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">automl</span><span class="o">.</span><span class="n">leaderboard</span><span class="p">(</span><span class="n">detailed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ensemble_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="c1">#.loc[228] # , top_k=8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rank</th>
      <th>ensemble_weight</th>
      <th>type</th>
      <th>cost</th>
      <th>duration</th>
      <th>config_id</th>
      <th>train_loss</th>
      <th>seed</th>
      <th>start_time</th>
      <th>end_time</th>
      <th>budget</th>
      <th>status</th>
      <th>data_preprocessors</th>
      <th>feature_preprocessors</th>
      <th>balancing_strategy</th>
      <th>config_origin</th>
    </tr>
    <tr>
      <th>model_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>138</th>
      <td>1</td>
      <td>0.666667</td>
      <td>extra_trees</td>
      <td>7.273308e+01</td>
      <td>9.529518</td>
      <td>137</td>
      <td>2.520348e+01</td>
      <td>0</td>
      <td>1.630304e+09</td>
      <td>1.630304e+09</td>
      <td>0.0</td>
      <td>StatusType.SUCCESS</td>
      <td>[no_encoding, minority_coalescer, minmax]</td>
      <td>[feature_agglomeration]</td>
      <td>None</td>
      <td>Random Search</td>
    </tr>
    <tr>
      <th>254</th>
      <td>2</td>
      <td>0.000000</td>
      <td>random_forest</td>
      <td>7.768864e+01</td>
      <td>5.984977</td>
      <td>253</td>
      <td>3.526550e+01</td>
      <td>0</td>
      <td>1.630306e+09</td>
      <td>1.630306e+09</td>
      <td>0.0</td>
      <td>StatusType.SUCCESS</td>
      <td>[encoding, minority_coalescer, robust_scaler]</td>
      <td>[extra_trees_preproc_for_regression]</td>
      <td>None</td>
      <td>Local Search</td>
    </tr>
    <tr>
      <th>279</th>
      <td>3</td>
      <td>0.000000</td>
      <td>random_forest</td>
      <td>7.781746e+01</td>
      <td>18.581241</td>
      <td>278</td>
      <td>4.018407e+01</td>
      <td>0</td>
      <td>1.630306e+09</td>
      <td>1.630306e+09</td>
      <td>0.0</td>
      <td>StatusType.SUCCESS</td>
      <td>[one_hot_encoding, minority_coalescer, robust_...</td>
      <td>[extra_trees_preproc_for_regression]</td>
      <td>None</td>
      <td>Local Search</td>
    </tr>
    <tr>
      <th>250</th>
      <td>4</td>
      <td>0.000000</td>
      <td>random_forest</td>
      <td>7.790338e+01</td>
      <td>5.156501</td>
      <td>249</td>
      <td>4.289506e+01</td>
      <td>0</td>
      <td>1.630306e+09</td>
      <td>1.630306e+09</td>
      <td>0.0</td>
      <td>StatusType.SUCCESS</td>
      <td>[one_hot_encoding, minority_coalescer, minmax]</td>
      <td>[extra_trees_preproc_for_regression]</td>
      <td>None</td>
      <td>Local Search</td>
    </tr>
    <tr>
      <th>212</th>
      <td>5</td>
      <td>0.166667</td>
      <td>adaboost</td>
      <td>7.961441e+01</td>
      <td>10.006911</td>
      <td>211</td>
      <td>2.084614e+01</td>
      <td>0</td>
      <td>1.630305e+09</td>
      <td>1.630305e+09</td>
      <td>0.0</td>
      <td>StatusType.SUCCESS</td>
      <td>[encoding, no_coalescense, standardize]</td>
      <td>[extra_trees_preproc_for_regression]</td>
      <td>None</td>
      <td>Random Search</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>72</th>
      <td>240</td>
      <td>0.000000</td>
      <td>mlp</td>
      <td>7.224725e+04</td>
      <td>1.044162</td>
      <td>71</td>
      <td>7.788008e+04</td>
      <td>0</td>
      <td>1.630303e+09</td>
      <td>1.630303e+09</td>
      <td>0.0</td>
      <td>StatusType.SUCCESS</td>
      <td>[one_hot_encoding, minority_coalescer, standar...</td>
      <td>[select_percentile_regression]</td>
      <td>None</td>
      <td>Random Search</td>
    </tr>
    <tr>
      <th>71</th>
      <td>241</td>
      <td>0.000000</td>
      <td>libsvm_svr</td>
      <td>2.025107e+08</td>
      <td>4.539333</td>
      <td>70</td>
      <td>2.055586e+08</td>
      <td>0</td>
      <td>1.630303e+09</td>
      <td>1.630303e+09</td>
      <td>0.0</td>
      <td>StatusType.SUCCESS</td>
      <td>[one_hot_encoding, minority_coalescer, power_t...</td>
      <td>[extra_trees_preproc_for_regression]</td>
      <td>None</td>
      <td>Local Search</td>
    </tr>
    <tr>
      <th>142</th>
      <td>242</td>
      <td>0.000000</td>
      <td>mlp</td>
      <td>4.804678e+10</td>
      <td>3.252325</td>
      <td>141</td>
      <td>7.504285e+10</td>
      <td>0</td>
      <td>1.630304e+09</td>
      <td>1.630304e+09</td>
      <td>0.0</td>
      <td>StatusType.SUCCESS</td>
      <td>[encoding, minority_coalescer, standardize]</td>
      <td>[polynomial]</td>
      <td>None</td>
      <td>Random Search</td>
    </tr>
    <tr>
      <th>230</th>
      <td>243</td>
      <td>0.000000</td>
      <td>mlp</td>
      <td>8.963465e+13</td>
      <td>2.011017</td>
      <td>229</td>
      <td>7.336363e+16</td>
      <td>0</td>
      <td>1.630305e+09</td>
      <td>1.630305e+09</td>
      <td>0.0</td>
      <td>StatusType.SUCCESS</td>
      <td>[no_encoding, minority_coalescer, robust_scaler]</td>
      <td>[feature_agglomeration]</td>
      <td>None</td>
      <td>Random Search</td>
    </tr>
    <tr>
      <th>179</th>
      <td>244</td>
      <td>0.000000</td>
      <td>mlp</td>
      <td>1.255207e+14</td>
      <td>1.651953</td>
      <td>178</td>
      <td>1.257901e+14</td>
      <td>0</td>
      <td>1.630305e+09</td>
      <td>1.630305e+09</td>
      <td>0.0</td>
      <td>StatusType.SUCCESS</td>
      <td>[no_encoding, no_coalescense, robust_scaler]</td>
      <td>[extra_trees_preproc_for_regression]</td>
      <td>None</td>
      <td>Random Search</td>
    </tr>
  </tbody>
</table>
<p>244 rows × 16 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">automl</span><span class="o">.</span><span class="n">get_models_with_weights</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(0.6666666666666666,
  SimpleRegressionPipeline({&#39;data_preprocessing:categorical_transformer:categorical_encoding:__choice__&#39;: &#39;no_encoding&#39;, &#39;data_preprocessing:categorical_transformer:category_coalescence:__choice__&#39;: &#39;minority_coalescer&#39;, &#39;data_preprocessing:numerical_transformer:imputation:strategy&#39;: &#39;mean&#39;, &#39;data_preprocessing:numerical_transformer:rescaling:__choice__&#39;: &#39;minmax&#39;, &#39;feature_preprocessor:__choice__&#39;: &#39;feature_agglomeration&#39;, &#39;regressor:__choice__&#39;: &#39;extra_trees&#39;, &#39;data_preprocessing:categorical_transformer:category_coalescence:minority_coalescer:minimum_fraction&#39;: 0.013555629780288401, &#39;feature_preprocessor:feature_agglomeration:affinity&#39;: &#39;euclidean&#39;, &#39;feature_preprocessor:feature_agglomeration:linkage&#39;: &#39;average&#39;, &#39;feature_preprocessor:feature_agglomeration:n_clusters&#39;: 361, &#39;feature_preprocessor:feature_agglomeration:pooling_func&#39;: &#39;median&#39;, &#39;regressor:extra_trees:bootstrap&#39;: &#39;False&#39;, &#39;regressor:extra_trees:criterion&#39;: &#39;friedman_mse&#39;, &#39;regressor:extra_trees:max_depth&#39;: &#39;None&#39;, &#39;regressor:extra_trees:max_features&#39;: 0.7929825166874074, &#39;regressor:extra_trees:max_leaf_nodes&#39;: &#39;None&#39;, &#39;regressor:extra_trees:min_impurity_decrease&#39;: 0.0, &#39;regressor:extra_trees:min_samples_leaf&#39;: 2, &#39;regressor:extra_trees:min_samples_split&#39;: 6, &#39;regressor:extra_trees:min_weight_fraction_leaf&#39;: 0.0},
  dataset_properties={
    &#39;task&#39;: 4,
    &#39;sparse&#39;: False,
    &#39;multioutput&#39;: False,
    &#39;target_type&#39;: &#39;regression&#39;,
    &#39;signed&#39;: False})),
 (0.16666666666666666,
  SimpleRegressionPipeline({&#39;data_preprocessing:categorical_transformer:categorical_encoding:__choice__&#39;: &#39;encoding&#39;, &#39;data_preprocessing:categorical_transformer:category_coalescence:__choice__&#39;: &#39;no_coalescense&#39;, &#39;data_preprocessing:numerical_transformer:imputation:strategy&#39;: &#39;median&#39;, &#39;data_preprocessing:numerical_transformer:rescaling:__choice__&#39;: &#39;standardize&#39;, &#39;feature_preprocessor:__choice__&#39;: &#39;extra_trees_preproc_for_regression&#39;, &#39;regressor:__choice__&#39;: &#39;adaboost&#39;, &#39;feature_preprocessor:extra_trees_preproc_for_regression:bootstrap&#39;: &#39;True&#39;, &#39;feature_preprocessor:extra_trees_preproc_for_regression:criterion&#39;: &#39;mse&#39;, &#39;feature_preprocessor:extra_trees_preproc_for_regression:max_depth&#39;: &#39;None&#39;, &#39;feature_preprocessor:extra_trees_preproc_for_regression:max_features&#39;: 0.19782436692694, &#39;feature_preprocessor:extra_trees_preproc_for_regression:max_leaf_nodes&#39;: &#39;None&#39;, &#39;feature_preprocessor:extra_trees_preproc_for_regression:min_samples_leaf&#39;: 17, &#39;feature_preprocessor:extra_trees_preproc_for_regression:min_samples_split&#39;: 20, &#39;feature_preprocessor:extra_trees_preproc_for_regression:min_weight_fraction_leaf&#39;: 0.0, &#39;feature_preprocessor:extra_trees_preproc_for_regression:n_estimators&#39;: 100, &#39;regressor:adaboost:learning_rate&#39;: 0.12607892443038982, &#39;regressor:adaboost:loss&#39;: &#39;exponential&#39;, &#39;regressor:adaboost:max_depth&#39;: 9, &#39;regressor:adaboost:n_estimators&#39;: 294},
  dataset_properties={
    &#39;task&#39;: 4,
    &#39;sparse&#39;: False,
    &#39;multioutput&#39;: False,
    &#39;target_type&#39;: &#39;regression&#39;,
    &#39;signed&#39;: False})),
 (0.16666666666666666,
  SimpleRegressionPipeline({&#39;data_preprocessing:categorical_transformer:categorical_encoding:__choice__&#39;: &#39;one_hot_encoding&#39;, &#39;data_preprocessing:categorical_transformer:category_coalescence:__choice__&#39;: &#39;no_coalescense&#39;, &#39;data_preprocessing:numerical_transformer:imputation:strategy&#39;: &#39;most_frequent&#39;, &#39;data_preprocessing:numerical_transformer:rescaling:__choice__&#39;: &#39;none&#39;, &#39;feature_preprocessor:__choice__&#39;: &#39;select_percentile_regression&#39;, &#39;regressor:__choice__&#39;: &#39;adaboost&#39;, &#39;feature_preprocessor:select_percentile_regression:percentile&#39;: 41.86380543467466, &#39;feature_preprocessor:select_percentile_regression:score_func&#39;: &#39;mutual_info&#39;, &#39;regressor:adaboost:learning_rate&#39;: 1.057700995650525, &#39;regressor:adaboost:loss&#39;: &#39;exponential&#39;, &#39;regressor:adaboost:max_depth&#39;: 6, &#39;regressor:adaboost:n_estimators&#39;: 123},
  dataset_properties={
    &#39;task&#39;: 4,
    &#39;sparse&#39;: False,
    &#39;multioutput&#39;: False,
    &#39;target_type&#39;: &#39;regression&#39;,
    &#39;signed&#39;: False}))]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">automl</span><span class="o">.</span><span class="n">cv_results_</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;mean_test_score&#39;, &#39;mean_fit_time&#39;, &#39;params&#39;, &#39;rank_test_scores&#39;, &#39;status&#39;, &#39;budgets&#39;, &#39;param_data_preprocessing:categorical_transformer:categorical_encoding:__choice__&#39;, &#39;param_data_preprocessing:categorical_transformer:category_coalescence:__choice__&#39;, &#39;param_data_preprocessing:numerical_transformer:imputation:strategy&#39;, &#39;param_data_preprocessing:numerical_transformer:rescaling:__choice__&#39;, &#39;param_feature_preprocessor:__choice__&#39;, &#39;param_regressor:__choice__&#39;, &#39;param_data_preprocessing:categorical_transformer:category_coalescence:minority_coalescer:minimum_fraction&#39;, &#39;param_data_preprocessing:numerical_transformer:rescaling:quantile_transformer:n_quantiles&#39;, &#39;param_data_preprocessing:numerical_transformer:rescaling:quantile_transformer:output_distribution&#39;, &#39;param_data_preprocessing:numerical_transformer:rescaling:robust_scaler:q_max&#39;, &#39;param_data_preprocessing:numerical_transformer:rescaling:robust_scaler:q_min&#39;, &#39;param_feature_preprocessor:extra_trees_preproc_for_regression:bootstrap&#39;, &#39;param_feature_preprocessor:extra_trees_preproc_for_regression:criterion&#39;, &#39;param_feature_preprocessor:extra_trees_preproc_for_regression:max_depth&#39;, &#39;param_feature_preprocessor:extra_trees_preproc_for_regression:max_features&#39;, &#39;param_feature_preprocessor:extra_trees_preproc_for_regression:max_leaf_nodes&#39;, &#39;param_feature_preprocessor:extra_trees_preproc_for_regression:min_samples_leaf&#39;, &#39;param_feature_preprocessor:extra_trees_preproc_for_regression:min_samples_split&#39;, &#39;param_feature_preprocessor:extra_trees_preproc_for_regression:min_weight_fraction_leaf&#39;, &#39;param_feature_preprocessor:extra_trees_preproc_for_regression:n_estimators&#39;, &#39;param_feature_preprocessor:fast_ica:algorithm&#39;, &#39;param_feature_preprocessor:fast_ica:fun&#39;, &#39;param_feature_preprocessor:fast_ica:whiten&#39;, &#39;param_feature_preprocessor:feature_agglomeration:affinity&#39;, &#39;param_feature_preprocessor:feature_agglomeration:linkage&#39;, &#39;param_feature_preprocessor:feature_agglomeration:n_clusters&#39;, &#39;param_feature_preprocessor:feature_agglomeration:pooling_func&#39;, &#39;param_feature_preprocessor:kernel_pca:kernel&#39;, &#39;param_feature_preprocessor:kernel_pca:n_components&#39;, &#39;param_feature_preprocessor:kitchen_sinks:gamma&#39;, &#39;param_feature_preprocessor:kitchen_sinks:n_components&#39;, &#39;param_feature_preprocessor:nystroem_sampler:kernel&#39;, &#39;param_feature_preprocessor:nystroem_sampler:n_components&#39;, &#39;param_feature_preprocessor:pca:keep_variance&#39;, &#39;param_feature_preprocessor:pca:whiten&#39;, &#39;param_feature_preprocessor:polynomial:degree&#39;, &#39;param_feature_preprocessor:polynomial:include_bias&#39;, &#39;param_feature_preprocessor:polynomial:interaction_only&#39;, &#39;param_feature_preprocessor:random_trees_embedding:bootstrap&#39;, &#39;param_feature_preprocessor:random_trees_embedding:max_depth&#39;, &#39;param_feature_preprocessor:random_trees_embedding:max_leaf_nodes&#39;, &#39;param_feature_preprocessor:random_trees_embedding:min_samples_leaf&#39;, &#39;param_feature_preprocessor:random_trees_embedding:min_samples_split&#39;, &#39;param_feature_preprocessor:random_trees_embedding:min_weight_fraction_leaf&#39;, &#39;param_feature_preprocessor:random_trees_embedding:n_estimators&#39;, &#39;param_feature_preprocessor:select_percentile_regression:percentile&#39;, &#39;param_feature_preprocessor:select_percentile_regression:score_func&#39;, &#39;param_feature_preprocessor:select_rates_regression:alpha&#39;, &#39;param_feature_preprocessor:select_rates_regression:mode&#39;, &#39;param_feature_preprocessor:select_rates_regression:score_func&#39;, &#39;param_regressor:adaboost:learning_rate&#39;, &#39;param_regressor:adaboost:loss&#39;, &#39;param_regressor:adaboost:max_depth&#39;, &#39;param_regressor:adaboost:n_estimators&#39;, &#39;param_regressor:decision_tree:criterion&#39;, &#39;param_regressor:decision_tree:max_depth_factor&#39;, &#39;param_regressor:decision_tree:max_features&#39;, &#39;param_regressor:decision_tree:max_leaf_nodes&#39;, &#39;param_regressor:decision_tree:min_impurity_decrease&#39;, &#39;param_regressor:decision_tree:min_samples_leaf&#39;, &#39;param_regressor:decision_tree:min_samples_split&#39;, &#39;param_regressor:decision_tree:min_weight_fraction_leaf&#39;, &#39;param_regressor:extra_trees:bootstrap&#39;, &#39;param_regressor:extra_trees:criterion&#39;, &#39;param_regressor:extra_trees:max_depth&#39;, &#39;param_regressor:extra_trees:max_features&#39;, &#39;param_regressor:extra_trees:max_leaf_nodes&#39;, &#39;param_regressor:extra_trees:min_impurity_decrease&#39;, &#39;param_regressor:extra_trees:min_samples_leaf&#39;, &#39;param_regressor:extra_trees:min_samples_split&#39;, &#39;param_regressor:extra_trees:min_weight_fraction_leaf&#39;, &#39;param_regressor:gradient_boosting:early_stop&#39;, &#39;param_regressor:gradient_boosting:l2_regularization&#39;, &#39;param_regressor:gradient_boosting:learning_rate&#39;, &#39;param_regressor:gradient_boosting:loss&#39;, &#39;param_regressor:gradient_boosting:max_bins&#39;, &#39;param_regressor:gradient_boosting:max_depth&#39;, &#39;param_regressor:gradient_boosting:max_leaf_nodes&#39;, &#39;param_regressor:gradient_boosting:min_samples_leaf&#39;, &#39;param_regressor:gradient_boosting:scoring&#39;, &#39;param_regressor:gradient_boosting:tol&#39;, &#39;param_regressor:k_nearest_neighbors:n_neighbors&#39;, &#39;param_regressor:k_nearest_neighbors:p&#39;, &#39;param_regressor:k_nearest_neighbors:weights&#39;, &#39;param_regressor:libsvm_svr:C&#39;, &#39;param_regressor:libsvm_svr:epsilon&#39;, &#39;param_regressor:libsvm_svr:kernel&#39;, &#39;param_regressor:libsvm_svr:max_iter&#39;, &#39;param_regressor:libsvm_svr:shrinking&#39;, &#39;param_regressor:libsvm_svr:tol&#39;, &#39;param_regressor:mlp:activation&#39;, &#39;param_regressor:mlp:alpha&#39;, &#39;param_regressor:mlp:batch_size&#39;, &#39;param_regressor:mlp:beta_1&#39;, &#39;param_regressor:mlp:beta_2&#39;, &#39;param_regressor:mlp:early_stopping&#39;, &#39;param_regressor:mlp:epsilon&#39;, &#39;param_regressor:mlp:hidden_layer_depth&#39;, &#39;param_regressor:mlp:learning_rate_init&#39;, &#39;param_regressor:mlp:n_iter_no_change&#39;, &#39;param_regressor:mlp:num_nodes_per_layer&#39;, &#39;param_regressor:mlp:shuffle&#39;, &#39;param_regressor:mlp:solver&#39;, &#39;param_regressor:mlp:tol&#39;, &#39;param_regressor:random_forest:bootstrap&#39;, &#39;param_regressor:random_forest:criterion&#39;, &#39;param_regressor:random_forest:max_depth&#39;, &#39;param_regressor:random_forest:max_features&#39;, &#39;param_regressor:random_forest:max_leaf_nodes&#39;, &#39;param_regressor:random_forest:min_impurity_decrease&#39;, &#39;param_regressor:random_forest:min_samples_leaf&#39;, &#39;param_regressor:random_forest:min_samples_split&#39;, &#39;param_regressor:random_forest:min_weight_fraction_leaf&#39;, &#39;param_feature_preprocessor:fast_ica:n_components&#39;, &#39;param_feature_preprocessor:kernel_pca:coef0&#39;, &#39;param_feature_preprocessor:kernel_pca:degree&#39;, &#39;param_feature_preprocessor:kernel_pca:gamma&#39;, &#39;param_feature_preprocessor:nystroem_sampler:coef0&#39;, &#39;param_feature_preprocessor:nystroem_sampler:degree&#39;, &#39;param_feature_preprocessor:nystroem_sampler:gamma&#39;, &#39;param_regressor:gradient_boosting:n_iter_no_change&#39;, &#39;param_regressor:gradient_boosting:validation_fraction&#39;, &#39;param_regressor:libsvm_svr:coef0&#39;, &#39;param_regressor:libsvm_svr:degree&#39;, &#39;param_regressor:libsvm_svr:gamma&#39;, &#39;param_regressor:mlp:validation_fraction&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#np.argmax(automl.cv_results_[&#39;mean_test_score&#39;])</span>
<span class="n">automl</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[:</span><span class="mi">10</span><span class="p">]</span><span class="c1">#[::-1]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([136, 252, 277, 248, 210, 243, 296, 260, 279, 288])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">automl</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">][</span><span class="mi">288</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>81.58740281006695
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">automl</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="mi">288</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;data_preprocessing:categorical_transformer:categorical_encoding:__choice__&#39;: &#39;one_hot_encoding&#39;,
 &#39;data_preprocessing:categorical_transformer:category_coalescence:__choice__&#39;: &#39;minority_coalescer&#39;,
 &#39;data_preprocessing:categorical_transformer:category_coalescence:minority_coalescer:minimum_fraction&#39;: 0.0017722578502371359,
 &#39;data_preprocessing:numerical_transformer:imputation:strategy&#39;: &#39;mean&#39;,
 &#39;data_preprocessing:numerical_transformer:rescaling:__choice__&#39;: &#39;robust_scaler&#39;,
 &#39;data_preprocessing:numerical_transformer:rescaling:robust_scaler:q_max&#39;: 0.7669964914816525,
 &#39;data_preprocessing:numerical_transformer:rescaling:robust_scaler:q_min&#39;: 0.1445762231545981,
 &#39;feature_preprocessor:__choice__&#39;: &#39;feature_agglomeration&#39;,
 &#39;feature_preprocessor:feature_agglomeration:affinity&#39;: &#39;cosine&#39;,
 &#39;feature_preprocessor:feature_agglomeration:linkage&#39;: &#39;average&#39;,
 &#39;feature_preprocessor:feature_agglomeration:n_clusters&#39;: 213,
 &#39;feature_preprocessor:feature_agglomeration:pooling_func&#39;: &#39;median&#39;,
 &#39;regressor:__choice__&#39;: &#39;random_forest&#39;,
 &#39;regressor:random_forest:bootstrap&#39;: &#39;True&#39;,
 &#39;regressor:random_forest:criterion&#39;: &#39;mse&#39;,
 &#39;regressor:random_forest:max_depth&#39;: &#39;None&#39;,
 &#39;regressor:random_forest:max_features&#39;: 0.4677972973375797,
 &#39;regressor:random_forest:max_leaf_nodes&#39;: &#39;None&#39;,
 &#39;regressor:random_forest:min_impurity_decrease&#39;: 0.0,
 &#39;regressor:random_forest:min_samples_leaf&#39;: 3,
 &#39;regressor:random_forest:min_samples_split&#39;: 7,
 &#39;regressor:random_forest:min_weight_fraction_leaf&#39;: 0.0}
</pre></div>
</div>
</div>
</div>
<section id="save-result">
<h3>save result<a class="headerlink" href="#save-result" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="c1"># x = automl.show_models()</span>
<span class="c1"># results = autml # the classifier/regressor itself</span>
<span class="c1"># pickle.dump(results, open(&#39;file.pickle&#39;,&#39;wb&#39;))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">automl</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">automl</span> <span class="c1"># the classifier/regressor itself</span>
<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;file.pickle&#39;</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>##old</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">autosklearn.regression</span>
<span class="kn">from</span> <span class="nn">autosklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="n">automl</span> <span class="o">=</span> <span class="n">autosklearn</span><span class="o">.</span><span class="n">regression</span><span class="o">.</span><span class="n">AutoSklearnRegressor</span><span class="p">(</span>
    <span class="n">time_left_for_this_task</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">per_run_time_limit</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="n">mean_squared_error</span>
<span class="p">)</span>
<span class="n">automl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_delete</span><span class="p">,</span> <span class="n">y_delete</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">automl</span><span class="o">.</span><span class="n">leaderboard</span><span class="p">())</span>
<span class="n">train_predictions</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="c1">#submission</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">train_predictions</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-1-28e9ebafa94a&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">autosklearn.regression</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">from</span> <span class="nn">autosklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">automl</span> <span class="o">=</span> <span class="n">autosklearn</span><span class="o">.</span><span class="n">regression</span><span class="o">.</span><span class="n">AutoSklearnRegressor</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">time_left_for_this_task</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;autosklearn&#39;

<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NOTE</span>: If your import is failing due to a missing package, you can
<span class="n">manually</span> <span class="n">install</span> <span class="n">dependencies</span> <span class="n">using</span> <span class="n">either</span> <span class="o">!</span>pip<span class="w"> </span>or<span class="w"> </span>!apt.

<span class="n">To</span> <span class="n">view</span> <span class="n">examples</span> <span class="n">of</span> <span class="n">installing</span> <span class="n">some</span> <span class="n">common</span> <span class="n">dependencies</span><span class="p">,</span> <span class="n">click</span> <span class="n">the</span>
<span class="s2">&quot;Open Examples&quot;</span> <span class="n">button</span> <span class="n">below</span><span class="o">.</span>
<span class="gt">---------------------------------------------------------------------------</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">automl</span><span class="o">.</span><span class="n">leaderboard</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_predictions</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="c1">#submission</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">train_predictions</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">automl</span><span class="o">.</span><span class="n">show_models</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./ml\regression"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../../ds-courses/unsw/9418/9418-project/report.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Time series report</p>
      </div>
    </a>
    <a class="right-next"
       href="../../side-project/web-scrapter.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Course Enrolment Scrapter</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Crypto Prediction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#todo">TODO</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#final">Final</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-processing">Pre-processing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#delete">delete</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#isoforest">isoforest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#x-delete">x_delete</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#x-train">x_train</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#standardised-bad">standardised (bad)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#robust-scaler-bad-result">robust scaler (bad result)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-nans-zeros-trial">remove nans,zeros trial</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-half-zeros">remove half zeros</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#iso-forest-on-x-delete">iso forest on X_delete</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imputation">imputation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#univariate-bad-result">univariate (bad result)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multivariate">multivariate</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#convert-numpy-to-pandas">convert numpy to pandas</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#knn-imputer-bad-result">Knn imputer (bad result)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#log-transform">Log transform</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection">feature selection</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#featureagglomeration">FeatureAgglomeration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iso">iso</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluate-the-model">evaluate the model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#submission">submission</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bayeisan-regressor">bayeisan regressor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#add-features">add features</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importance">importance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#submit">submit</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test">test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#formal">formal</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#used-on-x-train-instead-of-x-delete-as-above">used on X_train instead of X_delete as above</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#param-tuning">param tuning</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression">linear regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autosklearn">autosklearn</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#save-result">save result</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jerry
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>